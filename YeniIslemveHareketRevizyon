diff --git a/src/app/TKGM/kisi-tasinmaz-search/kisi-tasinmaz-search.component.ts b/src/app/TKGM/kisi-tasinmaz-search/kisi-tasinmaz-search.component.ts
index 6dab905cf25647c6de9bddb342bafe6761181ecd..6f915646725c984f712f08cc41ec627266b57623 100644
--- a/src/app/TKGM/kisi-tasinmaz-search/kisi-tasinmaz-search.component.ts
+++ b/src/app/TKGM/kisi-tasinmaz-search/kisi-tasinmaz-search.component.ts
@@ -35,7 +35,7 @@ export class KisiTasinmazSearchComponent implements OnInit {
     const infiniteState: boolean = data.infiniteState;
     const state = data.state;
 
-    this.map = <esri.Map> data.map;
+    this.map = <esri.Map>data.map;
     this.state = state;
 
     this.infiniteState = infiniteState;
@@ -114,14 +114,23 @@ export class KisiTasinmazSearchComponent implements OnInit {
   onRowClicked(rowClickedEvent: RowClickedEvent) {
     const rowData = rowClickedEvent.data;
 
-    const tasinmaz_id = rowData['mebcbs2023.sde.malik.tasinmazid'];
+    let tasinmaz_id = rowData['mebcbs2023.sde.malik.tasinmazid'];
+    if (tasinmaz_id === undefined) {
+      tasinmaz_id = rowData['tasinmazID'];
+    }
     const queryProperties = <esri.QueryProperties>{
       where: 'tasinmaz_id=' + tasinmaz_id,
       returnGeometry: true,
       outFields: ['*']
     };
 
-    const kadastroLayer = <esri.FeatureLayer>this.map.layers.find(layer => layer.title === 'Kadastro Parselleri');
+    let kadastroLayer;
+    if (this.map !== undefined) {
+      kadastroLayer = <esri.FeatureLayer>this.map.layers.find(layer => layer.title === 'Kadastro Parselleri');
+    } else {
+      kadastroLayer = <esri.FeatureLayer>this.dialogConfig.data['mapView']['map']['layers'].find(layer =>
+        layer.title === 'Kadastro Parselleri');
+    }
 
     kadastroLayer.queryFeatures(queryProperties).then(responseObject => {
       this.dialogRef.emit(responseObject);
@@ -574,8 +583,8 @@ export class KisiTasinmazSearchComponent implements OnInit {
     };
 
     grid.gridOptions = {
-      getRowStyle: function(params) {
-        return { cursor: 'pointer'};
+      getRowStyle: function (params) {
+        return { cursor: 'pointer' };
       }
     };
 
diff --git a/src/app/accept-dialog/accept-dialog.component.html b/src/app/accept-dialog/accept-dialog.component.html
index c674966c4de103763e2ee49525582f40ba935af5..b1a65647bd05f36302b6b38d675a63a35ea41559 100644
--- a/src/app/accept-dialog/accept-dialog.component.html
+++ b/src/app/accept-dialog/accept-dialog.component.html
@@ -2,8 +2,20 @@
   <p>
     {{message}}
   </p>
-  <div class="button-container">
+  <div *ngIf="!isMultiSelect" class="button-container">
     <input type="button" value="Evet" (click)="onChoose($event)">
     <input type="button" value="Hayır" (click)="onChoose($event)">
   </div>
+
+  <div *ngIf="isMultiSelect">
+    <label style="display: block;">
+      <input type="radio" id="onlyThisProcess" name="multiSelect" (change)="multiSelectOnChoose($event)">
+      {{msText.c1}}
+    </label>
+    <label style="display: block;">
+      <input type="radio" id="allProcess" name="multiSelect" (change)="multiSelectOnChoose($event)"
+        [disabled]="!msIdenticalState">
+      {{msText.c2}}
+    </label>
+  </div>
 </div>
diff --git a/src/app/accept-dialog/accept-dialog.component.ts b/src/app/accept-dialog/accept-dialog.component.ts
index 463c65ceced4d67c6a140034b12b06d5f6c46895..c3865ce6010351167e88aec8e4fed234e664dd06 100644
--- a/src/app/accept-dialog/accept-dialog.component.ts
+++ b/src/app/accept-dialog/accept-dialog.component.ts
@@ -9,6 +9,29 @@ import { DialogRef } from '../dialog/dialog-ref';
 })
 export class AcceptDialogComponent implements OnInit {
   message: string;
+  isMultiSelect = false;
+  multiSelectDeleteProcess = false;
+  multiSelectAddMovement = false;
+  multiSelectUpdateMovement = false;
+  multiSelectDeleteMovement = false;
+  msDeleteProcessText = {
+    c1: 'Sadece Bu İşlem Silinsin.',
+    c2: 'Bu İşlemle Birlikte Eklenmiş Tüm İşlemler Silinsin.'
+  };
+  msAddMovementText = {
+    c1: 'Sadece Bu İşlemin Hareketine Eklensin.',
+    c2: 'Bu İşlemle Birlikte Eklenmiş Tüm İşlemlerin Hareketlerine Eklensin.'
+  };
+  msUpdateMovementText = {
+    c1: 'Sadece Bu İşlemin Hareketi Güncellensin.',
+    c2: 'Bu İşlemle Birlikte Eklenmiş Tüm İşlemlerdeki Bu Hareket Güncellensin.'
+  };
+  msDeleteMovementText = {
+    c1: 'Sadece Bu İşlemin Hareketi Silinsin.',
+    c2: 'Bu İşlemle Birlikte Eklenmiş Tüm İşlemlerdeki Bu Hareket Silinsin.'
+  };
+  msText = {c1: '', c2: ''};
+  msIdenticalState = false;
 
   constructor(public dialogConfig: DialogConfig, public dialog: DialogRef) { }
 
@@ -16,6 +39,34 @@ export class AcceptDialogComponent implements OnInit {
     const data = this.dialogConfig.data;
 
     this.message = data.message;
+
+    if (data['multiSelectDeleteProcess'] !== undefined) {
+      this.isMultiSelect = true;
+      this.multiSelectDeleteProcess = true;
+      this.msText = this.msDeleteProcessText;
+    }
+
+    if (data['multiSelectAddMovement'] !== undefined) {
+      this.isMultiSelect = true;
+      this.multiSelectAddMovement = true;
+      this.msText = this.msAddMovementText;
+    }
+
+    if (data['multiSelectUpdateMovement'] !== undefined) {
+      this.isMultiSelect = true;
+      this.multiSelectUpdateMovement = true;
+      this.msText = this.msUpdateMovementText;
+    }
+
+    if (data['multiSelectDeleteMovement'] !== undefined) {
+      this.isMultiSelect = true;
+      this.multiSelectDeleteMovement = true;
+      this.msText = this.msDeleteMovementText;
+    }
+
+    if (data['msIdenticalState'] !== undefined) {
+      this.msIdenticalState = data['msIdenticalState'];
+    }
   }
 
   onChoose(event: Event) {
@@ -29,4 +80,12 @@ export class AcceptDialogComponent implements OnInit {
       this.dialog.close(false);
     }
   }
+
+  multiSelectOnChoose(event: Event) {
+    const inputElement = <HTMLInputElement>event.target;
+
+    const id = inputElement.id;
+
+    this.dialog.close(id);
+  }
 }
diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index c53454f0aeda64055d6aa3efc71304f559cd8cbf..e578693ab85eb0fc33a9624fc9f4ae98db55b8b7 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -127,6 +127,7 @@ import { GuzergahSecComponent } from './tasimali/guzergah-sec/guzergah-sec.compo
 import { OnayRendererComponent } from './info/renderers/onay-renderer.component';
 import { MaksAdresbinakoduComponent } from './search/maks-adresbinakodu/maks-adresbinakodu.component';
 import { AcikadressorgulamaComponent } from './search/acikadressorgulama/acikadressorgulama.component';
+import { MirasciComponent } from './mirasci/mirasci.component';
 @NgModule({
   declarations: [
     AppComponent,
@@ -244,7 +245,8 @@ import { AcikadressorgulamaComponent } from './search/acikadressorgulama/acikadr
     GuzergahSecComponent,
     OnayRendererComponent,
     MaksAdresbinakoduComponent,
-    AcikadressorgulamaComponent
+    AcikadressorgulamaComponent,
+    MirasciComponent
   ],
   imports: [
     BrowserAnimationsModule,
@@ -322,6 +324,7 @@ import { AcikadressorgulamaComponent } from './search/acikadressorgulama/acikadr
     TkgmparcellistDatatableComponent,
     CreateQuadComponent,
     ModuleReportStatisticsComponent,
+    MirasciComponent
   ],
   providers: [],
   bootstrap: [AppComponent],
diff --git a/src/app/esri-map/esri-map.component.ts b/src/app/esri-map/esri-map.component.ts
index 3924aef60bd4a92b4238585cf43cf0b41dcc5ff2..128cb00f9ce2e31f092a6ef90cfba1c698d22ef0 100644
--- a/src/app/esri-map/esri-map.component.ts
+++ b/src/app/esri-map/esri-map.component.ts
@@ -461,7 +461,8 @@ export class EsriMapComponent implements OnInit {
 
     const moduleLayerProperties = <esri.FeatureLayerProperties>{
       title: 'İslem',
-      url: environment.arcgisMEBURL + '/FeatureServer/14',
+      // url: environment.arcgisMEBURL + '/FeatureServer/14',
+      url: 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1',
       visible: false
     };
     this.addLayerDefinitionExpression(moduleLayerProperties);
@@ -471,7 +472,8 @@ export class EsriMapComponent implements OnInit {
 
     const processLayerProperties = <esri.FeatureLayerProperties>{
       title: 'Hareket',
-      url: environment.arcgisMEBURL + '/FeatureServer/13',
+      // url: environment.arcgisMEBURL + '/FeatureServer/13',
+      url: 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2',
       visible: false
     };
     this.addLayerDefinitionExpression(processLayerProperties);
@@ -1640,7 +1642,7 @@ export class EsriMapComponent implements OnInit {
         const file: File = fileList.item(i);
         if (!file.name.toLowerCase().includes('.geojson')) {
           validStatus = false;
-          this.notificationService.open('Lütfen Geojson Uzantılı Dosya Sürükleyiniz.', 'danger', 100);
+          this.notificationService.open('Lütfen Geojson Uzantılı Dosya Sürükleyiniz.', 'danger', 10);
         }
       }
       if (validStatus) {
diff --git a/src/app/info/generic-info/generic-info.component.ts b/src/app/info/generic-info/generic-info.component.ts
index 119eb1c66ac068761d32037a4d6f5aab62d65307..6ba5ab2173fff4429c4cce22a5e118d957b81518 100644
--- a/src/app/info/generic-info/generic-info.component.ts
+++ b/src/app/info/generic-info/generic-info.component.ts
@@ -88,7 +88,8 @@ export class GenericInfoComponent implements OnInit, OnDestroy {
       this.getKurumGuncelInfoByKurumKodu();
       this.setKurumHeader();
       if (tabData.features.length === 1) {
-        this.getHistory();
+        // GAGA BURASI AÇILACAK
+        // this.getHistory();
       }
     }
   }
diff --git a/src/app/info/generic-info/transport/transport.component.ts b/src/app/info/generic-info/transport/transport.component.ts
index a4f6f31051407cd61c39f5d08877395453b15d70..bf0238ce9b984fdca3376d59c6c47d2298bb60a3 100644
--- a/src/app/info/generic-info/transport/transport.component.ts
+++ b/src/app/info/generic-info/transport/transport.component.ts
@@ -34,7 +34,7 @@ export class TransportComponent implements OnInit {
   public merkezKontrolCheckbox = false;
   public haritaBilgisiMi = false;
   public tasimaMerkezVerileri: TasimaMerkeziVerileriDto[];
-  private selectedVeri = 0;
+  public selectedVeri = 0;
   private _mapView;
 
   constructor(
diff --git a/src/app/mirasci/mirasci.component.html b/src/app/mirasci/mirasci.component.html
new file mode 100644
index 0000000000000000000000000000000000000000..002ad5a91608f11f558bfa04f8e9da1b393bfbac
--- /dev/null
+++ b/src/app/mirasci/mirasci.component.html
@@ -0,0 +1,42 @@
+<div *ngIf="state === -1 || state === 0" class="modal-content">
+  <form [formGroup]="formGroup" class="module-form" (ngSubmit)="onSubmit()">
+    <div class="form-group" *ngFor="let formData of moduleFormData;let i = index">
+      <label>{{formData.alias}}</label>
+      <input [name]="formData.name" [type]="formData.type" [formControlName]="formData.name"
+        (input)="onChangeFormControl($event)">
+    </div>
+    <div class="form-group">
+      <input *ngIf="state === -1" type="submit" value="Kaydet">
+      <input *ngIf="state === 0" type="submit" value="Düzenlemeyi Bitir">
+    </div>
+  </form>
+</div>
+
+<div class="modal-content" *ngIf="state === 1">
+  <div class="table-container">
+    <table>
+      <thead>
+        <tr>
+          <th *ngFor="let mirasciField of mirasciFields">{{mirasciField}}</th>
+        </tr>
+      </thead>
+      <tbody *ngIf="featuresInfo !== undefined">
+        <tr *ngFor="let feature of featuresInfo; index as i">
+          <td class="dd_{{i}}">{{feature.attributes.tasinmaz_id}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.hisseid}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.ad}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.soyad}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.anne_adi}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.baba_adi}}</td>
+          <td class="dd_{{i}}">{{feature.attributes.tc_kimlik_no}}</td>
+          <td class="dd_{{i}}">
+            <button (click)="onClickUpdate($event)">Düzenle</button>
+          </td>
+          <td class="dd_{{i}}">
+            <button (click)="onClickDelete($event)">Sil</button>
+          </td>
+        </tr>
+      </tbody>
+    </table>
+  </div>
+</div>
\ No newline at end of file
diff --git a/src/app/mirasci/mirasci.component.scss b/src/app/mirasci/mirasci.component.scss
new file mode 100644
index 0000000000000000000000000000000000000000..f38146205b6d98aec0f1f957c2fad92ce6c69c34
--- /dev/null
+++ b/src/app/mirasci/mirasci.component.scss
@@ -0,0 +1,108 @@
+.modal-content {
+    display: flex;
+    flex-direction: column;
+    justify-content: flex-start;
+    margin: 10px 10px 15px 15px;
+    width: 350px;
+    min-width: 450px;
+    max-width: 600px;
+    max-height: 800px;
+    min-height: 100px;
+    overflow: auto;
+  }
+  
+  .modal-content>.module-form {
+    display: flex;
+    flex-direction: row;
+    flex-wrap: wrap
+  }
+  
+  .module-form>.form-group:nth-of-type(even) {
+    padding: 12px 5px 5px 10px;
+    flex: 1 1 40%;
+    display: flex;
+  }
+  
+  .form-group {
+    padding: 12px 10px 5px 5px;
+    flex: 1 1 40%;
+    display: flex;
+    flex-direction: column;
+  }
+  
+  .form-group.full {
+    flex: 1 1 100%;
+  }
+  
+  
+  .form-group select {
+    padding: 0.2rem .0;
+    color: #495057;
+    border: 1px solid #ced4da;
+    border-radius: .25rem;
+    transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
+  }
+  
+  .form-group select:focus {
+    border-color: #80bdff;
+    outline: 0;
+    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
+  }
+  
+  .form-group input {
+    padding: 0.2rem .75rem;
+    color: #495057;
+    border: 1px solid #ced4da;
+    border-radius: .25rem;
+    height: 17.5px;
+    transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
+  }
+  
+  .module-form>.form-group:last-child {
+    padding: 12px 5px 5px 5px;
+    flex: 1 1 100%;
+    display: flex;
+  }
+  
+  .module-form>.form-group:last-child input {
+    height: auto;
+    background: white;
+    color: black;
+    transition: 0.6s;
+  }
+  
+  .module-form>.form-group:last-child input:not(:disabled):hover {
+    border-color: #80bdff;
+    box-shadow: 1px 1px 0px 0px rgba(221, 221, 221, 0.75);
+    -webkit-box-shadow: 1px 1px 0px 0px rgba(221, 221, 221, 0.75);
+    -moz-box-shadow: 1px 1px 0px 0px rgba(221, 221, 221, 0.75);
+    cursor: pointer;
+  }
+  
+  .module-form>.form-group:last-child input:disabled {
+    background: #dddddd;
+    color: black;
+  }
+  
+  .form-group label {
+    font-size: 14px;
+    padding-bottom: 5px;
+  }
+  
+  .form-group input:focus {
+    border-color: #80bdff;
+    outline: 0;
+    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
+  }
+  
+  .form-group input.error,
+  .form-group select.error {
+    border-color: red;
+    outline: 0;
+    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
+  }
+  
+  .hidden {
+    display: none;
+  }
+  
\ No newline at end of file
diff --git a/src/app/mirasci/mirasci.component.spec.ts b/src/app/mirasci/mirasci.component.spec.ts
new file mode 100644
index 0000000000000000000000000000000000000000..898f362932fef4cca5354ec1e6a3dc535c0cfb78
--- /dev/null
+++ b/src/app/mirasci/mirasci.component.spec.ts
@@ -0,0 +1,25 @@
+import { async, ComponentFixture, TestBed } from '@angular/core/testing';
+
+import { MirasciComponent } from './mirasci.component';
+
+describe('MirasciComponent', () => {
+  let component: MirasciComponent;
+  let fixture: ComponentFixture<MirasciComponent>;
+
+  beforeEach(async(() => {
+    TestBed.configureTestingModule({
+      declarations: [ MirasciComponent ]
+    })
+    .compileComponents();
+  }));
+
+  beforeEach(() => {
+    fixture = TestBed.createComponent(MirasciComponent);
+    component = fixture.componentInstance;
+    fixture.detectChanges();
+  });
+
+  it('should create', () => {
+    expect(component).toBeTruthy();
+  });
+});
diff --git a/src/app/mirasci/mirasci.component.ts b/src/app/mirasci/mirasci.component.ts
new file mode 100644
index 0000000000000000000000000000000000000000..09c7b23b494cfff7e38c8112516597ca0f2a38a5
--- /dev/null
+++ b/src/app/mirasci/mirasci.component.ts
@@ -0,0 +1,333 @@
+import { HttpClient, HttpParams } from '@angular/common/http';
+import { Component, OnInit } from '@angular/core';
+import { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';
+import { tickFormat } from '@swimlane/ngx-charts';
+import { Observable } from 'rxjs/internal/Observable';
+import { DialogConfig } from '../dialog/dialog-config';
+import { DialogRef } from '../dialog/dialog-ref';
+import { DialogService } from '../dialog/dialog.service';
+import { Malik, Mirasci, ProcessObject } from '../models/Info/malik_hisse';
+import { MirasciFormData, MirasciModuleData } from '../models/Modules/module-form-data';
+import { NotificationService } from '../notification/notification.service';
+
+@Component({
+  selector: 'app-mirasci',
+  templateUrl: './mirasci.component.html',
+  styleUrls: ['./mirasci.component.scss']
+})
+export class MirasciComponent implements OnInit {
+
+  malikInfo: Malik;
+  tasinmazID: string;
+  hisseID: string;
+  moduleData: MirasciModuleData;
+  moduleFormData: Array<MirasciFormData>;
+  formGroup: FormGroup;
+  state: number;
+  mirasciFields = ['Taşınmaz ID', 'Malik ID', 'Ad', 'Soyad', 'Anne Adı', 'Baba Adı', 'Tc Kimlik No'];
+  mirasciFieldsNames = ['tasinmaz_id', 'hisseid', 'ad', 'soyad', 'anne_adi', 'baba_adi', 'tc_kimlik_no'];
+  featuresInfo: any;
+  mirasciInfo: Mirasci;
+  notifyMessage = 'Mirasçı Başarılı';
+  notifyMessageFull = '';
+  formValues: Mirasci;
+
+  constructor(public dialogService: DialogService, public dialogConfig: DialogConfig, public dialog: DialogRef,
+    private formBuilder: FormBuilder,
+    public http: HttpClient, public notifyService: NotificationService) { }
+
+  ngOnInit() {
+    const data = this.dialogConfig.data;
+    let featuresInfo;
+    let state = data['isInfo'];
+
+    if (data['isInfo'] !== undefined) {
+      this.state = state;
+      if (state === 1) {
+        featuresInfo = data['featuresInfo'];
+      } else {
+        const malikInfo = data['malikInfo'];
+        const tasinmazID = data['tasinmazID'];
+
+        this.malikInfo = malikInfo;
+        this.tasinmazID = tasinmazID;
+        this.hisseID = malikInfo['globalid'];
+      }
+    }
+
+    this.createInitializedForm();
+
+    this.getType().subscribe(response => {
+      this.moduleData = response;
+      this.moduleFormData = response.formData;
+
+      if (state === 1) {
+        this.featuresInfo = featuresInfo;
+      } else if (state === -1) {
+        this.initializeWithFormData();
+        this.process();
+      }
+    });
+  }
+
+  initializeWithFormData(recentFormValues?: Object) {
+    let value: any;
+    let formControlValue: any;
+    const formData = this.moduleFormData;
+
+    if (this.state === 0) {
+      this.tasinmazID = this.formValues['tasinmaz_id'];
+      this.hisseID = this.formValues['hisseid'];
+    }
+
+    formData.forEach(formControl => {
+
+      const formControlName = formControl.name;
+      const required = formControl.required;
+      const disabled = formControl.disabled;
+
+      const createdFormControl = this.createFormControl(formControlName, formControl.type, required, value);
+      this.formGroup.addControl(formControlName, createdFormControl);
+
+      if (disabled) {
+        if (formControlName === 'tasinmaz_id') {
+          this.formGroup.controls[formControlName].setValue(this.tasinmazID);
+        } else if (formControlName === 'hisseid') {
+          this.formGroup.controls[formControlName].setValue(this.hisseID);
+        }
+        this.formGroup.controls[formControlName].disable();
+      }
+    });
+  }
+
+  createInitializedForm() {
+    this.formGroup = this.formBuilder.group({
+    });
+  }
+
+  createFormControl(formControlName: string, formControlType: string, required: boolean, formValue?: any) {
+    if (required === true) {
+      const validator = [Validators.required];
+      if (formControlType === 'domain' || formControlType === 'localDomain') {
+        validator.push(Validators.pattern('([^-].*)'));
+        if (formValue !== undefined) {
+          return new FormControl(formValue, validator);
+        } else {
+          return new FormControl(-1, validator);
+        }
+      } else {
+        return new FormControl(formValue, validator);
+      }
+    } else {
+      if (formControlType === 'domain' || formControlType === 'localDomain') {
+        const validator = [Validators.pattern('([^-].*)')];
+        if (formValue !== undefined) {
+          return new FormControl(formValue, validator);
+        } else {
+          return new FormControl(-1, validator);
+        }
+      } else {
+        return new FormControl(formValue);
+      }
+    }
+  }
+
+  postProcess(url: string, features: Array<{ attributes: Mirasci }>) {
+    const postFormData = new FormData();
+    let where = '';
+
+    postFormData.append('features', JSON.stringify(features));
+    postFormData.append('f', 'json');
+    postFormData.append('rollbackOnFailure', 'true');
+
+    if (this.state === 2) {
+      where = `objectid=${features[0].attributes.objectid}`;
+      postFormData.append('where', where);
+    }
+
+    return this.http.post(url, postFormData, {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken')
+      }
+    });
+  }
+
+  setProcess() {
+    const processObject = new ProcessObject();
+    let processName = '';
+    let notifyMessageArr = this.notifyMessage.split(' ');
+    let notifyMessageFull = '';
+    let url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/4/';
+    const state = this.state;
+
+    switch (state) {
+      case -1: {
+        processName = processObject.add.processName;
+        notifyMessageFull = notifyMessageArr[0] + processObject.add.name + notifyMessageArr[1];
+        break;
+      };
+      case 0: {
+        processName = processObject.update.processName;
+        notifyMessageFull = notifyMessageArr[0] + processObject.update.name + notifyMessageArr[1];
+        break;
+      };
+      case 1: {
+        processName = processObject.detail.processName;
+        notifyMessageFull = notifyMessageArr[0] + processObject.detail.name + notifyMessageArr[1];
+        break;
+      };
+      case 2: {
+        processName = processObject.delete.processName;
+        notifyMessageFull = notifyMessageArr[0] + processObject.delete.name + notifyMessageArr[1];
+        break;
+      };
+    }
+    this.notifyMessageFull = notifyMessageFull;
+    url += processName;
+
+    return url;
+  }
+
+  process() {
+    const formGroupValue: Mirasci = this.formGroup.value;
+    const features: Array<{ attributes: Mirasci }> = [{
+      attributes:
+      {
+        ad: formGroupValue.ad,
+        soyad: formGroupValue.soyad,
+        anne_adi: formGroupValue.anne_adi,
+        baba_adi: formGroupValue.baba_adi,
+        tc_kimlik_no: formGroupValue.tc_kimlik_no,
+        hisseid: this.formGroup.controls['hisseid'].value,
+        tasinmaz_id: this.formGroup.controls['tasinmaz_id'].value.toString()
+      }
+    }];
+
+    const url = this.setProcess();
+    const postParameters = { url: url, features: features };
+
+    return postParameters;
+  }
+
+  setFormValues(event: Event) {
+    const target = event.target as HTMLElement;
+    const parentElement = target.parentElement as HTMLElement;
+    const className = parentElement.classList.value;
+    // add mirasci ekranı açılacak, eski veriler controllere doldurulacak, updatefeaturesa gönderilecek
+    const selectedTableDatas = document.getElementsByClassName(className);
+
+    const mirasciFormValues: any = {};
+    for (let i = 0; i < selectedTableDatas.length - 2; i++) {
+      mirasciFormValues[this.mirasciFieldsNames[i]] = selectedTableDatas[i].innerHTML;
+    }
+
+    this.formValues = mirasciFormValues;
+    this.tasinmazID = mirasciFormValues['tasinmaz_id'];
+    this.hisseID = mirasciFormValues['hisseid'];
+  }
+
+  onClickUpdate(event: Event) {
+    this.state = 0;
+    this.setFormValues(event);
+    this.initializeWithFormData();
+    const formValues = this.formValues;
+    Object.keys(formValues).forEach(key => {
+      this.formGroup.controls[key].setValue(formValues[key]);
+    });
+  }
+
+  onClickDelete(event: Event) {
+    this.state = 2;
+    this.setFormValues(event);
+    this.initializeWithFormData();
+
+    const formValues = this.formValues;
+    Object.keys(formValues).forEach(key => {
+      this.formGroup.controls[key].setValue(formValues[key]);
+    });
+
+    this.onSubmit();
+  }
+
+  getObjectId() {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/4/query';
+
+    return this.http.get(url, {
+      params: {
+        where: `tasinmaz_id='${this.tasinmazID}' and hisseid='${this.hisseID}' and tc_kimlik_no=${this.formValues.tc_kimlik_no}`,
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'json',
+        outFields: '*'
+      }
+    });
+  }
+
+  deleteMirasci() {
+
+  }
+
+  onSubmit() {
+    const postParameters = this.process();
+    const features = postParameters.features;
+    let promise;
+
+    if (this.state === 0 || this.state === 2) {
+      promise = this.getObjectId().toPromise().then(response => {
+        features[0].attributes.objectid = response['features'][0].attributes['objectid'];
+      });
+    }
+
+    Promise.all([promise]).then(res => {
+      this.postProcess(postParameters.url, postParameters.features).subscribe(response => {
+        this.notifyService.open(this.notifyMessageFull, 'success', 10);
+        this.dialog.close(true);
+      });
+    });
+
+  }
+
+  onChangeFormControl(event: Event) {
+    const formObject = this.formGroup.value;
+    const formGroup = this.formGroup;
+    const target = <HTMLElement>event.target;
+    let formElement: HTMLInputElement | HTMLSelectElement;
+
+    if (target.tagName === 'INPUT') {
+      formElement = <HTMLInputElement>target;
+    } else {
+      formElement = <HTMLSelectElement>target;
+    }
+
+    if (formElement.type === 'number') {
+      const formValue = formElement.value;
+      if (formValue && formValue.indexOf('.') !== -1) {
+        this.formGroup.controls[formElement.name].patchValue(Number(formValue));
+      }
+    }
+
+    const formControlName = formElement.name;
+
+    const formGroupControl = formGroup.controls[formControlName];
+    if (formGroupControl && formGroupControl.valid === true) {
+      formElement.classList.remove('error');
+
+      const formElementValue = formElement.value;
+      if (formElementValue === '-1') {
+        this.resetFormData(formObject);
+      }
+    } else {
+      this.resetFormData(formObject);
+      formElement.classList.add('error');
+    }
+  }
+
+  resetFormData(formObject: Object) {
+    this.createInitializedForm();
+    this.initializeWithFormData(formObject);
+  }
+
+  getType(): Observable<MirasciModuleData> {
+    return this.http.get<MirasciModuleData>('assets/MirasciData.json');
+  }
+
+}
diff --git a/src/app/models/Info/malik_hisse.ts b/src/app/models/Info/malik_hisse.ts
index 9984b58a569561bca8abfc305318b5eeb094b5e6..40d105e9b3c477084a6c9d9b1e2f503770c79388 100644
--- a/src/app/models/Info/malik_hisse.ts
+++ b/src/app/models/Info/malik_hisse.ts
@@ -6,3 +6,36 @@ export interface MalikHisse {
     kamu_area: number;
     sahis_area: number;
 }
+
+export interface Mirasci {
+    ad: string;
+    soyad: string;
+    anne_adi: string;
+    baba_adi: string;
+    tc_kimlik_no: number;
+    hisseid: string;
+    tasinmaz_id: string;
+    objectid?: number;
+}
+
+export interface Malik {
+    ad: string;
+    globalid: string;
+    hisse_yuz_olcum: number;
+    soyad: string;
+    tc_kimlikno: string;
+    vergi_no: any;
+}
+
+export class ProcessObject {
+    add: ProcessState = { state:-1, name: 'Ekleme', processName: 'addFeatures'};
+    update: ProcessState = { state: 0, name: 'Düzenleme', processName: 'updateFeatures'};
+    detail: ProcessState = { state: 1, name: 'Detay', processName: 'query'};
+    delete: ProcessState = { state: 2, name: 'Silme', processName: 'deleteFeatures'};
+}
+
+export interface ProcessState {
+    state: number;
+    name: string;
+    processName: string;
+}
diff --git a/src/app/models/MalikDosyaNo.ts b/src/app/models/MalikDosyaNo.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e503d754c3e70da427b260f12a39874dad17dbac
--- /dev/null
+++ b/src/app/models/MalikDosyaNo.ts
@@ -0,0 +1,6 @@
+export interface MalikDosyaNo {
+   malik_id: string;
+   islem_id: string;
+   dosya_no: number | null;
+   objectid: number;
+}
\ No newline at end of file
diff --git a/src/app/models/Modules/module-form-data.ts b/src/app/models/Modules/module-form-data.ts
index 3bcf59db87d09decbf3f41859313afbb8aa4567c..7f516cda2d8f679b3e5bcd6139b2abe805cbb45c 100644
--- a/src/app/models/Modules/module-form-data.ts
+++ b/src/app/models/Modules/module-form-data.ts
@@ -1,11 +1,14 @@
-import { ProcessMovementRel } from '../ProcessMovementRel';
+import { Mirasci } from '../Info/malik_hisse';
+import { ProcessMovementRel, MovementRel } from '../ProcessMovementRel';
 
 export interface ModuleFormData {
     type: string;
     value: number;
     formData: Array<Array<FormData>>;
     processMovementRel: Array<ProcessMovementRel>;
+    movementRel: Array<MovementRel>;
 }
+
 export interface FormData {
     alias: string;
     name: string;
@@ -15,6 +18,19 @@ export interface FormData {
     domain_values: Array<DomainValue>;
 }
 
+export interface MirasciModuleData {
+    type: string;
+    formData: Array<MirasciFormData>;
+}
+
+export interface MirasciFormData {
+    alias: string;
+    name: string;
+    type: 'text' | 'number';
+    required: boolean;
+    disabled: boolean;
+}
+
 export interface ChosenValue {
     values: Array<number | string>;
     lead: number;
diff --git a/src/app/models/ProcessMovementRel.ts b/src/app/models/ProcessMovementRel.ts
index 3652fc40b07c844ba7aa28eda2a1219170937e57..b5bdf0d3ba606782520db40152bbcb7b86017fb4 100644
--- a/src/app/models/ProcessMovementRel.ts
+++ b/src/app/models/ProcessMovementRel.ts
@@ -3,10 +3,14 @@ export interface ProcessMovementRel {
     field_values: Array<Array<FieldValues>>;
 }
 
+export interface MovementRel {
+    islem_turu: number;
+    movement_values: Array<Array<MovementValues>>;
+}
+
 export interface FieldValues {
     field_value: Array<Array<FieldValue>>;
     movements_todelete: Array<number>;
-    numberof_deletedmovements: number;
 }
 
 export interface FieldValue {
@@ -15,3 +19,9 @@ export interface FieldValue {
     not_values: Array<number>;
 }
 
+export interface MovementValues {
+    if_has: Array<number>;
+    if_not_have: Array<number>;
+    movements_todelete: Array<number>;
+}
+
diff --git a/src/app/module-report/module-report.component.ts b/src/app/module-report/module-report.component.ts
index 5dd3123403245ea12562b06364b1fbcc08b7e8e0..43599efd944f9d78ededba8543ce16ee596c1ef3 100644
--- a/src/app/module-report/module-report.component.ts
+++ b/src/app/module-report/module-report.component.ts
@@ -564,14 +564,16 @@ export class ModuleReportComponent implements OnInit {
       }
       const foundField = processMovementLayer.fields.find(viewField =>
         'i_' + field.name === viewField.name || field.name === viewField.name);
+      //  GAGA burası silinecek
+      if (foundField !== undefined) {
+        foundField.alias = field.alias;
+        if (field.domain !== null) {
+          foundField.domain = field.domain;
+        }
 
-      foundField.alias = field.alias;
-      if (field.domain !== null) {
-        foundField.domain = field.domain;
-      }
-
-      if (foundField.name !== 'i_durumu' && foundField.name !== 'durumu') {
-        fields.push(foundField);
+        if (foundField.name !== 'i_durumu' && foundField.name !== 'durumu') {
+          fields.push(foundField);
+        }
       }
     });
 
diff --git a/src/app/modules/create-module/create-module.component.css b/src/app/modules/create-module/create-module.component.css
index 94d6a9bea687bc151212f24873193533c339e146..f1373d6ea5262672b24e556483057b215de724be 100644
--- a/src/app/modules/create-module/create-module.component.css
+++ b/src/app/modules/create-module/create-module.component.css
@@ -105,3 +105,25 @@
 .hidden {
   display: none;
 }
+
+.file-container {
+  display: flex;
+  align-items: baseline;
+  justify-content: space-between;
+  width: 100%;
+}
+
+.file-container .file-formdata {
+  width: 90%;
+}
+
+.form-group:nth-of-type(even) .file-formdata {
+  margin-left: -5px;
+}
+
+/* .form-group:nth-of-type(even) .file-process {
+  margin-right: 5px;
+}
+.file-container .file-process {
+  width: 10%;
+} */
diff --git a/src/app/modules/create-module/create-module.component.html b/src/app/modules/create-module/create-module.component.html
index f85ac029e934d9cfef257a13024f782031308e1c..ed82a2fc6612a85b0fc51b99f5950b330067cacb 100644
--- a/src/app/modules/create-module/create-module.component.html
+++ b/src/app/modules/create-module/create-module.component.html
@@ -4,21 +4,39 @@
       *ngFor="let formData of moduleFormData;let i = index">
       <ng-container *ngIf="formData.type === 'file' && processState === 0; else elseTemplate">
         <label>{{formData.alias}}<ng-container *ngIf="formData.required">*</ng-container></label>
-        <div style="display: flex;flex-direction: row;justify-content: space-between">
-          <label *ngFor="let attachmentInfo of attachmentData">{{attachmentInfo.name}}</label>
-          <input type="button" value="İndir" style="background: white;border-color: #80bdff" (click)="downloadFile()">
+        <div *ngFor="let attachmentInfo of attachmentData; index as i"
+          style="display: flex;flex-direction: row;justify-content: space-between">
+          <label>{{attachmentInfo.name}}</label>
+          <input name="attachment_{{i}}" type="button" value="İndir" style="background: white;border-color: #80bdff" (click)="downloadFile($event)">
         </div>
       </ng-container>
       <ng-template #elseTemplate>
-        <label>{{formData.alias}}<ng-container *ngIf="formData.required">*</ng-container></label>
+        <label *ngIf="formData.type !== 'file'">{{formData.alias}}<ng-container *ngIf="formData.required">*</ng-container>
+        </label>
+        <input *ngIf="formData.type === 'numberText'" [name]="formData.name" type="text"
+          [formControlName]="formData.name" [attr.realType]="formData.type" (input)="onChangeFormControl($event)">
         <input
-          *ngIf="!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'malik') && formData.name !== 'aciklama'"
+          *ngIf="!(formData.type === 'domain' || formData.type === 'file' || formData.type === 'localDomain' || formData.type === 'malik' || formData.type === 'numberText') && formData.name !== 'aciklama'"
           [name]="formData.name" [type]="formData.type" [formControlName]="formData.name"
           (input)="onChangeFormControl($event)">
         <textarea
-          *ngIf="!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'malik') && formData.name === 'aciklama'"
+          *ngIf="!(formData.type === 'domain' || formData.type === 'file' || formData.type === 'localDomain' || formData.type === 'malik' || formData.type === 'numberText') && formData.name === 'aciklama'"
           [name]="formData.name" [formControlName]="formData.name" (input)="onChangeFormControl($event)"></textarea>
       </ng-template>
+      <div *ngIf="formData.type === 'file' && processState !== 0" class="file-container">
+        <div class="file-formdata">
+          <label >{{formData.alias}}<ng-container *ngIf="formData.required">*
+            </ng-container></label>
+          <input [name]="formData.name" [type]="formData.type"
+            [formControlName]="formData.name" (input)="onChangeFormControl($event)" multiple="multiple">
+        </div>
+        <!-- <div class="file-process">
+          <button type="button" (click)="addAnotherFile($event)"
+            *ngIf="!formData.name.includes('_')">+</button>
+          <button type="button" (click)="onClickFileCloseButton($event)"
+            *ngIf="formData.name.includes('_')">x</button>
+        </div> -->
+      </div>
       <select *ngIf="formData.type === 'domain' || formData.type === 'localDomain'" [name]="formData.name"
         [formControlName]="formData.name" (change)="onChangeFormControl($event)">
         <option value="-1">{{formData.alias}} Seçiniz..</option>
@@ -30,7 +48,8 @@
         <p>Maliye Hazinesi Alanı - {{selectionData.maliye_area}} Metrekare</p>
         <p>Diğer Malik Alanı - {{selectionData.other_area}} Metrekare</p>
         <ag-grid-angular style="height: 300px;width: 420px" #agGrid class="ag-theme-balham ag-grid"
-          (gridReady)="onGridReady()" (rowSelected)="rowSelected()" [pagination]="true" [paginationAutoPageSize]="true"
+          (gridReady)="onGridReady()" (rowSelected)="rowSelected($event)"
+          [suppressRowClickSelection]="suppressRowClickSelection" [pagination]="true" [paginationAutoPageSize]="true"
           [rowDeselection]="true" [rowMultiSelectWithClick]="true" [defaultColDef]="defaultColDef"
           [localeText]="localeText" [rowSelection]="rowSelection">
         </ag-grid-angular>
@@ -45,4 +64,4 @@
         (click)="onDeleteProcess()">
     </div>
   </form>
-</div>
+</div>
\ No newline at end of file
diff --git a/src/app/modules/create-module/create-module.component.ts b/src/app/modules/create-module/create-module.component.ts
index 48ec4698f75fafe91882afa874d3bcf75b3e5c45..e06e852a1e7324c5642b65553eebd98fed2f9ab2 100644
--- a/src/app/modules/create-module/create-module.component.ts
+++ b/src/app/modules/create-module/create-module.component.ts
@@ -6,16 +6,20 @@ import { environment } from 'src/environments/environment';
 import { map } from 'rxjs/operators';
 import { Observable, forkJoin } from 'rxjs';
 import { FormData, ModuleFormData } from 'src/app/models/Modules/module-form-data';
-import { FormBuilder, FormGroup, FormControl, Validators } from '@angular/forms';
+import { FormBuilder, FormGroup, FormControl, Validators, FormArray, AbstractControl } from '@angular/forms';
 import { LoginResponse } from 'src/app/models/Login/login-response';
 import { DialogService } from 'src/app/dialog/dialog.service';
 import { ProgressInfoComponent } from 'src/app/progress-info/progress-info.component';
 import { NotificationService } from 'src/app/notification/notification.service';
 import { AcceptDialogComponent } from 'src/app/accept-dialog/accept-dialog.component';
 import { AgGridNg2 } from 'ag-grid-angular';
-import { ColDef } from 'ag-grid-community';
+import { ColDef, RowClickedEvent } from 'ag-grid-community';
 import esri = __esri;
 import { KeyValue } from '../interfaces/keyvalue.modules';
+import { MalikDosyaNo } from 'src/app/models/MalikDosyaNo';
+import { RendererComponent } from '../module-list/rendererClass/renderer.component';
+import { MirasciComponent } from 'src/app/mirasci/mirasci.component';
+import { MovementCreateComponent } from 'src/app/movements/movement-create/movement-create.component';
 
 interface AddFeatureResult {
   addResults: {
@@ -51,10 +55,12 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
   openDefault = true;
   sameUser = false;
   acceptanceDialog: DialogRef;
+  multiSelectAcceptanceDialog: DialogRef;
 
   defaultColDef;
   localeText;
   rowSelection = 'multiple';
+  suppressRowClickSelection = false;
   selectionData: { count: number, other_area: number, maliye_area: number } = { count: 0, maliye_area: 0, other_area: 0 };
   attachmentData: Array<esri.AttachmentInfo> = [];
 
@@ -69,6 +75,35 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
   allMalikArray: Array<any> = [];
   selectedMalikArray: Array<any> = [];
   binaSiraNo: any;
+  formValues: any;
+  islemObjectId: any;
+  createFromHareket = false;
+  yeniIslemPenceresiAcilacakDomainList = [39, 40];
+  // 15(Diğer Davalar), 13(El Atma Davaları) yani şimdilik sadece Bedel Tespit Tescil Davaları(14) için Malik Seçimi Kısıtlaması Olmayacak
+  kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruDomainList = [13, 15];
+  kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruState = false;
+  malikChangeState = false;
+  mapView: esri.MapView;
+  clickedCheckboxMalikData;
+  malikHasAlreadyAddedState = false;
+  malikListAlreadyHasProcess = [];
+  malikListWithDosyaNo: Array<MalikDosyaNo> = [];
+  mirasciState = false;
+  mirasciDetailDialogRef: DialogRef;
+  rowPreviousSelectedState = false;
+  addAnotherFileState = false;
+  currentLead = 0;
+  previousLead = 0;
+  attachmentDataArray = [];
+  hasMalikFieldOnModuleFormDataState = false;
+  isSelectedAllParcelIDsSameOnMultiSelectState = true;
+  multiSelectSuitabilityState = true;
+
+  lockRowSelectedEvent = false;
+  headerCheckboxSelectionState = true;
+
+  multiSelectMovementCreateDialogRef: DialogRef;
+
   constructor(public dialogConfig: DialogConfig, public dialog: DialogRef,
     private http: HttpClient, private formBuilder: FormBuilder, private dialogService: DialogService,
     private notify: NotificationService) {
@@ -80,12 +115,31 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     if (this.isMulti) {
       this.featureDatas = this.dialogConfig.data.featureDatas;
     }
+
+    const mapView = dialogData.mapView;
+    this.mapView = mapView;
+
     const isInfo = dialogData.isInfo;
     this.processState = isInfo;
 
     const infoFeature = dialogData.moduleData;
     this.infoAttributes = infoFeature;
 
+    const formValues = dialogData.formValues;
+    this.formValues = formValues;
+
+    const islemObjectId = dialogData['objectId'];
+    this.islemObjectId = islemObjectId;
+
+    const createFromHareket = dialogData['createFromHareket'];
+    if (createFromHareket !== undefined) {
+      this.createFromHareket = createFromHareket;
+    } else {
+      this.createFromHareket = false;
+    }
+
+    const yeniIslemPenceresiAcilacakDomainList = this.yeniIslemPenceresiAcilacakDomainList;
+
     this.refField = dialogData.refField;
     this.moduleRefField = dialogData.moduleRefField;
     this.type = dialogData.type;
@@ -93,27 +147,60 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
 
     this.openDefault = dialogData.specialState;
 
+    if (this.processState !== -1) {
+      this.getAllMovements().subscribe(movementsRes => {
+        // Malikli işlemlerde henüz hiç hareket eklenmemiş işlemlerde malikler düzenlenebilir.
+        // Ancak işlem üzerine hareket eklenmişse işlemdeki malikler düzenlenemez hiç bir şekilde
+
+        if (infoFeature['islem_turu'] === 10 && movementsRes.length === 0) {
+          this.malikChangeState = true;
+        } else {
+          this.malikChangeState = false;
+        }
+      });
+    } else {
+      this.malikChangeState = true;
+    }
+
     this.createInitializedForm();
     this.initalizeAGGrid();
 
-    this.getLayerFields().subscribe(fields => {
+    this.getTestLayerFields().subscribe(fields => {
       this.fields = fields;
 
       this.getType().subscribe(moduleFormData => {
         const moduleForm = moduleFormData.find(modules => modules.type === this.type);
         if (moduleForm !== undefined) {
+          let lead = 0;
+          if (formValues !== undefined) {
+            const foundHareketDomain = yeniIslemPenceresiAcilacakDomainList.find(x => x === formValues['durumu']);
+            if (infoFeature['islem_turu'] === 10 && foundHareketDomain) {
+              if (foundHareketDomain === 39) {
+                lead = 7;
+              } else {
+                lead = 0;
+              }
+            }
+          }
           if (isInfo === -1) {
             this.moduleData = moduleForm;
-            this.moduleFormData = moduleForm.formData[0];
-
-            this.initalizeWithFormData(moduleForm.formData[0]);
+            this.moduleFormData = moduleForm.formData[lead];
+            this.setMaliksAlreadyInProcessList();
+
+            // GAGA
+            // lead burada default olarak 0 seçilmeli. O yüzden yukarıda first value olarak 0 seçildi.
+            // Kamulaştırma davaları icra hareketi durumunda yeni işlem açılacağı için isInfo -1 olacak.
+            // Bu durumda açılacak olan bu icra hareketi işlem fieldları da typedatada leadi 7 olan
+            // formData ya tekabül ettiğinden burası dinamikleştirildi.
+            this.initalizeWithFormData(moduleForm.formData[lead]);
           } else {
             this.moduleData = moduleForm;
             this.moduleFormData = moduleForm.formData[0];
 
-            const lead = this.recursiveFormObject(this.moduleFormData, 0, infoFeature);
+            lead = this.recursiveFormObject(this.moduleFormData, 0, infoFeature);
 
             this.moduleFormData = moduleForm.formData[lead];
+            this.setMaliksAlreadyInProcessList();
             this.initalizeWithFormData(this.moduleFormData, infoFeature);
 
             const username = this.getUserName();
@@ -154,8 +241,8 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
   dotMethod(value: string) {
     let splitDotArray = [];
     let valueWithoutDot = '';
-    if (value.includes('.')) {
-      splitDotArray = value.split('.');
+    if (value.includes(',')) {
+      splitDotArray = value.split(',');
       for (let i = 0; i < splitDotArray.length; i++) {
         valueWithoutDot += splitDotArray[i];
       }
@@ -164,7 +251,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
 
     const length = 3;
 
-    const splitComma = value.split(',');
+    const splitComma = value.split('.');
     const dotValue = splitComma[0];
     const commaValue = splitComma[1];
 
@@ -215,6 +302,19 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
   }
 
   onChangeFormControl(event: Event) {
+    if (this.isMulti) {
+      const hasMalikSecimField = this.hasMalikFieldOnModuleFormDataForMultiSelect(event);
+      if (hasMalikSecimField) {
+        const isSelectedAllParcelIDsSame = this.isSelectedAllParcelIDsSameOnMultiSelect();
+        if (!isSelectedAllParcelIDsSame) {
+          this.multiSelectSuitabilityState = false;
+          this.dialog.close();
+          this.notify.open('Çoklu Seçim İçin Uygun Bir Operasyon Değildir.', 'danger', 5);
+          return;
+        }
+      }
+    }
+
     const moduleData = this.moduleData;
     const formObject = this.formGroup.value;
     const formGroup = this.formGroup;
@@ -228,26 +328,87 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     }
 
     if (formElement.type === 'file') {
-      this.formAttachmentData = (<HTMLInputElement>formElement).files.item(0);
-      this.formGroup.value.attachment = (<HTMLInputElement>formElement).files.item(0);
+      // this.formAttachmentData = (<HTMLInputElement>formElement).files.item(0);
+      // this.attachmentDataArray.push(this.formAttachmentData);
+      // this.formGroup.value.attachment = (<HTMLInputElement>formElement).files.item(0);
+      this.attachmentDataArray = [];
+      const filesArray = (<HTMLInputElement>formElement).files;
+      for (let i = 0; i < filesArray.length; i++) {
+        this.attachmentDataArray.push(filesArray[i]);
+      }
+      this.formGroup.value.attachment = (<HTMLInputElement>formElement).files;
+
     } else if (formElement.type === 'number') {
 
       if (formElement.name === 'bina_sayi') {
         const count = Number(formElement.value);
-        this.addOrRemoveDynamicFields(count, formObject);
+        this.addOrremoveDynamicFieldsForBinaSayiForBinaSayi(count, formObject);
       }
 
       const formValue = formElement.value;
+
       if (formValue && formValue.indexOf('.') !== -1) {
         this.formGroup.controls[formElement.name].patchValue(Number(formValue));
       }
+    } else if (formElement.getAttribute('realType') === 'numberText') {
+
+      // GAGA TODO
+      // TODO ONSUBMİTTE ARCGİSE BU STRİNG VERİ DOUBLE FİELDA ATILACAK
+      // O YÜZDEN DE NOKTALARI SİLİP VİRGÜLÜ NOKTAYA ÇEVİRİP ATCAN
+      let endingDotStatus = false;
+      let zeroAddStatus = false;
+      let doubleZeroStatus = false;
+
+      const formValue = formElement.value;
+
+      let newFormValue = formValue.replace(/\./g, '');
+      newFormValue = newFormValue.replace(/\,/g, '.');
+
+      if (newFormValue.endsWith('.')) {
+        endingDotStatus = true;
+      } else if (newFormValue.endsWith('.0')) {
+        zeroAddStatus = true;
+      }
+
+      if (newFormValue.endsWith('.00')) {
+        doubleZeroStatus = true;
+        zeroAddStatus = false;
+      }
+
+      let numberValue = Number(newFormValue);
+      if (isNaN(numberValue)) {
+        numberValue = 0;
+      }
+      newFormValue = numberValue.toLocaleString('tr-TR');
+
+      if (endingDotStatus) {
+        newFormValue = `${newFormValue},`;
+      } else if (zeroAddStatus) {
+        newFormValue += ',0';
+      } else if (doubleZeroStatus) {
+        newFormValue += ',00';
+      }
+
+      this.formGroup.controls[formElement.name].patchValue(newFormValue);
     }
 
+    if (this.moduleData.value === 10 && formElement.name === 'alan') {
+      const formValue = formElement.value;
+      let newFormValue = formValue.replace(/\./g, '');
+      newFormValue = newFormValue.replace(/\,/g, '.');
+
+      if (Number(newFormValue) > this.selectionData.other_area) {
+        this.notify.open('Seçili Maliklerin Toplam Yüzölçümlerinden Büyük Değer Girilemez.', 'danger', 5);
+        this.formGroup.controls['alan'].setValue(this.selectionData.other_area.toLocaleString('tr-TR'));
+      }
+    }
+
+
     const formControlName = formElement.name;
 
     const formData = this.findFormData(formControlName);
 
-    if (this.moduleData.value === 14 || formData.name === 'ucret') {
+    if (this.moduleData.value === 14 && formData.name === 'ucret') {
       // Kamulaştırma Teklifdeki kamulaştırma bedeli için de dotmethod eklenecek
       if (formElement.name === 'talep_eden_kurum') {
         formObject['detay'] = -1;
@@ -255,7 +416,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       }
       if (formElement.name === 'esas_no' || formElement.name === 'karar_no' || formElement.name === 'ucret') {
         formElement = this.onInput(event);
-        formElement.value = this.dotMethod(formElement.value);
+        // formElement.value = this.dotMethod(formElement.value);
         this.formGroup.controls[formElement.name].setValue(formElement.value);
       }
     }
@@ -296,6 +457,12 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       }
     }
 
+    if (this.moduleData.value === 10 && formElement.name === 'talep_turu') {
+      if (this.kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruDomainList.includes(Number(formElement.value))) {
+        this.kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruState = true;
+      }
+    }
+
     const formGroupControl = formGroup.controls[formControlName];
     if (formGroupControl && formGroupControl.valid === true) {
       formElement.classList.remove('error');
@@ -323,7 +490,88 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     this.checkAndUpdateCalculateFuntions(moduleData, formGroup);
   }
 
-  addOrRemoveDynamicFields(count: number, recentFormValues?: Object) {
+  addDynamicFileField(currentFileFields: Array<FormData>) {
+    let attachmentName = 'attachment';
+    const splittedAliasArray = currentFileFields[currentFileFields.length - 1].alias.split('_');
+    let fileCount = 0;
+    if (splittedAliasArray.length > 1) {
+      fileCount = Number(splittedAliasArray[1].charAt(0));
+    }
+
+    const fileFormData = <FormData>{
+      alias: `Belge_${fileCount + 1}`,
+      name: `attachment_${fileCount + 1}`,
+      type: 'file',
+      required: true,
+      domain_values: [],
+      chosen_values: []
+    };
+
+    const createdControl = this.createFormControl(fileFormData.name, fileFormData.type, fileFormData.required);
+    this.formGroup.addControl(fileFormData.name, createdControl);
+    this.moduleFormData.push(fileFormData);
+  }
+
+  // addDynamicFileField_2() {
+  //   const fileCount = this.fileAddCount;
+  //   let foundIndexOfLastFileField;
+  //   let foundIndexOfLastFileFieldName;
+  //   let attachmentName = 'attachment';
+  //   const oldFormGroup = this.formGroup;
+
+  //   this.createInitializedForm();
+
+  //   if (fileCount > 1) {
+  //     attachmentName += `_${fileCount - 1}`;
+  //   }
+  //   const fileFormData = <FormData>{
+  //     alias: `Dosya Seç`,
+  //     name: `attachment_${fileCount}`,
+  //     type: 'file',
+  //     domain_values: [],
+  //     chosen_values: []
+  //   };
+
+  //   const formControl = this.createFormControl(fileFormData.name, fileFormData.type, fileFormData.required);
+  //   const abstractFormControl = formControl as AbstractControl;
+
+  //   const abstractControlArr: Array<AbstractControl> = [];
+  //   const keyIndexArr: Array<{ key, index }> = [];
+
+  //   Object.keys(oldFormGroup.controls).forEach((key, index) => {
+  //     const abstractControl = oldFormGroup.controls[key] as AbstractControl;
+  //     const newKeyIndex = { key: key, index: index };
+  //     keyIndexArr.push(newKeyIndex);
+
+  //     if (key === attachmentName) {
+  //       foundIndexOfLastFileField = index;
+  //       foundIndexOfLastFileFieldName = key;
+  //     }
+
+  //     abstractControlArr.push(abstractControl);
+  //   });
+
+  //   const firstPart = abstractControlArr.slice(0, foundIndexOfLastFileField);
+  //   const arr = new FormArray(firstPart);
+  //   arr.insert(arr.length - 1, abstractFormControl);
+  //   const secondPart = abstractControlArr.slice(foundIndexOfLastFileField);
+  //   secondPart.forEach(part => {
+  //     arr.insert(arr.length - 1, part);
+  //   });
+
+
+  //   arr.controls.forEach((control, i) => {
+  //     const key = keyIndexArr[i].key;
+  //     const formGroup = oldFormGroup;
+  //     const createdControl = this.createFormControl(key, formGroup.controls[key]['type'], formGroup.controls[key]['required']);
+  //     this.formGroup.addControl(key, createdControl);
+  //     this.formGroup.controls[key].setValue(oldFormGroup.controls[key].value);
+  //   });
+
+
+  // }
+
+  addOrremoveDynamicFieldsForBinaSayiForBinaSayi(count: number, recentFormValues?: Object) {
     const karakteristikFieldName = 'karakteristik';
     const kapasiteFieldName = 'kapasite';
 
@@ -341,7 +589,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       return;
     } else if (dynamicFieldLength > count) {
       const deleteIndex = count + 1;
-      this.removeDynamicFields(deleteIndex, dynamicFieldLength);
+      this.removeDynamicFieldsForBinaSayi(deleteIndex, dynamicFieldLength);
       startIndex = dynamicFieldLength;
     } else if (dynamicFieldLength < count) {
       startIndex = count - (count - dynamicFieldLength) + 1;
@@ -391,6 +639,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       const karakteristikFormControl = this.createFormControl(karakteristikFormControlName, karakteristikFormControlType
         , required, karakteristikValue);
 
+
       this.formGroup.addControl(karakteristikFormControlName, karakteristikFormControl);
 
       const kapasiteFormControl = this.createFormControl(kapasiteFormControlName, kapasiteFormControlType, required, kapasiteValue);
@@ -406,7 +655,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     }
   }
 
-  removeDynamicFields(startingIndex: number, dynamicFieldLength: number) {
+  removeDynamicFieldsForBinaSayi(startingIndex: number, dynamicFieldLength: number) {
     const karakteristikFieldName = 'karakteristik';
     const kapasiteFieldName = 'kapasite';
 
@@ -454,21 +703,20 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
           }
 
           if (index === 0) {
-            if (calculateControl === 'ucret') {
-              if (formControl.value !== null) {
-                let valWithoutDot = formControl.value.replaceAll('.', '');
-                if (valWithoutDot.includes(',')) {
-                  const stringValWithoutDot: string = valWithoutDot.toString();
-                  const valWithoutComma = stringValWithoutDot.split(',');
-                  // ucret fieldındaki , checkandcalculate i patlatıyor o yüzden
-                  // , den sonraki kısmı atarak hesaplama yapmalı.
-                  valWithoutDot = valWithoutComma[0];
-                }
-                operand1 = Number(valWithoutDot);
-              }
-            } else {
-              operand1 = Number(formControl.value);
-            }
+            // if (calculateControl === 'ucret') {
+            //   if (formControl.value !== null) {
+            //     let valWithoutDot = formControl.value.replaceAll('.', '');
+            //     if (valWithoutDot.includes(',')) {
+            //       const stringValWithoutDot: string = valWithoutDot.toString();
+            //       const valWithoutComma = stringValWithoutDot.split(',');
+            //       // ucret fieldındaki , checkandcalculate i patlatıyor o yüzden
+            //       // , den sonraki kısmı atarak hesaplama yapmalı.
+            //       valWithoutDot = valWithoutComma[0];
+            //     }
+            //     operand1 = Number(valWithoutDot);
+            //   }
+            // }
+            operand1 = Number(formControl.value);
           } else {
             operand2 = Number(formControl.value);
           }
@@ -480,15 +728,16 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       if (!(calculateResult === Infinity || isNaN(calculateResult))) {
 
         const formControl = formGroup.controls[calculateFormObject.name];
-        if (formControl.dirty !== undefined) {
-          if (formControl.dirty !== true) {
-            formControl.patchValue(calculateResult.toFixed(2));
+        if (formControl !== undefined) {
+          if (formControl.dirty !== undefined) {
+            if (formControl.dirty !== true) {
+              formControl.patchValue(calculateResult.toFixed(2));
+            }
+          }
+        } else {
+          if (formControl && formControl.dirty !== true) {
+            formControl.patchValue(0);
           }
-        }
-      } else {
-        const formControl = formGroup.controls[calculateFormObject.name];
-        if (formControl && formControl.dirty !== true) {
-          formControl.patchValue(0);
         }
       }
     });
@@ -514,6 +763,34 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     return operandValue;
   }
 
+  getAllMovements(): any {
+    if (this.processState !== -1) {
+      const queryProperties = <esri.QueryProperties>{
+        where: `islem_refid = ${this.infoAttributes['objectid']}`,
+        orderByFields: ['create_date desc'],
+        outFields: ['*']
+      };
+      // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+      const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+
+      return this.getFeatures(url, queryProperties).pipe(map(response => response.features));
+    } else {
+      return [];
+    }
+  }
+
+  getFeatures(url: string, queryProperties: esri.QueryProperties) {
+    const formData = this.createFormData(queryProperties);
+
+    formData.append('f', 'json');
+
+    return this.http.post<esri.FeatureSet>(url, formData, {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+      }
+    });
+  }
+
   onOpenUpdate() {
     this.processState = 1;
 
@@ -532,9 +809,11 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     const controls = this.formGroup.controls;
     for (const controlName in controls) {
       if (controls[controlName] !== undefined) {
-        const formControl = controls[controlName];
+        if (controlName !== 'dosya_no') {
+          const formControl = controls[controlName];
 
-        formControl.enable();
+          formControl.enable();
+        }
       }
     }
     if (this.moduleData.value === 14) {
@@ -545,11 +824,32 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     }
   }
 
+  // TODO GAGA MALİK EKLEME SİLME GÖSTERME
+
+  updateMultiSelectID(formValues: any) {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/updateFeatures';
+
+    const formData = new FormData();
+    const features: Array<esri.Graphic> = [];
+    // @ts-ignore
+    const feature: esri.Graphic = {
+      attributes: formValues
+    };
+    features.push(feature);
+
+    formData.append('f', 'json');
+    formData.append('rollbackOnFailure', 'true');
+    formData.append('features', JSON.stringify(features));
+
+    return this.http.post(url, formData, { params: { token: sessionStorage.getItem('CBSArcToken') } });
+  }
+
   onMultiSubmit() {
     const header = 'Kayıt';
     const message = 'İşlem kaydı yapmak istediğinize emin misiniz ?';
     const notifyMessage = 'İşlem Ekleme Başarılı';
     const dialogData = { data: { message } };
+    const attachmentDataArray = this.attachmentDataArray;
     const acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, dialogData, false, 'light');
     acceptanceDialog.afterClosed.subscribe(isOk => {
       if (!isOk) {
@@ -557,6 +857,28 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       }
       const formValues = this.formGroup.value;
       const islem_turu = this.moduleData.value;
+      if (formValues['bina_sayi'] !== undefined) {
+        const binaCount = Number(formValues['bina_sayi']);
+
+        let kapasiteFieldValue = '';
+        let karakteristikFieldValue = '';
+        for (let i = 1; i <= binaCount; i++) {
+          const karakteristikField = 'karakteristik' + i;
+          const kapasiteField = 'kapasite' + i;
+
+          const karakteristikValue = formValues[karakteristikField];
+          const kapasiteValue = formValues[kapasiteField];
+
+          karakteristikFieldValue += karakteristikValue + ',';
+          kapasiteFieldValue += kapasiteValue + ',';
+        }
+
+        kapasiteFieldValue = kapasiteFieldValue.slice(0, -1);
+        karakteristikFieldValue = karakteristikFieldValue.slice(0, -1);
+
+        formValues['karakteristik'] = karakteristikFieldValue;
+        formValues['kapasite'] = kapasiteFieldValue;
+      }
       const layers = this.featureDatas.map(layer => {
         const idArray = layer.selectedGraphics.map(a => a.graphic.attributes.objectid);
         const query: esri.QueryProperties = {
@@ -597,7 +919,8 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
         const progressDialog = this.dialogService.
           openUnClosable(ProgressInfoComponent, 'Kayıtlar ekleniyor', false, {}, false, 'light');
 
-        this.http.post(environment.arcgisMEBURL + 'FeatureServer/14/addFeatures', insertFormData)
+        // this.http.post(environment.arcgisMEBURL + 'FeatureServer/14/addFeatures', insertFormData)
+        this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/addFeatures', insertFormData)
           .subscribe((insertResponse: AddFeatureResult) => {
             progressDialog.close();
             this.dialog.close(true);
@@ -608,88 +931,144 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
             } else {
               this.notify.open('Kayıtlar Eklendi', 'success', 5);
             }
-            if (!this.formAttachmentData) {
-              return;
-            }
-            const attachmentFormData = new FormData();
-            attachmentFormData.append('attachment', this.formAttachmentData);
-            attachmentFormData.append('f', 'json');
-            attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
-            const urlList = insertResponse.addResults
-              .filter(insert => insert.success)
-              .map((insert) => {
-                return `${environment.arcgisMEBURL}FeatureServer/14/${insert.objectId}/addAttachment`;
+
+            const date = new Date();
+            const multiSelectID = date.getHours();
+
+            insertResponse.addResults.forEach(addResult => {
+              const objectID = addResult.objectId;
+              const globalID = addResult.globalId;
+
+              // TODO ESASNO DEĞİŞTİRİLECEK TEST İÇİN YAZILDI
+              const formValues = { objectid: objectID, e_yatirim_proje_no: multiSelectID };
+              const updateIslemIDPromise = this.updateIslemID(objectID).toPromise();
+              const updateMultiSelectIDPromise = this.updateMultiSelectID(formValues).toPromise();
+
+              Promise.all([updateIslemIDPromise, updateMultiSelectIDPromise]).then(x => {
+                if (this.moduleData.value === 10) {
+                  if (this.processState === -1 && !this.createFromHareket) {
+                    const formValues = this.formGroup.value;
+                    // objectid setlemezsen updatedosyano da updatefeatures yapamaz. updtfeatures objectid ister
+                    formValues['objectid'] = objectID;
+                    formValues['dosya_no'] = objectID;
+                    this.updateDosyaNo(formValues);
+                  } else if (this.processState !== -1 && !this.createFromHareket) {
+                    const formValues = this.formGroup.value;
+                    // objectid setlemezsen updatedosyano da updatefeatures yapamaz. updtfeatures objectid ister
+                    formValues['objectid'] = objectID;
+                    formValues['dosya_no'] = this.formGroup.controls['dosya_no'].value;
+                    this.updateDosyaNo(formValues);
+                  }
+                }
+
+                if (this.agGrid !== undefined) {
+                  const rows = this.agGrid.api.getSelectedRows();
+
+                  const malikData = rows.map(row => {
+                    return { attributes: { malik_id: row['globalid'], islem_id: globalID } };
+                  });
+                  this.addMalikData(malikData).subscribe(malikAddRes => {
+                    // TODO: Control Result
+                    if (this.processState === -1) {
+                      this.notify.open(notifyMessage, 'success', 10);
+                    } else {
+                      this.notify.open(notifyMessage, 'success', 10);
+                    }
+                    this.dialog.close(true);
+                  });
+                }
+
+                if (this.formGroup.value.attachment !== undefined && this.formGroup.value.attachment !== null) {
+                  const requestList = [];
+                  let attachmentProgressDialog;
+
+                  attachmentDataArray.forEach(attachment => {
+                    const attachmentFormData = new FormData();
+                    attachmentFormData.append('attachment', attachment);
+                    attachmentFormData.append('f', 'json');
+                    attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+
+                    // tslint:disable-next-line:max-line-length
+                    const urlList = [`https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${objectID}/addAttachment`];
+
+                    requestList.push(...urlList.map(url => this.http.post(url, attachmentFormData)));
+                  });
+
+                  attachmentProgressDialog = this.dialogService.
+                    openUnClosable(ProgressInfoComponent, 'Dosyalar yükleniyor', false, {}, false, 'light');
+
+                  forkJoin(requestList).subscribe((attachmentResponse: AddAttachmentResult[]) => {
+                    attachmentProgressDialog.close();
+                    const hasFail = attachmentResponse.find(a => !a.addAttachmentResult.success);
+                    if (hasFail) {
+                      console.error('attachmentResponse hasFail', attachmentResponse);
+                      this.notify.open('Dosya Yüklemeleri Başarısız Oldu', 'danger', 5);
+                    } else {
+                      this.notify.open('Dosya Yüklemeleri Başarılı', 'success', 5);
+                    }
+                  }, (err) => {
+                    attachmentProgressDialog.close();
+                    console.error('err', err);
+                    this.notify.open('Dosya Yüklemeleri Başarısız Oldu', 'danger', 5);
+                  });
+                } else {
+                  return;
+                }
               });
-            const attachmentProgressDialog = this.dialogService.
-              openUnClosable(ProgressInfoComponent, 'Dosyalar yükleniyor', false, {}, false, 'light');
-
-            const requestList = urlList.map(url => this.http.post(url, attachmentFormData));
-            forkJoin(requestList).subscribe((attachmentResponse: AddAttachmentResult[]) => {
-              attachmentProgressDialog.close();
-              const hasFail = attachmentResponse.find(a => !a.addAttachmentResult.success);
-              if (hasFail) {
-                console.error('attachmentResponse hasFail', attachmentResponse);
-                this.notify.open('Dosya Yüklemeleri Başarısız Oldu', 'danger', 5);
-              } else {
-                this.notify.open('Dosya Yüklemeleri Başarılı', 'success', 5);
-              }
-            }, (err) => {
-              attachmentProgressDialog.close();
-              console.error('err', err);
-              this.notify.open('Dosya Yüklemeleri Başarısız Oldu', 'danger', 5);
             });
-
           }, (err) => {
             console.error('insertResponse error', err);
             progressDialog.close();
             this.dialog.close(true);
           });
       });
-
     });
   }
 
   onSubmit() {
-    if (this.isMulti) {
-      this.onMultiSubmit();
-      return;
-    }
-    if (this.acceptanceDialog === undefined) {
-      let message = '';
-      let header = '';
-      let notifyMessage = '';
-      if (this.processState === -1) {
-        header = 'Kayıt';
-        message = 'İşlem kaydı yapmak istediğinize emin misiniz ?';
-        notifyMessage = 'İşlem Ekleme Başarılı';
-      } else {
-        header = 'Düzenleme';
-        message = 'İşlem kaydını düzenlemek istediğinize emin misiniz ?';
-        notifyMessage = 'İşlem Düzenleme Başarılı';
+    if (!this.mirasciState) {
+      if (this.isMulti) {
+        this.onMultiSubmit();
+        return;
       }
+      if (this.acceptanceDialog === undefined) {
+        let message = '';
+        let header = '';
+        let notifyMessage = '';
+        if (this.processState === -1) {
+          header = 'Kayıt';
+          message = 'İşlem kaydı yapmak istediğinize emin misiniz ?';
+          notifyMessage = 'İşlem Ekleme Başarılı';
+        } else {
+          header = 'Düzenleme';
+          message = 'İşlem kaydını düzenlemek istediğinize emin misiniz ?';
+          notifyMessage = 'İşlem Düzenleme Başarılı';
+        }
 
-      if (this.moduleData.value === 14 && this.processState === -1) {
-        const binaSiraNo = this.feature.attributes['refid'];
-        this.binaSiraNo = binaSiraNo;
+        if (this.moduleData.value === 14 && this.processState === -1) {
+          const binaSiraNo = this.feature.attributes['refid'];
+          this.binaSiraNo = binaSiraNo;
 
-        this.http.get(environment.arcgisMEBURL + 'FeatureServer/14/query',
-          {
-            params: {
-              where: `bina_id = ${binaSiraNo} and yatirim_ad = '${this.formGroup.value['yatirim_ad']}' `,
-              token: sessionStorage.getItem('CBSArcToken'), f: 'json', returnCountOnly: 'true'
-            }
-          })
-          .subscribe(countObject => {
-            const count = countObject['count'];
-            if (count > 0) {
-              this.notify.open(
-                `BU BİNAYA '${this.formGroup.value['yatirim_ad']}' TÜRÜ ZATEN EKLENMİŞ.LÜTFEN BAŞKA ATÖLYE TÜRÜ SEÇİNİZ.`, 'danger', 10);
-            } else {
-              this.onAcceptDialogSubmit(header, message, notifyMessage);
-            }
-          });
-      } else {
-        this.onAcceptDialogSubmit(header, message, notifyMessage);
+          // this.http.get(environment.arcgisMEBURL + 'FeatureServer/14/query',
+          this.http.get('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query',
+            {
+              params: {
+                where: `bina_id = ${binaSiraNo} and yatirim_ad = '${this.formGroup.value['yatirim_ad']}' `,
+                token: sessionStorage.getItem('CBSArcToken'), f: 'json', returnCountOnly: 'true'
+              }
+            })
+            .subscribe(countObject => {
+              const count = countObject['count'];
+              if (count > 0) {
+                this.notify.open(
+                  `BU BİNAYA '${this.formGroup.value['yatirim_ad']}' TÜRÜ ZATEN EKLENMİŞ.LÜTFEN BAŞKA ATÖLYE TÜRÜ SEÇİNİZ.`, 'danger', 10);
+              } else {
+                this.onAcceptDialogSubmit(header, message, notifyMessage);
+              }
+            });
+        } else {
+          this.onAcceptDialogSubmit(header, message, notifyMessage);
+        }
       }
     }
   }
@@ -718,18 +1097,65 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
             results = <Array<{ success: boolean, objectId: number }>>res['updateResults'];
           }
 
-          if (results !== undefined && results.length > 0) {
-            if (this.agGrid !== undefined) {
-              const rows = this.agGrid.api.getSelectedRows();
+          // NOT
+          // VERİTABANININ SİLİNMESİ YA DA DEĞİŞTİRİLMESİ DURUMLARINDA GLOBALID DEĞİŞTİĞİNDEN
+          // GLOBALİD İLE YAPILAN TÜM İŞLEMLER UPDATE EDİLECEK
+          // BUNA İŞLEM MALİK TABLOSUNDA TUTULAN ISLEM_ID DE DAHİL. ŞUAN BURADA O İŞLEMİN GLOBALID Sİ TUTULUYOR
+          // ANCAK ARTIK İŞLEM TABLOSUNUN BİR İD FİELDI OLACAK VE BU FİELD O İŞLEMİN OBJECTID SİNİ TUTACAK
+          // İŞLEM MALİK TABLOSUNDA TUTULAN İŞLEM_ID DE BU İD İLE EŞLEŞECEK ARTIK.
+          const updateIslemIDPromise = this.updateIslemID(results[0].objectId).toPromise();
 
-              if (this.processState === 1) {
-                const malikData = rows.map(row => {
-                  return { attributes: { malik_id: row['globalid'], islem_id: res['updateResults'][0]['globalId'] } };
-                });
+          Promise.all([updateIslemIDPromise]).then(x => {
+            if (results !== undefined && results.length > 0) {
+              if (this.agGrid !== undefined) {
+                const rows = this.agGrid.api.getSelectedRows();
 
-                const deleteMalikWhere = `islem_id='${this.infoAttributes.globalid}'`;
-                this.deleteMalikData(deleteMalikWhere).subscribe(malikDeleteRes => {
-                  // TODO: Control Result
+                if (this.moduleData.value === 10) {
+                  if (this.processState === -1) {
+                    if (this.createFromHareket) {
+                    } else {
+                      const formValues = this.formGroup.value;
+                      const objectid = results[0].objectId;
+                      // objectid setlemezsen updatedosyano da updatefeatures yapamaz. updtfeatures objectid ister
+                      formValues['objectid'] = objectid;
+                      formValues['dosya_no'] = objectid;
+                      this.updateDosyaNo(formValues);
+                    }
+                  } else {
+                    if (this.createFromHareket) {
+                    } else {
+                      const formValues = this.formGroup.value;
+                      const objectid = results[0].objectId;
+                      // objectid setlemezsen updatedosyano da updatefeatures yapamaz. updtfeatures objectid ister
+                      formValues['objectid'] = objectid;
+                      formValues['dosya_no'] = this.formGroup.controls['dosya_no'].value;
+                      this.updateDosyaNo(formValues);
+                    }
+                  }
+                }
+                if (this.processState === 1) {
+                  const malikData = rows.map(row => {
+                    return { attributes: { malik_id: row['globalid'], islem_id: res['updateResults'][0]['globalId'] } };
+                  });
+
+                  const deleteMalikWhere = `islem_id='${this.infoAttributes.globalid}'`;
+                  this.deleteMalikData(deleteMalikWhere).subscribe(malikDeleteRes => {
+                    // TODO: Control Result
+                    this.addMalikData(malikData).subscribe(malikAddRes => {
+                      // TODO: Control Result
+                      if (this.processState === -1) {
+                        this.notify.open(notifyMessage, 'success', 10);
+                      } else {
+                        this.notify.open(notifyMessage, 'success', 10);
+                      }
+                      dialog.close();
+                      this.dialog.close(true);
+                    });
+                  });
+                } else {
+                  const malikData = rows.map(row => {
+                    return { attributes: { malik_id: row['globalid'], islem_id: res['addResults'][0]['globalId'] } };
+                  });
                   this.addMalikData(malikData).subscribe(malikAddRes => {
                     // TODO: Control Result
                     if (this.processState === -1) {
@@ -740,52 +1166,38 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
                     dialog.close();
                     this.dialog.close(true);
                   });
-                });
+                }
               } else {
-                const malikData = rows.map(row => {
-                  return { attributes: { malik_id: row['globalid'], islem_id: res['addResults'][0]['globalId'] } };
-                });
-                this.addMalikData(malikData).subscribe(malikAddRes => {
-                  // TODO: Control Result
-                  if (this.processState === -1) {
+                const formValues = this.formGroup.value;
+
+                if (this.formGroup.value.attachment !== undefined) {
+                  if (this.processState !== -1) {
+                    results = res['updateResults'];
+
+                    this.updateAttachments(formValues, dialog, results);
                     this.notify.open(notifyMessage, 'success', 10);
                   } else {
+                    this.addAttachment(formValues, dialog, results);
                     this.notify.open(notifyMessage, 'success', 10);
                   }
-                  dialog.close();
-                  this.dialog.close(true);
-                });
-              }
-            } else {
-              const formValues = this.formGroup.value;
-
-              if (this.formGroup.value.attachment !== undefined) {
-                if (this.processState !== -1) {
-                  results = res['updateResults'];
-
-                  this.updateAttachments(formValues, dialog, results);
-                  this.notify.open(notifyMessage, 'success', 10);
                 } else {
-                  this.addAttachment(formValues, dialog, results);
-                  this.notify.open(notifyMessage, 'success', 10);
-                }
-              } else {
-                if (this.processState !== -1) {
-                  this.removeIfHasAttachment(dialog);
-                  this.notify.open(notifyMessage, 'success', 10);
-                  dialog.close();
-                  this.dialog.close(true);
-                } else {
-                  this.notify.open(notifyMessage, 'success', 10);
-                  dialog.close();
-                  this.dialog.close(true);
+                  if (this.processState !== -1) {
+                    this.removeIfHasAttachment(dialog);
+                    this.notify.open(notifyMessage, 'success', 10);
+                    dialog.close();
+                    this.dialog.close(true);
+                  } else {
+                    this.notify.open(notifyMessage, 'success', 10);
+                    dialog.close();
+                    this.dialog.close(true);
+                  }
                 }
               }
+            } else {
+              this.notify.open('İşlem Eklerken Hata Oluştu Lütfen Kontrol Ediniz', 'danger', 10);
+              dialog.close();
             }
-          } else {
-            this.notify.open('İşlem Eklerken Hata Oluştu Lütfen Kontrol Ediniz', 'danger', 10);
-            dialog.close();
-          }
+          });
         }, error => {
           this.notify.open('İşlem Eklerken Hata Oluştu Lütfen Kontrol Ediniz', 'danger', 10);
           dialog.close();
@@ -796,59 +1208,209 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     });
   }
 
+  postUpdateAttachment(editAttachmentURL: string, attachment: any, id: any) {
+
+    const attachmentForm = new FormData();
+
+    attachmentForm.append('attachmentId', id.toString());
+    attachmentForm.append('attachment', attachment);
+    attachmentForm.append('f', 'json');
+    attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+
+    return this.http.post(editAttachmentURL, attachmentForm);
+  }
+
   updateAttachments(formValues: any, dialog: DialogRef, results: Array<{ success: boolean, objectId: number }>) {
     const featureAttributes = <any>this.infoAttributes;
-    const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/attachments?f=pjson` +
+    // const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/attachments?f=pjson` +
+    //   `&token=${sessionStorage.getItem('CBSArcToken')}`;
+    const attachmentInfosURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/attachments?f=pjson` +
       `&token=${sessionStorage.getItem('CBSArcToken')}`;
+    const deleteAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/deleteAttachments`;
+    const addAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/addAttachment`;
+    const updateAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/updateAttachment`;
     this.getAttachments(attachmentInfosURL).subscribe(attachments => {
       if (attachments !== undefined) {
         if (attachments.length === 0) {
           this.addAttachment(formValues, dialog, results);
         } else {
-          const attachment = attachments[0];
-          const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/updateAttachment`;
-          const attachmentId = attachment.id;
-
-          const attachmentForm = new FormData();
+          const newAttachmentCount = this.formGroup.value['attachment'].length;
+          const previousAttachmentCount = attachments.length;
+
+          if (previousAttachmentCount > newAttachmentCount) {
+            const attachmentToBeDeletedCount = previousAttachmentCount - newAttachmentCount;
+            const deleteObservables = [];
+            // bu kadar eleman sondan silinecek arcgiste
+            // newattcount kadar da foreach dönerek update yapılacak.
+            for (let i = 0; i < attachmentToBeDeletedCount; i++) {
+              const count = i + 1;
+              const attachmentForm = new FormData();
+              const lastAttachment = attachments[attachments.length - count];
+              const lastAttachmentIndex = attachments.lastIndexOf(lastAttachment);
+
+              attachmentForm.append('attachmentIds', lastAttachment.id.toString());
+              attachmentForm.append('rollbackOnFailure', 'true');
+              attachmentForm.append('f', 'json');
+              attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+
+              deleteObservables.push(this.http.post(deleteAttachmentURL, attachmentForm));
+            }
 
-          attachmentForm.append('attachmentId', attachmentId.toString());
-          attachmentForm.append('attachment', this.formAttachmentData);
-          attachmentForm.append('f', 'json');
-          attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+            forkJoin(deleteObservables).subscribe(attachmentDeleteResults => {
+              const deleteAttachmentData = <any>attachmentDeleteResults;
+              let status = true;
+              deleteAttachmentData.find(data => {
+                const success = data['deleteAttachmentResults'][0].success;
+                if (!success) {
+                  status = false;
+                }
+              });
+              if (deleteAttachmentData !== undefined) {
+                if (status !== true) {
+                  console.error('Attachment cannot add');
+                  // TODO: Notify Error
+                } else {
+                  const updateObservables = [];
+                  for (let j = 0; j < newAttachmentCount; j++) {
+                    updateObservables.push(this.postUpdateAttachment(updateAttachmentURL, this.formGroup.value['attachment'][j], attachments[j].id));
+                  }
+                  forkJoin(updateObservables).subscribe(updateAttachmentRes => {
+                    let status = true;
+                    const updatedAttachmentData = <any>updateAttachmentRes;
+                    updatedAttachmentData.find(data => {
+                      const success = data['updateAttachmentResult'].success;
+                      if (!success) {
+                        status = false;
+                      }
+                    });
+                    if (updatedAttachmentData !== undefined) {
+                      if (status !== true) {
+                        console.error('Attachment did not updated');
+                      }
+                      this.dialog.close();
+                      this.dialog.close(true);
+                    } else {
+                      this.dialog.close();
+                      this.dialog.close(true);
+                    }
+                  });
+                }
+                dialog.close();
+                this.dialog.close(true);
+              } else {
+                dialog.close();
+                this.dialog.close(true);
+              }
+            });
+          } else if (previousAttachmentCount < newAttachmentCount) {
+            const attachmentToBeAddedCount = newAttachmentCount - previousAttachmentCount;
+            const newAttachmentFiles = this.formGroup.value['attachment'];
+            const addObservables = [];
+            // burada da bu count kadar ekleme yapılacak diğerleri update edilecek
+            for (let i = 0; i < attachmentToBeAddedCount; i++) {
+              const attachmentForm = new FormData();
+              const lastAttachment = newAttachmentFiles[(newAttachmentFiles.length - 1) - i];
+              const lastAttachmentIndex = attachments.lastIndexOf(lastAttachment);
+
+              attachmentForm.append('attachment', lastAttachment);
+              attachmentForm.append('rollbackOnFailure', 'true');
+              attachmentForm.append('f', 'json');
+              attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+
+              addObservables.push(this.http.post(addAttachmentURL, attachmentForm));
+            }
 
-          this.http.post(editAttachmentURL, attachmentForm).subscribe(updateAttachmentRes => {
-            const updatedAttachmentData = <any>updateAttachmentRes['updateAttachmentResult'];
+            forkJoin(addObservables).subscribe(attachmentAddResults => {
+              const addAttachmentData = <any>attachmentAddResults;
+              let status = true;
+              addAttachmentData.find(data => {
+                const success = data['addAttachmentResult'].success;
+                if (!success) {
+                  status = false;
+                }
+              });
 
-            if (updatedAttachmentData !== undefined) {
-              const status = updatedAttachmentData.success;
-              if (status !== true) {
-                console.error('Attachment did not updated');
+              if (addAttachmentData !== undefined) {
+                if (status !== true) {
+                  console.error('Attachment cannot add');
+                  // TODO: Notify Error
+                } else {
+                  const updateObservables = [];
+                  for (let j = 0; j < previousAttachmentCount; j++) {
+                    updateObservables.push(this.postUpdateAttachment(updateAttachmentURL, newAttachmentFiles[j], attachments[j].id));
+                  }
+                  forkJoin(updateObservables).subscribe(updateAttachmentRes => {
+                    let status = true;
+                    const updatedAttachmentData = <any>updateAttachmentRes;
+                    updatedAttachmentData.find(data => {
+                      const success = data['updateAttachmentResult'].success;
+                      if (!success) {
+                        status = false;
+                      }
+                    });
+                    if (updatedAttachmentData !== undefined) {
+                      if (status !== true) {
+                        console.error('Attachment did not updated');
+                      }
+                      this.dialog.close();
+                      this.dialog.close(true);
+                    } else {
+                      this.dialog.close();
+                      this.dialog.close(true);
+                    }
+                  });
+                }
+                dialog.close();
+                this.dialog.close(true);
+              } else {
+                dialog.close();
+                this.dialog.close(true);
               }
-              dialog.close();
-              this.dialog.close(true);
-            } else {
-              dialog.close();
-              this.dialog.close(true);
+            });
+          } else { // eşitse zaten direkt olarak kaç taneyse o kadarı tek tek update edilecek
+            const updateObservables = [];
+            for (let j = 0; j < newAttachmentCount; j++) {
+              updateObservables.push(this.postUpdateAttachment(updateAttachmentURL, this.formGroup.value['attachment'][j], attachments[j].id));
             }
-
-          });
+            forkJoin(updateObservables).subscribe(updateAttachmentRes => {
+              let status = true;
+              const updatedAttachmentData = <any>updateAttachmentRes;
+              updatedAttachmentData.find(data => {
+                const success = data['updateAttachmentResult'].success;
+                if (!success) {
+                  status = false;
+                }
+              });
+              if (updatedAttachmentData !== undefined) {
+                if (status !== true) {
+                  console.error('Attachment did not updated');
+                }
+                this.dialog.close();
+                this.dialog.close(true);
+              } else {
+                this.dialog.close();
+                this.dialog.close(true);
+              }
+            });
+          }
         }
       } else {
         dialog.close();
         this.dialog.close(true);
       }
-
     });
   }
 
   removeIfHasAttachment(dialog: DialogRef) {
     const featureAttributes = <any>this.infoAttributes;
-    const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/attachments?f=pjson` +
+    // const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/attachments?f=pjson` +
+    const attachmentInfosURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/attachments?f=pjson` +
       `&token=${sessionStorage.getItem('CBSArcToken')}`;
 
     this.getAttachments(attachmentInfosURL).subscribe(attachments => {
       if (attachments !== undefined && attachments.length > 0) {
-        const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/deleteAttachments`;
+        // const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${featureAttributes.objectid}/deleteAttachments`;
+        const editAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${featureAttributes.objectid}/deleteAttachments`;
 
         const attachmentForm = new FormData();
         const attachmentIds = attachments.map(attachmentObject => attachmentObject.id);
@@ -879,49 +1441,159 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     return this.http.get(url).pipe(map(res => <Array<esri.AttachmentInfo>>res['attachmentInfos']));
   }
 
+  // addAnotherFile(event: Event) {
+  //   const currentFileFields = this.moduleFormData.filter(data => data.type === 'file');
+  //   if (currentFileFields.length <= 4) {
+  //     this.addAnotherFileState = true;
+  //     this.addDynamicFileField(currentFileFields);
+  //   }
+  // }
+
+  // onClickFileCloseButton(event: Event) {
+  //   const target = event.target as HTMLElement;
+  //   const parentElement = target.parentElement as HTMLElement;
+  //   const fileContainer = parentElement.parentElement as HTMLElement;
+
+  //   const currentLead = this.recursiveFormLead(this.moduleFormData, 0);
+
+  //   // moduleformdatadan silinecek namelerindeki sayılardan 1 azaltılacak eğer bundan bir önceki parent fileContainer değilse name sadece attachment olacak
+
+  //   const textContent = fileContainer.textContent;
+  //   let nameIndexOfFormData = '';
+  //   if (textContent.includes('_')) {
+  //     const splitArray = textContent.split('_');
+  //     nameIndexOfFormData += splitArray[1].charAt(0);
+  //   }
+
+  //   const indexOfElementToBeDeleted = this.moduleFormData.findIndex(moduleData => moduleData.type === 'file' && moduleData.name.includes(nameIndexOfFormData));
+
+  //   const nameOfElementToBeDeleted = this.moduleFormData[indexOfElementToBeDeleted].name;
+
+  //   const firstPartOfModuleFormData = this.moduleFormData.slice(0, indexOfElementToBeDeleted);
+  //   const secondPartOfModuleFormData = this.moduleFormData.slice(indexOfElementToBeDeleted + 1);
+
+  //   // name ve aliaslarında _ içerenlerinkinden sayılardan 1 er sayı azalacak
+
+  //   secondPartOfModuleFormData.forEach(data => {
+  //     if (data.type === 'file' && data.name.includes('_')) {
+  //       const splitNameArray = data.name.split('_');
+  //       const splitAliasArray = data.alias.split('_');
+  //       const index = Number(splitNameArray[1]);
+  //       data.name = splitNameArray[0] + '_' + `${index - 1}`;
+  //       data.alias = splitAliasArray[0] + '_' + `${index - 1}`;
+  //     }
+  //   });
+
+  //   this.moduleFormData = [].concat(firstPartOfModuleFormData, secondPartOfModuleFormData);
+  //   this.formGroup.removeControl(nameOfElementToBeDeleted);
+
+  //   const firstPart = this.moduleData.formData[currentLead].slice(0, indexOfElementToBeDeleted);
+  //   const secondPart = this.moduleData.formData[currentLead].slice(indexOfElementToBeDeleted + 1);
+
+  //   this.moduleData.formData[currentLead] = [].concat(firstPart, secondPart);
+
+  // }
+
   addAttachment(formValues: any, dialog: DialogRef, results: Array<{ success: boolean, objectId: number }>) {
-    const addAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${results[0].objectId}/addAttachment`;
 
-    const attachmentFormData = new FormData();
+    const observables = this.attachmentDataArray.map(attachmentData => {
+      // const addAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${results[0].objectId}/addAttachment`;
+      const addAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${results[0].objectId}/addAttachment`;
+
+      const attachmentFormData = new FormData();
+
+      attachmentFormData.append('attachment', attachmentData);
+      attachmentFormData.append('f', 'json');
+      attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
 
-    attachmentFormData.append('attachment', this.formAttachmentData);
-    attachmentFormData.append('f', 'json');
-    attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
 
+      return this.http.post(addAttachmentURL, attachmentFormData);
+    });
+
+    forkJoin(observables).subscribe(attachmentAddResults => {
 
-    this.http.post(addAttachmentURL, attachmentFormData).subscribe(attachmentAddResult => {
-      const addedAttachmentData = <any>attachmentAddResult['addAttachmentResult'];
+      attachmentAddResults.forEach(attachmentAddResult => {
+        const addedAttachmentData = <any>attachmentAddResult['addAttachmentResult'];
 
-      if (addedAttachmentData !== undefined) {
-        const status = addedAttachmentData.success;
-        if (status !== true) {
-          console.error('Attachment cannot add');
-          // TODO: Notify Error
+        if (addedAttachmentData !== undefined) {
+          const status = addedAttachmentData.success;
+          if (status !== true) {
+            console.error('Attachment cannot add');
+            // TODO: Notify Error
+          }
+          dialog.close();
+          this.dialog.close(true);
+        } else {
+          dialog.close();
+          this.dialog.close(true);
         }
+      }, (error) => {
+        this.notify.open('Dosya Eklenirken Hata Oluştu, Lütfen Kontrol Ediniz', 'danger', 10);
         dialog.close();
         this.dialog.close(true);
-      } else {
-        dialog.close();
-        this.dialog.close(true);
-      }
-    }, (error) => {
-      this.notify.open('Dosya Eklenirken Hata Oluştu, Lütfen Kontrol Ediniz', 'danger', 10);
-      dialog.close();
-      this.dialog.close(true);
+      });
     });
   }
 
+  // addAttachment2(formValues: any, dialog: DialogRef, results: Array<{ success: boolean, objectId: number }>) {
+
+  //   const observables = this.attachmentDataArray.map(attachmentData => {
+  //     // const addAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/14/${results[0].objectId}/addAttachment`;
+  //     const addAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${results[0].objectId}/addAttachment`;
+
+  //     const attachmentFormData = new FormData();
+
+  //     attachmentFormData.append('attachment', attachmentData);
+  //     attachmentFormData.append('f', 'json');
+  //     attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+
+
+  //     return this.http.post(addAttachmentURL, attachmentFormData);
+  //   });
+
+  //   forkJoin(observables).subscribe(attachmentAddResults => {
+
+  //     attachmentAddResults.forEach(attachmentAddResult => {
+  //       const addedAttachmentData = <any>attachmentAddResult['addAttachmentResult'];
+
+  //       if (addedAttachmentData !== undefined) {
+  //         const status = addedAttachmentData.success;
+  //         if (status !== true) {
+  //           console.error('Attachment cannot add');
+  //           // TODO: Notify Error
+  //         }
+  //         dialog.close();
+  //         this.dialog.close(true);
+  //       } else {
+  //         dialog.close();
+  //         this.dialog.close(true);
+  //       }
+  //     }, (error) => {
+  //       this.notify.open('Dosya Eklenirken Hata Oluştu, Lütfen Kontrol Ediniz', 'danger', 10);
+  //       dialog.close();
+  //       this.dialog.close(true);
+  //     });
+  //   });
+  // }
+
   deleteMalikData(where: string) {
     const postFormData = new FormData();
     postFormData.append('where', where);
     postFormData.append('f', 'json');
     postFormData.append('rollbackOnFailure', 'true');
 
+    // GAGA BURASI AÇILACAK
     return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 17 + '/deleteFeatures', postFormData, {
       params: {
         token: sessionStorage.getItem('CBSArcToken'),
       }
     });
+
+    // return this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3/deleteFeatures', postFormData, {
+    //   params: {
+    //     token: sessionStorage.getItem('CBSArcToken'),
+    //   }
+    // });
   }
 
   addMalikData(malikData: Array<{ attributes: { malik_id: string, islem_id: string } }>) {
@@ -930,37 +1602,108 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     postFormData.append('f', 'json');
     postFormData.append('rollbackOnFailure', 'true');
 
+    // GAGA BURASI AÇILACAK
     return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 17 + '/addFeatures', postFormData, {
       params: {
         token: sessionStorage.getItem('CBSArcToken'),
       }
     });
+    // return this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3/addFeatures', postFormData, {
+    //   params: {
+    //     token: sessionStorage.getItem('CBSArcToken'),
+    //   }
+    // });
+
   }
 
   onDeleteProcess() {
-    if (this.acceptanceDialog === undefined) {
-      this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'Silme', false, {
-        data: {
-          message: 'İşleme bağlı tüm hareketler silinecek. Kaydı Silmek İstediğinize Emin Misiniz ?'
-        }
-      }, false, 'light');
-      this.acceptanceDialog.afterClosed.subscribe(closeResult => {
-        if (closeResult === true) {
-          this.deleteProcess();
-        }
-        this.acceptanceDialog = undefined;
-      });
+    // eğer multiSelectIDsi null değilse çoklu seçimle eklenmiş bir işlem demektir.
+    // bu durumda çoklu seçimle eklenmiş tüm işlemlerin mi yoksa sadece seçilmiş işlemin mi silinip silinmeyeceği sorulacak.
+    let message = 'İşleme Bağlı Tüm Hareketler Silinecek. Kaydı Silmek İstediğinize Emin Misiniz?';
+    if (this.infoAttributes['e_yatirim_proje_no']) {
+      const warningMessage = 'Bu İşlem Çoklu Seçimle Eklenmiştir.';
+
+      if (this.multiSelectAcceptanceDialog === undefined) {
+        this.multiSelectAcceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'UYARI', false, {
+          data: {
+            message: warningMessage,
+            multiSelectDeleteProcess: true
+          }
+        }, false, 'light');
+        this.multiSelectAcceptanceDialog.afterClosed.subscribe(multiSelectChoise => {
+          if (multiSelectChoise === 'allProcess') {
+            // tslint:disable-next-line:max-line-length
+            message = 'Bu İşlemle Birlikte Çoklu Olarak Eklenmiş Tüm İşlemler ve Bu İşlemlere Bağlı Tüm Hareketler Silinecek. Kayıtları Silmek İstediğinize Emin Misiniz?'
+          }
+
+          if (this.acceptanceDialog === undefined) {
+            this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'Silme', false, {
+              data: {
+                message: message
+              }
+            }, false, 'light');
+            this.acceptanceDialog.afterClosed.subscribe(closeResult => {
+              if (closeResult === true) {
+                this.deleteProcess(multiSelectChoise);
+              }
+              this.acceptanceDialog = undefined;
+            });
+          }
+
+          this.multiSelectAcceptanceDialog = undefined;
+        });
+      }
+    } else {
+      if (this.acceptanceDialog === undefined) {
+        this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'Silme', false, {
+          data: {
+            message: message
+          }
+        }, false, 'light');
+        this.acceptanceDialog.afterClosed.subscribe(closeResult => {
+          if (closeResult === true) {
+            this.deleteProcess();
+          }
+          this.acceptanceDialog = undefined;
+        });
+      }
     }
   }
 
-  deleteProcess() {
+  getMultiSelectDatas() {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+
+    return this.http.get(url, {
+      params: {
+        where: `e_yatirim_proje_no='${this.infoAttributes['e_yatirim_proje_no']}' and touch_by='goksuvat'`,
+        outFields: ['*'],
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson'
+      }
+    });
+  }
+
+  async deleteProcess(multiSelectChoise?: string) {
     const objectid = this.infoAttributes['objectid'];
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/deleteFeatures';
+    let headerMessage = 'Modül Siliniyor';
+    let toBeDeletedObjectIDs = [];
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/deleteFeatures';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/deleteFeatures';
     const queryProperties = <esri.QueryProperties>{
       objectIds: [objectid],
     };
 
-    const dialog = this.dialogService.openUnClosable(ProgressInfoComponent, 'Modül Siliniyor', false,
+    if (multiSelectChoise) {
+      if (multiSelectChoise === 'allProcess') {
+        await this.getMultiSelectDatas().toPromise().then(multiSelectDatas => {
+          toBeDeletedObjectIDs = multiSelectDatas['features'].map(data => data['attributes'].objectid);
+          queryProperties.objectIds = toBeDeletedObjectIDs;
+          headerMessage = 'Modüller Siliniyor';
+        });
+      }
+    }
+
+    const dialog = this.dialogService.openUnClosable(ProgressInfoComponent, headerMessage, false,
       { data: {} }, false, 'light');
 
     this.deleteFeatures(queryProperties, url).subscribe(deleteProcessRes => {
@@ -971,11 +1714,12 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
           // TODO: Control Result
         });
       }
-      const movementValues = `islem_refid = ${objectid}`;
+      const movementValues = `islem_refid IN (${toBeDeletedObjectIDs.toString()})`;
       const movementQueryProperties = <esri.QueryProperties>{
         where: movementValues,
       };
-      const movementLayerURL = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/deleteFeatures';
+      // const movementLayerURL = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/deleteFeatures';
+      const movementLayerURL = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/deleteFeatures';
 
 
       this.deleteFeatures(movementQueryProperties, movementLayerURL).subscribe(deleteMovementRes => {
@@ -988,17 +1732,66 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     });
   }
 
+  updateDosyaNo(formValues: any) {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/updateFeatures';
+
+    const formData = new FormData();
+    const features: Array<esri.Graphic> = [];
+    // @ts-ignore
+    const feature: esri.Graphic = {
+      attributes: formValues
+    };
+    features.push(feature);
+
+    formData.append('f', 'json');
+    formData.append('rollbackOnFailure', 'true');
+    formData.append('features', JSON.stringify(features));
+
+    this.http.post(url, formData, { params: { token: sessionStorage.getItem('CBSArcToken') } }).subscribe();
+  }
+
+  updateIslemID(objectId: any) {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/updateFeatures';
+
+    const formData = new FormData();
+    const features: Array<esri.Graphic> = [];
+    // @ts-ignore
+    const feature: esri.Graphic = {
+      attributes: { objectid: objectId, id: objectId }
+    };
+    features.push(feature);
+
+    formData.append('f', 'json');
+    formData.append('rollbackOnFailure', 'true');
+    formData.append('features', JSON.stringify(features));
+
+    return this.http.post(url, formData, { params: { token: sessionStorage.getItem('CBSArcToken') } });
+  }
+
   initalizeWithFormData(formData: Array<FormData>, recentFormValues?: Object) {
+    if (this.isMulti) {
+      const hasMalikSecimField = this.hasMalikFieldOnModuleFormDataForMultiSelect();
+      if (hasMalikSecimField) {
+        const isSelectedAllParcelIDsSame = this.isSelectedAllParcelIDsSameOnMultiSelect();
+        if (!isSelectedAllParcelIDsSame) {
+          this.dialog.close();
+          this.notify.open('Çoklu Seçim İçin Uygun Bir Operasyon Değildir', 'danger', 5);
+          return;
+        }
+      }
+    }
+
     let value: any;
     let formControlValue: any;
 
-
     formData.forEach(formControl => {
+
       let tbaDotMethodUygulamaState = false;
       let ucretFieldDotMethodUygState = false;
 
       const formControlName = formControl.name;
       const required = formControl.required;
+
       if (formControl.type === 'domain') {
         this.bindFieldDomainValues(formControl);
       } else if (formControl.type === 'malik') {
@@ -1007,6 +1800,10 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
 
       if (recentFormValues !== undefined) {
         value = recentFormValues[formControlName];
+        if (formControlName === 'alan') {
+          value = Number(value).toLocaleString('tr-TR');
+          // value = this.dotMethod(value.toString());
+        }
         if (formControl.domain_values.length > 0) {
           formControlValue = formControl.domain_values.find(domain => {
             if (isNaN(value)) {
@@ -1036,10 +1833,13 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       if (formControl.type === 'file' && this.processState === 0) {
         const featureAttributes = <any>this.infoAttributes;
         const objectid = featureAttributes['objectid'];
-        const islemUrl = `${environment.arcgisMEBURL}/FeatureServer/14/${objectid}/`;
+        // const islemUrl = `${environment.arcgisMEBURL}/FeatureServer/14/${objectid}/`;
+        const islemUrl = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${objectid}/`;
         const attachmentInfosURL = islemUrl + `attachments?token=${sessionStorage.getItem('CBSArcToken')}&f=pjson`;
         this.getAttachments(attachmentInfosURL).subscribe(attachmentData => {
-          this.attachmentData = attachmentData;
+          attachmentData.forEach(attachment => {
+            this.attachmentData.push(attachment);
+          });
         });
       }
 
@@ -1047,15 +1847,17 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
         if (this.moduleData.value === 14 && (formControlName === 'esas_no' || formControlName === 'karar_no')) {
           tbaDotMethodUygulamaState = true;
         }
-        if (formControlName === 'ucret') {
-          ucretFieldDotMethodUygState = true;
-        }
-        if (tbaDotMethodUygulamaState || ucretFieldDotMethodUygState) {
-          if (this.processState === 0 && value !== null) {
-            const commaValue = value.replace('.', ',');
-            value = this.dotMethod(commaValue);
-          }
-        }
+
+        // GAGA UCRET FIELDI ARTIK NUMBER OLDUĞU İÇİN NOKTALAMA İÇİN LOCALE METODU KULLANILACAK
+        // if (formControlName === 'ucret') {
+        //   ucretFieldDotMethodUygState = true;
+        // }
+        // if (tbaDotMethodUygulamaState || ucretFieldDotMethodUygState) {
+        //   if (this.processState === 0 && value !== null) {
+        //     const commaValue = value.replace('.', ',');
+        //     value = this.dotMethod(commaValue);
+        //   }
+        // }
       }
 
       const createdFormControl = this.createFormControl(formControlName, formControl.type, required, value);
@@ -1071,6 +1873,31 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       }
       this.formGroup.addControl(formControlName, createdFormControl);
 
+      // if (this.moduleData.value === 10 && formControlName === 'dosya_no') {
+      //   if (this.processState !== -1) {
+      //     const objectId = this.islemObjectId;
+      //     this.infoAttributes['dosya_no'] = objectId;
+      //     this.formGroup.controls[formControlName].setValue(objectId);
+      //     this.formGroup.controls[formControlName].disable();
+      //   } else {
+      //     if (this.infoAttributes !== undefined) {
+      //       this.formGroup.controls[formControlName].setValue(this.infoAttributes['dosya_no']);
+      //     }
+      //     this.formGroup.controls[formControlName].disable();
+      //   }
+      // }
+
+      if (this.moduleData.value === 10 && formControlName === 'dosya_no') {
+        if (this.infoAttributes !== undefined) {
+          this.formGroup.controls[formControlName].setValue(this.infoAttributes['dosya_no']);
+        }
+        // else {
+        //   const objectId = this.islemObjectId;
+        //   this.formGroup.controls[formControlName].setValue(objectId);
+        // }
+        this.formGroup.controls[formControlName].disable();
+      }
+
       if (recentFormValues !== undefined) {
         const atolyeIslemValue = recentFormValues['talep_amaci'];
         if (this.moduleData.value === 14 && (atolyeIslemValue === '-1' || atolyeIslemValue === -1)) {
@@ -1105,7 +1932,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
 
     if (foundBinaSayiField !== undefined && recentFormValues !== undefined) {
       const binaSayiValue = Number(recentFormValues[foundBinaSayiField.name]);
-      this.addOrRemoveDynamicFields(binaSayiValue, recentFormValues);
+      this.addOrremoveDynamicFieldsForBinaSayiForBinaSayi(binaSayiValue, recentFormValues);
     }
   }
 
@@ -1170,7 +1997,17 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     const firstFormData = moduleData.formData[0];
     const foundLead = this.recursiveFormLead(firstFormData, 0);
 
-    const leadingFormData = moduleData.formData[foundLead];
+    let leadingFormData = moduleData.formData[foundLead];
+    let durumu;
+    if (this.dialogConfig.data['formValues'] !== undefined) {
+      durumu = this.dialogConfig.data['formValues']['durumu'];
+    } else {
+      durumu = this.moduleData.value;
+    }
+
+    if (moduleData.value === 10 && durumu === 39) {
+      leadingFormData = moduleData.formData[7];
+    }
 
     this.createInitializedForm();
     this.moduleFormData = leadingFormData;
@@ -1240,6 +2077,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
   }
 
   findLead(formControlValue: number | string, formData: FormData) {
+    this.previousLead = this.currentLead;
     const numberValue = Number(formControlValue);
 
     let formValue: number | string;
@@ -1253,6 +2091,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       chosenValue.values.find(value => value === formValue) !== undefined);
 
     if (foundChosenValue !== undefined) {
+      this.currentLead = foundChosenValue.lead;
       return foundChosenValue.lead;
     }
   }
@@ -1265,6 +2104,15 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     return this.http.get<Array<ModuleFormData>>('assets/TypeData.json');
   }
 
+  getTestLayerFields() {
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1', {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson',
+      }
+    }).pipe(map(response => response['fields']));
+  }
+
   getLayerFields() {
     return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 14, {
       params: {
@@ -1344,12 +2192,13 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
 
       formData['sayi'] = toplamMaliyetStringData;
     } else if (ucretFieldProcessArray.includes(this.moduleData.value)) {
-      if (formData['ucret']) {
-        let ucretField = <string>formData['ucret'];
-        ucretField = ucretField.replace(/\./g, '');
-        ucretField = ucretField.replace(/,/g, '.');
-        formData['ucret'] = ucretField;
-      }
+      // GAGA UCRET FIELD ARTIK NUMBER OLDUĞU ICIN BUNA GEREK KALMAYACAK
+      // if (formData['ucret']) {
+      //   let ucretField = <string>formData['ucret'];
+      //   ucretField = ucretField.replace(/\./g, '');
+      //   ucretField = ucretField.replace(/,/g, '.');
+      //   formData['ucret'] = ucretField;
+      // }
     }
     let feature = <esri.Graphic>{
       attributes: formData,
@@ -1361,7 +2210,7 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     // arasında CAST operasyonu yapılmıyor. Yani TBA maliyet fieldları içinde filtreleme yapamaz.
     // Hatta kamulaştırma bedeli olan ucret fieldlarında da filtreleme yapamaz.
 
-    feature = this.dotToCommaMethod(feature);
+    // feature = this.dotToCommaMethod(feature);
     features.push(feature);
     this.addFeatureBoundData(features);
 
@@ -1371,13 +2220,31 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     postFormData.append('rollbackOnFailure', 'true');
 
     if (this.processState === -1) {
-      return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/addFeatures', postFormData, {
-        params: {
-          token: sessionStorage.getItem('CBSArcToken'),
-        }
-      });
+      if (this.moduleData.value === 10) {
+        return this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/addFeatures', postFormData, {
+          params: {
+            token: sessionStorage.getItem('CBSArcToken'),
+          }
+        });
+      } else {
+        // return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/addFeatures', postFormData, {
+        //   params: {
+        //     token: sessionStorage.getItem('CBSArcToken'),
+        //   }
+        return this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/addFeatures', postFormData, {
+          params: {
+            token: sessionStorage.getItem('CBSArcToken'),
+          }
+        });
+      }
     } else if (this.processState === 1) {
-      return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/updateFeatures', postFormData, {
+      // return this.http.post(environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/updateFeatures', postFormData, {
+      //   params: {
+      //     token: sessionStorage.getItem('CBSArcToken'),
+      //   }
+      // });
+
+      return this.http.post('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/updateFeatures', postFormData, {
         params: {
           token: sessionStorage.getItem('CBSArcToken'),
         }
@@ -1507,16 +2374,33 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       filters: 'Filtreler',
       noRowsToShow: 'Veri bulunamadı',
     };
+
   }
 
   onGridReady() {
-    const processState = this.processState;
+    this.agGrid.context = { componentParent: this };
+    let processState = this.processState;
 
     const colDefs = this.createMalikColumDefinitions();
     this.agGrid.api.setColumnDefs(colDefs);
 
     const malikTableURL = environment.arcgisMEBURL + 'FeatureServer/' + 15;
 
+    // const deneme = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3';
+
+
+
+    // İCRA VE YENİ ESAS HAREKETLERİNDE YENİ İŞLEM AÇILACAK
+    // TÜM MALİKLER GELECEK AMA İLK İŞLEMDE SEÇİLMİŞ MALİKLER TİKLİ OLARAK GELECEK
+    // BU AYRI BİR KONU OLARAK İŞLENECEK = > İCRADA SEÇİLMİŞ BU MALİKLER ÜZERİNDEN HAREKET EKLENİRKEN TEKRAR İCRA 
+    // HAREKETİ OLMASI DURUMUNDA İCRA AÇMIŞ OLAN MALİK TEKRAR AÇAMAYACAK,
+
+    if (this.formValues !== undefined) {
+      if (this.yeniIslemPenceresiAcilacakDomainList.includes(this.formValues['durumu'])) {
+        processState = 4;
+      }
+    }
+
     if (processState === -1) {
       if (!this.isMulti) {
         const tasinmazID = <number>this.feature.attributes['tasinmaz_id'];
@@ -1546,7 +2430,9 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
       const islem_id = this.infoAttributes['globalid'];
 
       const where = `islem_id = '${islem_id}'`;
+      // GAGA BURASI AÇILACAK
       const malikIslemTableURL = environment.arcgisMEBURL + 'FeatureServer/' + 17;
+      // const malikIslemTableURL = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3';
 
       this.getMalikIds(malikIslemTableURL, where).subscribe(malikIDs => {
         let malikWhere = 'globalid IN (';
@@ -1595,12 +2481,15 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
             this.agGrid.api.setRowData([]);
           }
         });
-      });
-    } else if (processState === 1) {
+      }); //  GAGA EN SON PROCESSSTATE 4 İLE YENİ İŞLEM AÇILAN HAREKET DURUMLARINDA 
+      // İLK İŞLEMDE SEÇİLMİŞ MALİKLER TİKLENMİŞ OLARAK TÜM MALİKLER LİSTELENECEK
+    } else if (processState === 1 || processState === 4) {
       const islem_id = this.infoAttributes['globalid'];
 
       const where = `islem_id = '${islem_id}'`;
+      // GAGA BURASI AÇILACAK
       const malikIslemTableURL = environment.arcgisMEBURL + 'FeatureServer/' + 17;
+      // const malikIslemTableURL = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3';
 
       this.getMalikIds(malikIslemTableURL, where).subscribe(malikIDs => {
         let malikWhere = 'globalid IN (';
@@ -1651,42 +2540,295 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
         });
       });
     }
-    this.agGrid.context = { componentParent: this };
   }
 
   move(array, from, to) {
     array.splice(to, 0, array(from, 1)[0]);
   }
 
-  rowSelected() {
-    const rows = this.agGrid.api.getSelectedRows();
-    const selectionData = this.selectionData;
+  // Malik Seçimi Olan İşlemlerin İçinde Farklı Parseller Varsa Çoklu Seçim Yapılamaz. Çünkü Farklı Parsellerin Farklı Malikleri Var. 
+  // Bu yüzden multi seçimse ve kamulaştırma davaları ise ve seçilenlerdeki tüm parsellerin parselidleri eşit değilse uyarı verdirticem
+  isSelectedAllParcelIDsSameOnMultiSelect() {
+    this.isSelectedAllParcelIDsSameOnMultiSelectState = true;
+    const dialogData = this.dialogConfig.data;
+
+    const tasinmazIDs: Array<any> = dialogData.featureDatas[0]['selectedGraphics'].map(selectedGraphic => selectedGraphic['graphic']['attributes']['tasinmaz_id']);
+
+    // Sadece 1 tane tasinmazID varsa zaten sadece 1 tane parsel seçmiş demektir. Bu durumda çoklu işlem yapabilir.
+    if (tasinmazIDs.length > 1) {
+      for (let i = 0; i < tasinmazIDs.length; i++) {
+        if (tasinmazIDs[i + 1] !== undefined) {
+          if (tasinmazIDs[i] !== tasinmazIDs[i + 1]) {
+            this.isSelectedAllParcelIDsSameOnMultiSelectState = false;
+          }
+        }
+      }
+    }
+
+    if (this.isSelectedAllParcelIDsSameOnMultiSelectState) {
+      return true;
+    } else {
+      return false;
+    }
+  }
+
+  hasMalikFieldOnModuleFormDataForMultiSelect(event?: Event) {
+    this.hasMalikFieldOnModuleFormDataState = false;
+    let foundMalikField;
+
+    if (event && event.type === 'select') {
+      const formControlName = (<HTMLInputElement>event.target).name;
+      const formControlValue = this.formGroup.controls[formControlName].value;
+
+      const formData = this.findFormData(formControlName);
+      const lead = this.findLead(formControlValue, formData);
+
+      foundMalikField = this.moduleData.formData[lead].find(data => data.type === 'malik')
+    } else {
+      foundMalikField = this.moduleFormData.find(data => data.type === 'malik');
+    }
+
+    if (foundMalikField) {
+      this.hasMalikFieldOnModuleFormDataState = true;
+    }
+    return this.hasMalikFieldOnModuleFormDataState;
+  }
+
+  // İşlemi Olan Malik Listesi Setlemek İçin
+  setMaliksAlreadyInProcessList() {
+    let parselID;
+    if (this.isMulti) {
+      const hasMalikSecimField = this.hasMalikFieldOnModuleFormDataForMultiSelect();
+      if (hasMalikSecimField) {
+        const isSelectedAllParcelIDsSame = this.isSelectedAllParcelIDsSameOnMultiSelect();
+        if (!isSelectedAllParcelIDsSame) {
+          return;
+        } else {
+          parselID = this.dialogConfig.data['featuresDatas'][0]['selectedGraphics'][0]['graphic']['attributes']['tasinmaz_id'];
+        }
+      }
+    } else {
+      parselID = this.dialogConfig.data['feature']['attributes']['tasinmaz_id'];
+      const processUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+      const islemMalikUrl = environment.arcgisMEBURL + 'FeatureServer/17/query';
+      // const islemMalikUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3/query';
+      const processProperties = <esri.QueryProperties>{
+        where: `parsel_id = ${parselID}`,
+        outFields: ['dosya_no', 'globalid']
+      };
+
+      this.getFeatures(processUrl, processProperties).toPromise().then(processRes => {
+        processRes.features.forEach(process => {
+          const islemID = process.attributes['globalid'];
+          const dosyaNo = process.attributes['dosya_no'];
+          const islemMalikQueryProperties = <esri.QueryProperties>{
+            where: `islem_id='${islemID}'`, // BURASI HİSSEID YE GÖRE KONTROL EDİLECEK SONRASINDA
+            outFields: ['*']
+          };
+          this.getFeatures(islemMalikUrl, islemMalikQueryProperties).toPromise().then(islemMalikRes => {
+            if (islemMalikRes.features.length > 0) {
+              islemMalikRes.features.forEach(islemMalik => {
+                const data = islemMalik.attributes;
+                const malikWithDosyaNo: MalikDosyaNo = {
+                  dosya_no: dosyaNo, islem_id: data['islem_id'], malik_id: data['malik_id'],
+                  objectid: data['objectid']
+                };
+                this.malikListWithDosyaNo.push(malikWithDosyaNo);
+                this.malikListAlreadyHasProcess.push(islemMalik.attributes);
+              });
+            }
+          });
+        });
+      });
+    }
+  }
+
+  ifMalikHasAlreadyInOtherProcess(parselID: any, malikId: any) {
+    // const processUrl = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const processUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+    const islemMalikUrl = environment.arcgisMEBURL + 'FeatureServer/17/query';
+    // const islemMalikUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/3/query';
+
+    const islemMalikQueryProperties = <esri.QueryProperties>{
+      where: `malik_id = '${malikId}'`, // DEĞİŞTİRİLECEK GLOBALID SADECE ID OLACAK
+      outFields: ['*']
+    };
+
+    let returnValue: any = -1;
+
+    return this.getFeatures(islemMalikUrl, islemMalikQueryProperties)
+      .toPromise().then(islemMalikFeatures => {
+        if (islemMalikFeatures.features.length > 0) { // O Malikin İşlemi Var Demektir O Zaman O İşlemin Parsel ID si ile Uyuşuyor Mu
+          // Diye Bakılması Lazım
+
+          const processQueryProperties = <esri.QueryProperties>{
+            where: `parsel_id = ${parselID}`,
+            outFields: ['dosya_no', 'globalid'] // DEĞİŞTİRİLECEK GLOBALID SADECE ID OLACAK
+          };
+
+          return this.getFeatures(processUrl, processQueryProperties).toPromise()
+            .then(processFeatures => {
+              if (processFeatures.features.length > 0) {
+                islemMalikFeatures.features.forEach(malikIslemi => {
+                  const islemID = malikIslemi.attributes['islem_id'];
+                  const foundFeature = processFeatures.features.find(processFeature => processFeature.attributes['globalid'] === islemID);
+
+                  if (foundFeature) {
+                    returnValue = foundFeature.attributes;
+                  }
+                });
+                return returnValue;
+              }
+            });
+        }
+      });
+  }
+
+  setMalikCalculations(rows: Array<any>) {
+    // Detayda selectionDatayı hesaplamasın artık. Çünkü artık alan(Davalık Yüz Ölçümü) elle de girilebilecek.
+    // Bu durumda servisten gelen değer gösterilmesi için calculate yapmayacak
+    if (this.processState !== 0) {
+      const selectionData = this.selectionData;
+      let shareArea = 0;
+      let maliyeArea = 0;
+      let otherArea = 0;
+
+      for (let i = 0; i < rows.length; i++) {
+        const row = rows[i];
+        const area = row['hisse_yuz_olcum'];
+        shareArea += area;
+        if (row['vergi_no'] === '6110312806') {
+          maliyeArea += area;
+        } else {
+          otherArea += area;
+        }
+      }
+
+      selectionData.count = rows.length;
+      selectionData.maliye_area = Number(maliyeArea.toFixed(2));
+      selectionData.other_area = Number(otherArea.toFixed(2));
+
+      this.formGroup.controls['alan'].patchValue(Number(shareArea.toFixed(2)).toLocaleString('tr-TR'));
+
+      const alanControl = this.formGroup.controls['alan'];
+
+      // Alanın valuesu setlenirse formgroup otomatikman valid oluyor. O zaman da malik seçmeden kaydedebiliyor.
+      // Alan değeri 0.00 ise hiç malik seçilmemiş demektir. Bu durumda alan controlü undefined yapılırsa formgroup un validliği düşer.
+      if (alanControl.value === '0.00') {
+        alanControl.setValue(undefined);
+      }
+      this.checkAndUpdateCalculateFuntions(this.moduleData, this.formGroup);
+    }
+  }
 
-    if (this.processState === 0) {
+  rowSelected(event: RowClickedEvent) {
+    if (this.lockRowSelectedEvent) {
       return;
     }
 
-    let shareArea = 0;
-    let maliyeArea = 0;
-    let otherArea = 0;
-    for (let i = 0; i < rows.length; i++) {
-      const row = rows[i];
-      const area = row['hisse_yuz_olcum'];
-      shareArea += area;
-      if (row['vergi_no'] === '6110312806') {
-        maliyeArea += area;
-      } else {
-        otherArea += area;
+    const rows = this.agGrid.api.getSelectedRows();
+
+    if (event.api.getFocusedCell() !== undefined && !this.headerCheckboxSelectionState) {
+      const focusedColID = event.api.getFocusedCell().column.getColId();
+      if (focusedColID === 'mirasci' || focusedColID === 'mirasci_detay') {
+        if (event.node.isSelected()) {
+          event.node.setSelected(false);
+        } else {
+          event.node.setSelected(true);
+        }
+
+        this.lockRowSelectedEvent = true;
+
+        setTimeout(() => {
+          this.lockRowSelectedEvent = false;
+        });
+
+        return;
+      }
+    }
+
+    this.malikHasAlreadyAddedState = false;
+
+    // Bir Parsel Üzerindeki İşlemlerde İşlem Eklenirken Malik Seçimi Yapıldığında
+    // Seçilen Malikin Halihazırda O Parselin İşlemlerinde Halihazırda Bir İşlemi Mevcut ise
+    // [* Yani İşlem Tablosunda ParselID(tasinmazID) deki İşlemlerin GlobalID'leri Tek Tek (şimdilik globalidye bakıcam
+    // sonrasında id fieldına göre bakılacak) İşlem-Malik Tablosunda Sorgulanacak Var İse İşlem-Malik Tablosundaki
+    // malikID ile İşlem Ekleme Penceresindeki Malik Seçimi Tablosunda Tiklenen MalikID Eşleşiyorsa Uyarı Verilecek *]
+    // O Malikin Halihazırdaki İşlemi Üzerinden Devam Etmesi İçin Dosya No Bilgisi ile Birlikte Uyarı Verilecek
+    // [* Bu Yüzden Her Halükarda İşlemler Tablosuna Tekrar Sadece Dosya No Bilgisi İçin İstek Atılmaması İçin
+    // İşlem Tablosuna Atılan İlk İstekte Alınan GlobalID nin Yanında DosyaNo Bilgisi De Tutulacak*]
+    // SOR?? VEYA İŞLEMLER TABLOSUNA TEKRAR İSTEK ATMAMAK İÇİN İŞLEM-MALİK TABLOSUNA DOSYANO FIELDI EKLENEBİLİR Mİ ?
+
+    let parselID;
+    if (this.isMulti) {
+      parselID = this.dialogConfig.data['featureDatas'][0]['selectedGraphics'][0]['graphic']['attributes']['tasinmaz_id'];
+    } else {
+      parselID = this.dialogConfig.data['feature']['attributes']['tasinmaz_id'];
+    }
+
+    const malikID = event.data['globalid'];
+    const isTicked = event.node.isSelected();
+    const infoAttributes = this.infoAttributes;
+    let dosyaNoState = false;
+    let malikKisitlamasiState = this.kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruState;
+    let talepTuru;
+
+    if (infoAttributes !== undefined) {
+      if (infoAttributes['dosya_no'] !== undefined || infoAttributes['dosya_no'] !== null) {
+        dosyaNoState = true;
+
+        talepTuru = infoAttributes['talep_turu'];
+      }
+    } else {
+      const talepTuruControl = this.formGroup.controls['talep_turu'];
+      if (talepTuruControl !== undefined) {
+        talepTuru = talepTuruControl.value;
       }
     }
 
-    selectionData.count = rows.length;
-    selectionData.maliye_area = Number(maliyeArea.toFixed(2));
-    selectionData.other_area = Number(otherArea.toFixed(2));
+    if (talepTuru !== undefined) {
+      this.kamulastirmaDavalariIslemiMalikSecimKisitlamasiUygulanacakTalepTuruState = true;
+      malikKisitlamasiState = true;
+    }
+
+    if (isTicked && malikKisitlamasiState) {
+      const promise = this.ifMalikHasAlreadyInOtherProcess(parselID, malikID).then(res => {
+
+        if (res !== -1 && res !== undefined) {
+          const dosyaNo = res['dosya_no'];
+          let selectedMalikInExactProcessState = false;
+
+          // Seçilmiş İşlemin Dosya Numarası Varsa Ve Bu Dosya Numarası İle Seçilen Malikin Bulunduğu Dosya Numarası Eşitse
+          // O Malik Eklenip Çıkarılabilir.
+          if (dosyaNo !== undefined) {
+            if (dosyaNoState) {
+              const dosyaNoIncludingSelectedMalik = dosyaNo;
+              const dosyaNoOfExactProcess = this.infoAttributes['dosya_no'];
+
+              if (dosyaNoIncludingSelectedMalik === dosyaNoOfExactProcess) {
+                selectedMalikInExactProcessState = true;
+              }
+            }
 
-    this.formGroup.controls['alan'].patchValue(shareArea.toFixed(2));
+            if (!selectedMalikInExactProcessState) {
+              // TODO UYARI VERİLECEK
+              event.node.setSelected(false);
+              this.malikHasAlreadyAddedState = true;
+              const warningText = `Seçilen Malik Halihazırda Davalıktır. Lütfen #${dosyaNo} Numaralı 
+                Dosya Üzerinden İşlemi Devam Ettiriniz`;
+              this.notify.open(warningText, 'danger', 5);
+            } else {
+              this.setMalikCalculations(rows);
+            }
+          }
+        } else {
+          this.setMalikCalculations(rows);
+        }
+      });
+    } else {
+      this.setMalikCalculations(rows);
+    }
 
-    this.checkAndUpdateCalculateFuntions(this.moduleData, this.formGroup);
   }
 
   getMalikIds(url: string, where: string) {
@@ -1724,73 +2866,200 @@ export class CreateModuleComponent implements OnInit, OnDestroy {
     const malikName = this.createColDef('Ad', 'ad', 'agTextColumnFilter');
     const malikSurname = this.createColDef('Soyad', 'soyad', 'agTextColumnFilter');
     const malikArea = this.createColDef('Yüzölçüm', 'hisse_yuz_olcum', 'agNumberColumnFilter');
+    const dosyaNo = this.createColDef('Dosya No', 'dosya_no', 'agNumberColumnFilter');
+    const mirasci = this.createColDef('Mirasçı Ekle', 'mirasci', '');
+    const mirasciDetay = this.createColDef('Mirasçı Detay', 'mirasci_detay', '');
+    dosyaNo.valueGetter = (params) => {
+      const foundMalik = this.malikListWithDosyaNo.find(malik => malik['malik_id'] === params.data['globalid']);
+      if (foundMalik) {
+
+        return foundMalik['dosya_no'];
+      }
+    };
 
-
-    colDefs.push(checkbox, malikTC, malikName, malikSurname, malikArea);
+    colDefs.push(checkbox, malikTC, malikName, malikSurname, malikArea, dosyaNo, mirasci, mirasciDetay);
     return colDefs;
   }
 
+  getMirasciFields() {
+    // BURASI MİRASÇI TABLOSU URL İ OLACAK
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/5/query', {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson',
+      }
+    }).pipe(map(response => response['fields']));
+  }
+
+  onOpenMirasciDetail(params: any) {
+    this.mirasciState = true;
+    const tasinmazID = this.dialogConfig.data['feature']['attributes']['tasinmaz_id'];
+    // BURASI MİRASÇI TABLOSU URL İ OLACAK
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/4/query';
+    let isInfo = 1;
+    const queryProperties = <esri.QueryProperties>{
+      outFields: ['*'],
+      where: `tasinmaz_id='${tasinmazID}' and hisseid='${params['globalid']}'`,
+    };
+    const progress = this.dialogService.openUnClosable(ProgressInfoComponent, 'Mirasçı Detayı Alınıyor', false, {}, false, 'light');
+
+    this.getFeatures(url, queryProperties).subscribe(res => {
+      if (res.features.length > 0) {
+        progress.close();
+
+        this.mirasciDetailDialogRef = this.dialogService.open(MirasciComponent, 'Mirasçı Detayı', false, {
+          data: {
+            isInfo: 1,
+            featuresInfo: res.features
+          }
+        }, false, 'light');
+
+        this.mirasciDetailDialogRef.afterClosed.subscribe((closeParams: boolean) => {
+          if (closeParams === true) {
+            this.agGrid.api.purgeInfiniteCache();
+          }
+          this.mirasciDetailDialogRef = undefined;
+        });
+      }
+    });
+
+    setTimeout(() => {
+      this.mirasciState = false;
+    });
+  }
+
+  onOpenAddMirasci(params: any) {
+    this.mirasciState = true;
+    const tasinmazID = this.dialogConfig.data['feature']['attributes']['tasinmaz_id'];
+
+    let mirasciDialogRef = this.dialogService.open(MirasciComponent, 'Mirasçı Ekle', false, {
+      data: {
+        malikInfo: params,
+        tasinmazID: tasinmazID,
+        isInfo: -1
+      }
+    }, false, 'light');
+
+    mirasciDialogRef.afterClosed.subscribe((closeParams: boolean) => {
+      if (closeParams === true) {
+        this.agGrid.api.purgeInfiniteCache();
+      }
+      mirasciDialogRef = undefined;
+    });
+
+    setTimeout(() => {
+      this.mirasciState = false;
+    });
+  }
+
   createColDef(headerName: string, fieldName: string, filterType: 'agNumberColumnFilter' | 'agTextColumnFilter' | '', checkbox = false) {
     if (checkbox !== false) {
       return <ColDef>{
         headerName: headerName,
         colId: fieldName,
         field: fieldName,
-        headerCheckboxSelection: true,
+        cellRendererParams: {
+          checkbox: true
+        },
+        headerCheckboxSelection: params => {
+          if (!this.malikChangeState) {
+            return false;
+          } else {
+            this.headerCheckboxSelectionState = true;
+            return true;
+          }
+        },
         headerCheckboxSelectionFilteredOnly: true,
-        checkboxSelection: true
-      };
-    } else {
-      return <ColDef>{
-        headerName: headerName,
-        colId: fieldName,
-        field: fieldName,
-        filter: filterType,
-        filterParams: {
-          textCustomComparator: (filter: string, value: string, filterText: string) => {
-            // @ts-ignore
-            const filterTextLowerCase = filterText.toLocaleLowerCase('tr-TR');
-            // @ts-ignore
-            const valueLowerCase = value.toLocaleLowerCase('tr-TR');
-
-            switch (filter) {
-              case 'contains':
-                return valueLowerCase.indexOf(filterTextLowerCase) >= 0;
-              case 'notContains':
-                return valueLowerCase.indexOf(filterTextLowerCase) === -1;
-              case 'equals':
-                return valueLowerCase === filterTextLowerCase;
-              case 'notEqual':
-                return valueLowerCase !== filterTextLowerCase;
-              case 'startsWith':
-                return valueLowerCase.indexOf(filterTextLowerCase) === 0;
-              case 'endsWith':
-                const index = valueLowerCase.lastIndexOf(filterTextLowerCase);
-                return index >= 0 && index === (valueLowerCase.length - filterTextLowerCase.length);
-              default:
-                // should never happen
-                console.warn('invalid filter type ' + filter);
-                return false;
-            }
-          },
-          caseSensitive: true
+        checkboxSelection: true,
+        valueFormatter: (params) => {
+          if (!this.malikChangeState) {
+            params.colDef.checkboxSelection = false;
+            this.suppressRowClickSelection = true;
+          }
         }
       };
+    } else {
+      if (fieldName === 'mirasci') {
+        return <ColDef>{
+          headerName: headerName,
+          colId: fieldName,
+          cellRendererFramework: RendererComponent,
+          cellRendererParams: { title: 'Mirasçı Ekle', Component: this },
+          field: fieldName,
+          filter: false,
+          sortable: false,
+          width: 120
+        };
+      } else if (fieldName === 'mirasci_detay') {
+        return <ColDef>{
+          headerName: headerName,
+          colId: fieldName,
+          cellRendererFramework: RendererComponent,
+          cellRendererParams: { title: 'Mirasçı Detay', Component: this },
+          field: fieldName,
+          filter: false,
+          sortable: false,
+          width: 120
+        };
+      }
+      else {
+        return <ColDef>{
+          headerName: headerName,
+          colId: fieldName,
+          field: fieldName,
+          filter: filterType,
+          filterParams: {
+            textCustomComparator: (filter: string, value: string, filterText: string) => {
+              // @ts-ignore
+              const filterTextLowerCase = filterText.toLocaleLowerCase('tr-TR');
+              // @ts-ignore
+              const valueLowerCase = value.toLocaleLowerCase('tr-TR');
+
+              switch (filter) {
+                case 'contains':
+                  return valueLowerCase.indexOf(filterTextLowerCase) >= 0;
+                case 'notContains':
+                  return valueLowerCase.indexOf(filterTextLowerCase) === -1;
+                case 'equals':
+                  return valueLowerCase === filterTextLowerCase;
+                case 'notEqual':
+                  return valueLowerCase !== filterTextLowerCase;
+                case 'startsWith':
+                  return valueLowerCase.indexOf(filterTextLowerCase) === 0;
+                case 'endsWith':
+                  const index = valueLowerCase.lastIndexOf(filterTextLowerCase);
+                  return index >= 0 && index === (valueLowerCase.length - filterTextLowerCase.length);
+                default:
+                  // should never happen
+                  console.warn('invalid filter type ' + filter);
+                  return false;
+              }
+            },
+            caseSensitive: true
+          }
+        };
+      }
     }
   }
 
-  downloadFile() {
+  downloadFile(event: Event) {
+    const target = event.target as HTMLButtonElement;
+    const buttonNameArray = target.name.split('_');
+    const indexOfDownloadButton = buttonNameArray[1];
+
     const infoAttributes = this.infoAttributes;
     const objectId = <number>infoAttributes.objectid;
 
     const attachmentInfos = this.attachmentData;
-    const attachment = attachmentInfos[0];
+    const attachment = attachmentInfos[indexOfDownloadButton];
 
     const attachmentName = attachment.name;
     const attachmentId = attachment.id;
     const contentType = attachment.contentType;
 
-    const url = `${environment.arcgisMEBURL}FeatureServer/14/${objectId}/attachments/${attachmentId}` +
+    // const url = `${environment.arcgisMEBURL}FeatureServer/14/${objectId}/attachments/${attachmentId}` +
+    //   `?token=${sessionStorage.getItem('CBSArcToken')}`;
+    const url = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/${objectId}/attachments/${attachmentId}` +
       `?token=${sessionStorage.getItem('CBSArcToken')}`;
     this.http.get(url, { responseType: 'blob' }).subscribe((data: Blob) => {
 
diff --git a/src/app/modules/module-list/module-list.component.ts b/src/app/modules/module-list/module-list.component.ts
index d5bc6204bc1a0832b2a18ecf6d9f2f25fbf6b7a7..dbcef4c42e5c2415ca4946d4f9d36a595e01e98f 100644
--- a/src/app/modules/module-list/module-list.component.ts
+++ b/src/app/modules/module-list/module-list.component.ts
@@ -80,10 +80,16 @@ export class ModuleListComponent implements OnInit, OnDestroy {
       this.getRequiredFields(featureData, layerWhereField).then(feature => {
         this.requiredFields = feature;
         const whereValue = feature.getAttribute(layerWhereField);
-        this.getLayerFields().subscribe(fields => {
+        this.getTestLayerFields().subscribe(fields => {
           this.fields = fields;
+          // GAGA BURAYA DOSYANO EKLEENECEK
+          // const showFields = ['objectid', 'islem_turu', 'islem_tarihi', 'sayi',
+          //   'talep_turu', 'alt_konu', 'touch_by', 'touch_date', 'create_date'];
+          // this.showFields = showFields;
+
+          //TODO: GAGA BURADAN e_yatirim_proje_no  KALDIRILACAK YERİNE ÇOKLUSEÇİM İLE EKLENENLERE ÖZEL ID FİELDI GETİRİLECEK
           const showFields = ['objectid', 'islem_turu', 'islem_tarihi', 'sayi',
-            'talep_turu', 'alt_konu', 'touch_by', 'touch_date', 'create_date'];
+            'talep_turu', 'alt_konu', 'touch_by', 'touch_date', 'create_date', 'ucret', 'dosya_no', 'e_yatirim_proje_no'];
           this.showFields = showFields;
 
           let colDefs = this.createColumnDefinitions(fields, showFields);
@@ -172,6 +178,7 @@ export class ModuleListComponent implements OnInit, OnDestroy {
   initializeLastMovement(whereField: string, layerWhereField: string, featureData: any) {
     this.rowsInfoArray = [];
     const movementLayer = <esri.FeatureLayer>this.mapView.map.layers.find(layer => layer.title === 'Hareket');
+    const processLayer = <esri.FeatureLayer>this.mapView.map.layers.find(layer => layer.title === 'İslem');
     const processMovementLayer = <esri.FeatureLayer>this.mapView.map.layers.find(layer => layer.title === 'İslem_Hareket');
     const durumuField = movementLayer.fields.find(field => (field.name === 'durumu' || field.name === 'h_durumu'));
     if (durumuField !== null) {
@@ -185,19 +192,41 @@ export class ModuleListComponent implements OnInit, OnDestroy {
       outFields: ['i_objectid', 'h_durumu']
     };
 
+    const queryProp2: esri.QueryProperties = {
+      where: `touch_by='goksuvat'`,
+      returnGeometry: false,
+      outFields: ['objectid', 'durumu']
+    };
+
     processMovementLayer.queryFeatures(queryProp).then(response => {
-      response.features.forEach(feature => {
-        const rowInfo = new EmitObjectForLastMovement();
-        const attributes = feature.attributes;
-        const hDurumu = attributes['h_durumu'];
-        if (hDurumu === null) {
-          rowInfo.lastMovement = '';
-        } else {
-          const codeValue = this.hDurumuDomains.find(domain => domain.code === Number(hDurumu));
-          rowInfo.lastMovement = codeValue['name'];
-        }
-        rowInfo.objectId = attributes['i_objectid'];
-        this.rowsInfoArray.push(rowInfo);
+      processLayer.queryFeatures(queryProp2).then(res => {
+        response.features.forEach(feature => {
+          const rowInfo = new EmitObjectForLastMovement();
+          const attributes = feature.attributes;
+          const hDurumu = attributes['h_durumu'];
+          if (hDurumu === null) {
+            rowInfo.lastMovement = '';
+          } else {
+            const codeValue = this.hDurumuDomains.find(domain => domain.code === Number(hDurumu));
+            rowInfo.lastMovement = codeValue['name'];
+          }
+          rowInfo.objectId = attributes['i_objectid'];
+          this.rowsInfoArray.push(rowInfo);
+        });
+
+        res.features.forEach(feat => {
+          const rowInfo = new EmitObjectForLastMovement();
+          const attributes = feat.attributes;
+          const hDurumu = attributes['durumu'];
+          if (hDurumu === null) {
+            rowInfo.lastMovement = '';
+          } else {
+            const codeValue = this.hDurumuDomains.find(domain => domain.code === Number(hDurumu));
+            rowInfo.lastMovement = codeValue['name'];
+          }
+          rowInfo.objectId = attributes['objectid'];
+          this.rowsInfoArray.push(rowInfo);
+        });
       });
     });
   }
@@ -228,7 +257,8 @@ export class ModuleListComponent implements OnInit, OnDestroy {
       whereValue = `'${whereValue}'`;
     }
 
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
       where: `${whereField} = ${whereValue}`,
@@ -418,7 +448,8 @@ export class ModuleListComponent implements OnInit, OnDestroy {
 
   openModuleDetail(params: any) {
     const objectid = params.data.objectid;
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
       where: `objectid = ${objectid}`,
@@ -431,6 +462,7 @@ export class ModuleListComponent implements OnInit, OnDestroy {
 
       const islem_turu = <number>foundFeature.attributes['islem_turu'];
       if (islem_turu !== undefined) {
+
         const domain = this.getFieldDomain('islem_turu');
         if (domain.type === 'codedValue') {
           const codedValueDomain = <esri.CodedValueDomain>domain;
@@ -449,7 +481,9 @@ export class ModuleListComponent implements OnInit, OnDestroy {
                 moduleRefField: moduleRefField,
                 type: foundCodedValue.name,
                 feature: this.featureData,
-                moduleData: foundFeature.attributes
+                moduleData: foundFeature.attributes,
+                objectId: objectid,
+                mapView: this.mapView
               }
             }, false, 'light');
 
@@ -591,6 +625,15 @@ export class ModuleListComponent implements OnInit, OnDestroy {
     };
   }
 
+  getTestLayerFields() {
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1', {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson',
+      }
+    }).pipe(map(response => response['fields']));
+  }
+
   getLayerFields() {
     return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 14, {
       params: {
diff --git a/src/app/modules/module-list/multi-module-list/multi-module-list.component.ts b/src/app/modules/module-list/multi-module-list/multi-module-list.component.ts
index baa3ef8dda34a2c590e79363c244d9941ff4ab42..f8295058b45f7faf8e676502a3dad67d3a770fa5 100644
--- a/src/app/modules/module-list/multi-module-list/multi-module-list.component.ts
+++ b/src/app/modules/module-list/multi-module-list/multi-module-list.component.ts
@@ -30,6 +30,7 @@ interface DialogRefData {
     moduleField?: string;
     layerField?: string;
   }>;
+  mapView: esri.MapView;
 }
 
 @Component({
@@ -53,12 +54,16 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
   fields: Promise<Array<esri.Field>>;
   // fields: Array<esri.Field> = [];
   uniqueExtraFields: string[];
+
+  mapView: esri.MapView;
+
   constructor(private dialogConfig: DialogConfig, private dialogRef: DialogRef,
     private dialogService: DialogService, private http: HttpClient, private webDataService: WebDataService) { }
 
   ngOnInit() {
     const data: DialogRefData = this.dialogConfig.data;
     this.multiModuleData = data;
+    this.mapView = data.mapView;
     this.modules = this.webDataService.getModules().toPromise();
     this.fields = this.getLayerFields();
     const featureDatas = data.featureDatas;
@@ -91,8 +96,10 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
     const uniqueExtraFields = extraFields.filter((v, i) => extraFields.indexOf(v) === i);
     this.uniqueExtraFields = uniqueExtraFields;
     const fieldFormData = new FormData();
-    const islemUrl = `${environment.arcgisMEBURL}FeatureServer/14`;
+    // const islemUrl = `${environment.arcgisMEBURL}FeatureServer/14`;
+    const islemUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1';
     fieldFormData.append('f', 'json');
+    fieldFormData.append('token', sessionStorage.getItem('CBSArcToken'));
     this.http.post(islemUrl, fieldFormData, {}).subscribe((islemResponse: any) => {
       const showFields = ['objectid', 'islem_turu', 'islem_tarihi', 'sayi',
         'talep_turu', 'alt_konu', 'touch_by', 'touch_date'];
@@ -188,7 +195,8 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
 
   setDataSourceOfGrid(whereQuery) {
 
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
       where: whereQuery,
@@ -302,7 +310,8 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
 
   openModuleDetail(params: any) {
     const objectid = params.data.objectid;
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
       where: `objectid = ${objectid}`,
@@ -414,7 +423,8 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
     this.movementListRef = this.dialogService.open(MovementListComponent, 'Hareketler', true, {
       data: {
         moduleData: params.data,
-        featureData: this.featureData
+        featureData: this.featureData,
+        mapView: this.mapView
       }
     }, false, 'light');
   }
@@ -512,7 +522,8 @@ export class MultiModuleListComponent implements OnInit, OnDestroy {
   }
 
   getLayerFields() {
-    return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 14, {
+    // return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 14, {
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1', {
       params: {
         token: sessionStorage.getItem('CBSArcToken'),
         f: 'pjson',
diff --git a/src/app/modules/module-list/rendererClass/renderer.component.ts b/src/app/modules/module-list/rendererClass/renderer.component.ts
index fc5e6225647475aead892597487ed4c22f1e8522..7e08ecf40c322ffecb71b01fcc2f22a4db289390 100644
--- a/src/app/modules/module-list/rendererClass/renderer.component.ts
+++ b/src/app/modules/module-list/rendererClass/renderer.component.ts
@@ -128,7 +128,9 @@ export class RendererComponent implements ICellRendererAngularComp {
 
             // Önceden sadece Gerçekleşti Hareketinde Belge Vardı. Artık Bina Değişiklik Olumlu Hareketinden Sonra da Olacak.
             if (ifAttachment !== undefined || binaDegisiklikOlumluDurumu) {
-                const url = `${environment.arcgisMEBURL}/FeatureServer/${id}/${objectId}/attachments?f=pjson` +
+                // const url = `${environment.arcgisMEBURL}/FeatureServer/${id}/${objectId}/attachments?f=pjson` +
+                //     `&token=${sessionStorage.getItem('CBSArcToken')}`;
+                const url = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${objectId}/attachments?f=pjson` +
                     `&token=${sessionStorage.getItem('CBSArcToken')}`;
                 this.http.get(url).subscribe(res => {
                     const attachmentInfos = <Array<esri.AttachmentInfo>>res['attachmentInfos'];
@@ -180,6 +182,10 @@ export class RendererComponent implements ICellRendererAngularComp {
             this.params.context.componentParent.onGetMalikSBIByHisseId(this.params.data);
         } else if (this.params.title === 'Hareket Detay') {
             this.params.context.componentParent.openMovementDetail(this.params.data);
+        } else if (this.params.title === 'Mirasçı Ekle') {
+            this.params.Component.onOpenAddMirasci(this.params.data);
+        } else if (this.params.title === 'Mirasçı Detay') {
+            this.params.Component.onOpenMirasciDetail(this.params.data);
         }
     }
 
@@ -198,18 +204,22 @@ export class RendererComponent implements ICellRendererAngularComp {
         const attachmentId = attachment.id;
         const contentType = attachment.contentType;
 
-        const url = `${environment.arcgisMEBURL}FeatureServer/${id}/${objectId}/attachments/${attachmentId}` +
+        // const url = `${environment.arcgisMEBURL}FeatureServer/${id}/${objectId}/attachments/${attachmentId}` +
+        //     `?token=${sessionStorage.getItem('CBSArcToken')}`;
+        const url = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${objectId}/attachments/${attachmentId}` +
             `?token=${sessionStorage.getItem('CBSArcToken')}`;
 
         this.http.get(url, { responseType: 'blob' }).subscribe((data: Blob) => {
-
-            const downloadURL = window.URL.createObjectURL(data);
-            const anchor = document.createElement('a');
-            anchor.href = downloadURL;
-            anchor.target = '_blank';
-            anchor.download = attachmentName;
-
-            anchor.click();
+            for (let i = 0; i < attachmentInfos.length; i++) {
+                const attachment = attachmentInfos[i];
+                const downloadURL = window.URL.createObjectURL(data);
+                const anchor = document.createElement('a');
+                anchor.href = downloadURL;
+                anchor.target = '_blank';
+                anchor.download = attachment.name;
+
+                anchor.click();
+            }
         });
     }
 }
diff --git a/src/app/movements/movement-create/MultiSelectMovement.ts b/src/app/movements/movement-create/MultiSelectMovement.ts
new file mode 100644
index 0000000000000000000000000000000000000000..658f54e128eed73f7211b4d5edaf6487b90cfd26
--- /dev/null
+++ b/src/app/movements/movement-create/MultiSelectMovement.ts
@@ -0,0 +1,4 @@
+export interface MultiSelectMovement {
+    feature: any;
+    movementData: any;
+}
diff --git a/src/app/movements/movement-create/movement-create.component.css b/src/app/movements/movement-create/movement-create.component.css
index e0aa8fb3b24ada65fea097729e16f40cc259c9a6..d30fe2f5fac1cc1908dde205de295a8244a8d4e6 100644
--- a/src/app/movements/movement-create/movement-create.component.css
+++ b/src/app/movements/movement-create/movement-create.component.css
@@ -83,6 +83,25 @@
   padding-bottom: 5px;
 }
 
+.icra-movement {
+  display: flex;
+  flex-direction: column
+}
+
+.icra-movement label {
+  font-size: 14px;
+  padding-bottom: 5px;
+}
+
+.icra-movement input {
+  padding: 0.2rem .75rem;
+  color: #495057;
+  border: 1px solid #ced4da;
+  border-radius: .25rem;
+  height: 17.5px;
+  transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
+}
+
 .form-group input:focus {
   border-color: #80bdff;
   outline: 0;
@@ -95,3 +114,18 @@
   outline: 0;
   box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
 }
+
+.file-container {
+  display: flex;
+  align-items: baseline;
+  justify-content: space-between;
+  width: 100%;
+}
+
+.file-container .file-formdata {
+  width: 90%;
+}
+
+.form-group:nth-of-type(even) .file-formdata {
+  margin-left: -5px;
+}
diff --git a/src/app/movements/movement-create/movement-create.component.html b/src/app/movements/movement-create/movement-create.component.html
index def3991203f82db7d5ed0676bcb6eadf4a4df1e0..c756a53e01843d12825b9fd6f1ea4cdbc9d20958 100644
--- a/src/app/movements/movement-create/movement-create.component.html
+++ b/src/app/movements/movement-create/movement-create.component.html
@@ -1,19 +1,28 @@
 <div class="modal-content">
   <form [formGroup]="formGroup" class="module-form" (ngSubmit)="onSubmit()">
+    <div class="icra-movement"
+      *ngIf="yeniIslemPenceresiAcilacakDomainList.includes(features['durumu']) || yeniIslemPenceresiAcilacakDomainList.includes(durumu)">
+      <label>Dosya No</label>
+      <input [value]="moduleData['dosya_no']" disabled>
+      <label>Esas No</label>
+      <input [value]="moduleData['esas_no']" disabled>
+    </div>
     <div class="form-group" *ngFor="let formData of movementFormData;let i = index">
-      <label>{{formData.alias}}<ng-container *ngIf="formData.required">*</ng-container></label>
+      <label *ngIf="formData.type !== 'file'">{{formData.alias}}<ng-container *ngIf="formData.required">*</ng-container></label>
       <input
-        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file' ) && formData.name !== 'aciklama' && readMode)"
+        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file') && formData.name !== 'aciklama' && readMode)"
         [name]="formData.name" [type]="formData.type" [formControlName]="formData.name"
         (input)="onChangeFormControl($event)" [disabled]="formData.disabled">
-      <textarea *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file') && formData.name === 'aciklama' && readMode )"
+      <textarea
+        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file') && formData.name === 'aciklama' && readMode )"
         [name]="formData.name" [formControlName]="formData.name" (input)="onChangeFormControl($event)"
         [disabled]="formData.disabled"></textarea>
-      <input *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain') && formData.name !== 'aciklama' && !readMode)"
+      <input
+        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file') && formData.name !== 'aciklama' && !readMode)"
         [name]="formData.name" [type]="formData.type" [formControlName]="formData.name"
         (input)="onChangeFormControl($event)" [disabled]="formData.disabled">
       <textarea
-        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain') && formData.name === 'aciklama' && !readMode )"
+        *ngIf="(!(formData.type === 'domain' || formData.type === 'localDomain' || formData.type === 'file') && formData.name === 'aciklama' && !readMode )"
         [name]="formData.name" [formControlName]="formData.name" (input)="onChangeFormControl($event)"
         [disabled]="formData.disabled"></textarea>
       <select *ngIf="formData.type === 'domain' || formData.type === 'localDomain'" [name]="formData.name"
@@ -22,12 +31,21 @@
         <option *ngFor="let domainValue of formData.domain_values" [value]="domainValue.value">{{domainValue.name}}
         </option>
       </select>
-      <label
-        *ngIf="formData.type ==='file' && this.fileReadMode && attachmentData !== undefined && attachmentData[0] !== undefined && attachmentData[0].name !== undefined">
-        {{attachmentData[0].name}}</label>
+      <div *ngIf="formData.type === 'file' && !readMode" class="file-container">
+        <div class="file-formdata">
+          <label>{{formData.alias}}<ng-container *ngIf="formData.required">*
+            </ng-container></label>
+          <input [name]="formData.name" [type]="formData.type" [formControlName]="formData.name"
+            (input)="onChangeFormControl($event)" multiple="multiple">
+        </div>
+      </div>
+      <div  *ngIf="formData.type ==='file' && this.fileReadMode && attachmentData !== undefined && attachmentData[0] !== undefined && attachmentData[0].name !== undefined">
+        <label *ngFor="let attachment of attachmentData; index as i">
+          {{attachmentData[i].name}}</label>
+      </div>
     </div>
     <div class="form-group">
-      <input *ngIf="createMode" type="submit" value="Kaydet" [disabled]="formGroup.invalid">
+      <input *ngIf="createMode && durumu !== 39" type="submit" value="Kaydet" [disabled]="formGroup.invalid">
       <input *ngIf="editMode === true" type="submit" value="Düzenle" [disabled]="formGroup.invalid">
       <ng-container *ngIf="editMode === true && isMovementDeletableByTheUser">
         <input [disabled]="!isMovementRelationAllowsToDelete" type="button" (click)="onDeleteMovement()" value="Sil"
@@ -38,4 +56,4 @@
       </ng-container>
     </div>
   </form>
-</div>
+</div>
\ No newline at end of file
diff --git a/src/app/movements/movement-create/movement-create.component.ts b/src/app/movements/movement-create/movement-create.component.ts
index a5c075587d123ebc5712154157760d7e9dc7f26b..38e4b1b0c294c336a9e005b1c41d3d6bf17d29d2 100644
--- a/src/app/movements/movement-create/movement-create.component.ts
+++ b/src/app/movements/movement-create/movement-create.component.ts
@@ -7,7 +7,7 @@ import { HttpClient } from '@angular/common/http';
 import { MovementData } from 'src/app/models/movement/movement-data';
 import { FormData, ModuleFormData } from 'src/app/models/Modules/module-form-data';
 import { ProgressInfoComponent } from 'src/app/progress-info/progress-info.component';
-import { Observable } from 'rxjs';
+import { forkJoin, observable, Observable } from 'rxjs';
 import { environment } from 'src/environments/environment';
 import { LoginResponse } from 'src/app/models/Login/login-response';
 import esri = __esri;
@@ -15,7 +15,7 @@ import { map } from 'rxjs/operators';
 import { NotificationService } from 'src/app/notification/notification.service';
 import { AcceptDialogComponent } from 'src/app/accept-dialog/accept-dialog.component';
 import { CreateModuleComponent } from 'src/app/modules/create-module/create-module.component';
-import { FieldValues, ProcessMovementRel } from 'src/app/models/ProcessMovementRel';
+import { FieldValues, MovementRel, MovementValues, ProcessMovementRel } from 'src/app/models/ProcessMovementRel';
 
 interface DeleteResults {
   deleteResults: {
@@ -51,6 +51,8 @@ export class MovementCreateComponent implements OnInit {
   createMode = false;
   readMode = false;
   updateMode = false;
+  isContainsDosyaNo = false;
+  isContainsEsasNo = false;
 
   acceptanceDialog: DialogRef;
   _loginResponse: LoginResponse;
@@ -62,12 +64,25 @@ export class MovementCreateComponent implements OnInit {
   mapView: esri.MapView;
   foundModuleForm: ModuleFormData;
   defaultDomainValues: any;
+  durumu: number;
+  yeniIslemPenceresiAcilacakDomainList = [39, 40];
+  moduleRefId: number;
+  moduleWhereField: string;
+  attachmentDataArray = [];
+
+  multiSelectAcceptanceDialog: DialogRef;
+  msMovementsIdenticalState = false;
+  msAllMovementList = [];
+  progressDialog: DialogRef;
+  toBeUpdatedParselIDList = [];
+  updatedParselIDList = [];
+  notUpdatedParselIDList = [];
 
   constructor(public dialogConfig: DialogConfig, public dialog: DialogRef,
     private http: HttpClient, private formBuilder: FormBuilder,
     private dialogService: DialogService, private notify: NotificationService) { }
 
-  ngOnInit() {
+  async ngOnInit() {
     this.initUserInfo();
     const data = this.dialogConfig.data;
     this.isMovementDeletableByTheUser = this._loginResponse.unique_name === this._loginResponse.unique_name;
@@ -83,12 +98,15 @@ export class MovementCreateComponent implements OnInit {
     const moduleData = data.moduleData;
     this.moduleData = moduleData;
 
-    const foundModuleForm: ModuleFormData = data['foundModuleForm'];
+    let foundModuleForm: ModuleFormData = data['foundModuleForm'];
     this.foundModuleForm = foundModuleForm;
 
     const movementData = <MovementData>data.movementData;
     this.defaultDomainValues = movementData.field.domain_values;
 
+    this.moduleWhereField = data['moduleWhereField'];
+    this.moduleRefId = data['moduleRefId'];
+
     // ÖNEMLİ SİLME PLAN HAREKETİ TALEP TÜRÜNE GÖRE DEĞİŞİM REVİZYON ADDORREMOVEMOVEMENTS
     // SONRASINDA KAMULAŞTIRMADAKİ DEĞİŞİKLİKLERE DE EKLENECEK
     // Hiç hareket olmadığı durumda (this.features boş ise) Plan işleminde domainler 6 ve 7 değilse son 3 domain (9,36,37) silinmeli.
@@ -101,6 +119,14 @@ export class MovementCreateComponent implements OnInit {
     //   }
     // }
 
+    if (this.moduleData['dosya_no'] !== null) {
+      this.isContainsDosyaNo = true;
+    }
+
+    if (this.moduleData['e_yatirim_proje_no'] !== null) {
+      this.isContainsEsasNo = true;
+    }
+
     if (this.moduleData['islem_turu'] === 8) { // Kamulaştırma'da (type:8) talep türüne göre hareketler değişmeli
       // Talep türü Uzlaşma Dilekçesi(10) veya Diğer(12) ise hareketler değişecek
       const talepTuru = this.moduleData['talep_turu'];
@@ -130,56 +156,81 @@ export class MovementCreateComponent implements OnInit {
         }
       }
     }
+
+    if (foundModuleForm === undefined) {
+      await this.getType().toPromise().then(processRes => {
+        foundModuleForm = processRes.find(process => process.value === moduleData['islem_turu']);
+        this.foundModuleForm = foundModuleForm;
+      });
+    }
+
     // FoundModuleForm Şuan Sadece Plan Hareketleri Düzenlemeleri İçin Kullanılmaktadır.
-    if (foundModuleForm !== undefined) {
+    if (this.moduleData['islem_turu'] === 5) {
       this.processMovementRelationOperation(foundModuleForm, movementData);
-    } else {
-      this.getType().subscribe(processRes => {
-        console.log(processRes);
-        const foundProcessModule: ModuleFormData = processRes.find(process => process.value === moduleData['islem_turu']);
-        this.processMovementRelationOperation(foundProcessModule, movementData);
-      });
-      // UNDEFİNEDSA İŞLEMLER RAPORUNDAN MODULE SEÇMEMİŞ DEMEKTİR DİREKT LİSTEDEN MODULE LİSTELEMEDEN İŞLEME TIKLAMIŞ
-      // YA DA PARSELLERDEN İŞLEMLER BUTONUNA TIKLAMIŞ DEMEKTİR.
-      // BU DURUMDA GETTYPE İLE PROCESSDATA ALINACAK.
     }
+    // UNDEFİNEDSA İŞLEMLER RAPORUNDAN MODULE SEÇMEMİŞ DEMEKTİR DİREKT LİSTEDEN MODULE LİSTELEMEDEN İŞLEME TIKLAMIŞ
+    // YA DA PARSELLERDEN İŞLEMLER BUTONUNA TIKLAMIŞ DEMEKTİR.
+    // BU DURUMDA GETTYPE İLE PROCESSDATA ALINACAK.
 
-    this.movementData = movementData;
+    this.getAllMovements().subscribe(allMovements => {
+      // Karar Hareketi Girilmişse Tekrar Karar Hareketi Giremez.
+      // Karar Hareketi Girilmeden Yeni Esas ve İcra Hareketi de Giremez.
+      const kararMovement = allMovements.find(feature => feature.attributes['durumu'] === 'Karar');
 
-    const whereField = <string>data.moduleWhereField;
-    this.refField = whereField;
-    const moduleRefId = <number>data.moduleRefId;
-    this.refValue = moduleRefId;
+      if (!kararMovement) {
+        // TODO: Karar Hareketi Girilmemişse Hareket Listesinde Karar Hareketi Olacak. Karar Hareketi Olmadığı İçin de Yeni Esas Giremezz
+        // Bu yüzden Karar Hareketi Girilmemişse Yeni Esas Hareketi Kaldırılacak.
 
-    this.createMode = data.createMode;
-    this.readMode = data.readMode;
-    this.updateMode = data.updateMode;
 
-    if (this.updateMode) {
-      const prevNextFeatures = data.prevNextFeatures;
+      } else {
+        // TODO: Karar Hareketi Girilmişse Yeni Esas Hareketi Girebilecek.
+        // TODO: Karar Hareketi Girilmişse Karar Hareketinin Tekrar Gözükmesine Gerek Yok.
+        // Bu yüzden Karar Hareketi Girilmişse Yeni Esas Hareketi Eklenecek Karar Hareketi Silinecek
 
-      this.editMode = true;
-      this.initializeEditMovement(prevNextFeatures, features, movementData);
-    }
+      }
 
-    if (this.createMode) {
-      this.createInitializedForm(movementData, features);
-    }
+      const whereField = <string>data.moduleWhereField;
+      this.refField = whereField;
+      const moduleRefId = <number>data.moduleRefId;
+      this.refValue = moduleRefId;
 
-    if (this.readMode) {
-      this.initializeReadMovement(features, movementData);
-    }
-    // if (data.prevNextFeatures !== undefined) {
-    //   const prevNextFeatures = data.prevNextFeatures;
+      this.createMode = data.createMode;
+      this.readMode = data.readMode;
+      this.updateMode = data.updateMode;
 
-    //   this.editMode = true;
-    //   this.initializeEditMovement(prevNextFeatures, features, movementData);
-    // } else {
-    //   this.createInitializedForm(movementData, features);
-    // }
+      if (this.moduleData['islem_turu'] === 10 && this.createMode) {
+        this.movementRelationOperation(foundModuleForm, movementData, allMovements);
+      }
+
+      this.movementData = movementData;
+
+      if (this.updateMode) {
+        const prevNextFeatures = data.prevNextFeatures;
+
+        this.editMode = true;
+        this.initializeEditMovement(prevNextFeatures, features, movementData);
+      }
+
+      if (this.createMode) {
+        this.createInitializedForm(movementData, features);
+      }
+
+      if (this.readMode) {
+        this.initializeReadMovement(features, movementData);
+      }
+      // if (data.prevNextFeatures !== undefined) {
+      //   const prevNextFeatures = data.prevNextFeatures;
+
+      //   this.editMode = true;
+      //   this.initializeEditMovement(prevNextFeatures, features, movementData);
+      // } else {
+      //   this.createInitializedForm(movementData, features);
+      // }
+
+    });
   }
 
-  removeMovements(movementData: MovementData, fieldValues: FieldValues) {
+  removeMovements(movementData: MovementData, fieldValues: FieldValues | MovementValues) {
     const movementsToDelete = fieldValues.movements_todelete;
 
     if (movementsToDelete.length > 0) {
@@ -188,7 +239,72 @@ export class MovementCreateComponent implements OnInit {
         const foundIndex = movementData.field.domain_values.findIndex(extDomain => extDomain.value === movementToDelete);
         if (foundIndex !== -1) {
           movementData.field.domain_values.splice(foundIndex, 1);
-          fieldValues.numberof_deletedmovements++;
+          // fieldValues.numberof_deletedmovements++;
+        }
+      });
+    }
+  }
+
+  movementRelationOperation(foundModuleForm: ModuleFormData, movementData: MovementData, allMovements: Array<esri.Graphic>) {
+    const movementRel: Array<MovementRel> = foundModuleForm.movementRel;
+    const movementsCodes = allMovements.map(movement => movement.attributes['durumu']);
+
+    if (movementRel !== undefined) {
+      movementRel.forEach(rel => {
+        const relation: MovementRel = rel[0];
+        const islemTuru = relation.islem_turu;
+        if (this.moduleData['islem_turu'] === islemTuru) {
+          const movementValuesArray: Array<Array<MovementValues>> = relation.movement_values;
+          movementValuesArray.forEach((val, index) => {
+            const movementValues = val[0];
+            const ifHas = movementValues.if_has;
+            const ifNotHave = movementValues.if_not_have;
+            let values: Array<number>;
+            let valueState = true;
+            let count = 0;
+
+            if (ifHas.length > 0) {
+              values = ifHas;
+            } else if (ifNotHave.length > 0) {
+              values = ifNotHave;
+              valueState = false;
+            }
+
+            movementsCodes.forEach(movement => {
+              if (values.includes(movement)) {
+                count++;
+              }
+            });
+
+            // GAGA KONTROL EDİLECEK
+            if (count === values.length) { // valuesdekilerin hepsi movementsdaysa alttakine gerek kalmıycak
+              if (valueState) {
+                // eğer state true ise şu hareket varsa silinecek demek eğer state false ise şu hareket yoksa silinecek
+                // yani konu olan hareket eğer bulunursa ve state true ise silinir.
+                // ama konu olan hareket bulunurve state false ise silinmez
+                this.removeMovements(movementData, movementValuesArray[index][0]);
+              }
+            } else {
+              if (!valueState) {
+                this.removeMovements(movementData, movementValuesArray[index][0]);
+              }
+            }
+
+            // TODO: İFHAS VE İFHAVE BİRDEN FAZLAYSA DİNAMİK OLARAK NASIL KONTROL EDİLİR BAKILACAK
+            // TODO: ŞUAN
+            // values.forEach((value) => {
+            //   const foundMovement = allMovements.find(movement => movement.attributes['durumu'] === value);
+            //   if (valueState && foundMovement !== undefined) {
+            //     // eğer state true ise şu hareket varsa silinecek demek eğer state false ise şu hareket yoksa silinecek
+            //     // yani konu olan hareket eğer bulunursa ve state true ise silinir.
+            //     // ama konu olan hareket bulunurve state false ise silinmez
+            //     this.removeMovements(movementData, movementValuesArray[index][0]);
+            //   } else if (!valueState && foundMovement === undefined) {
+            //     this.removeMovements(movementData, movementValuesArray[index][0]);
+            //   }
+            // });
+
+          });
         }
       });
     }
@@ -381,7 +497,13 @@ export class MovementCreateComponent implements OnInit {
   }
 
   onChangeFormControl(event: Event) {
+    this.attachmentDataArray = [];
     const formObject = this.formGroup.value;
+    this.durumu = formObject['durumu'];
+    if (this.moduleCreateRef) {
+      this.moduleCreateRef.close();
+      this.moduleCreateRef = undefined;
+    }
     const formGroup = this.formGroup;
     const target = <HTMLElement>event.target;
     let formElement: HTMLInputElement | HTMLSelectElement;
@@ -397,12 +519,15 @@ export class MovementCreateComponent implements OnInit {
 
       if ((<HTMLInputElement>formElement).files && (<HTMLInputElement>formElement).files.length) {
         const fileList = (<HTMLInputElement>formElement).files;
+        for (let i = 0; i < fileList.length; i++) {
+          this.attachmentDataArray.push(fileList[i]);
+        }
         const file = fileList.item(0);
         reader.readAsDataURL(file);
 
         reader.onload = () => {
           this.formGroup.patchValue({
-            attachment: (<HTMLInputElement>formElement).files[0]
+            attachment: (<HTMLInputElement>formElement).files
           });
         };
       }
@@ -557,7 +682,9 @@ export class MovementCreateComponent implements OnInit {
             if (field.type === 'file' && this.readMode) {
               const featureAttributes = this.features;
               const objectid = featureAttributes['objectid'];
-              const movementUrl = `${environment.arcgisMEBURL}FeatureServer/13/${objectid}/`;
+              // const movementUrl = `${environment.arcgisMEBURL}FeatureServer/13/${objectid}/`;
+              const movementUrl = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${objectid}/`;
+              // const attachmentInfosURL = movementUrl + `attachments?token=${sessionStorage.getItem('CBSArcToken')}&f=pjson`;
               const attachmentInfosURL = movementUrl + `attachments?token=${sessionStorage.getItem('CBSArcToken')}&f=pjson`;
               this.getAttachments(attachmentInfosURL).subscribe(attachmentData => {
                 this.attachmentData = attachmentData;
@@ -581,7 +708,9 @@ export class MovementCreateComponent implements OnInit {
           if (field.type === 'file' && this.readMode) {
             const featureAttributes = this.features;
             const objectid = featureAttributes['objectid'];
-            const movementUrl = `${environment.arcgisMEBURL}FeatureServer/13/${objectid}/`;
+            // const movementUrl = `${environment.arcgisMEBURL}FeatureServer/13/${objectid}/`;
+            const movementUrl = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${objectid}/`;
+            // const attachmentInfosURL = movementUrl + `attachments?token=${sessionStorage.getItem('CBSArcToken')}&f=pjson`;
             const attachmentInfosURL = movementUrl + `attachments?token=${sessionStorage.getItem('CBSArcToken')}&f=pjson`;
             this.getAttachments(attachmentInfosURL).subscribe(attachmentData => {
               this.attachmentData = attachmentData;
@@ -684,6 +813,7 @@ export class MovementCreateComponent implements OnInit {
     }
   }
 
+
   getFeatures(url: string, queryProperties: esri.QueryProperties) {
     const formData = this.createFormData(queryProperties);
 
@@ -717,21 +847,25 @@ export class MovementCreateComponent implements OnInit {
     let url: string;
     let message = '';
     let header = '';
+    const islem_turu = this.moduleData['islem_turu'];
     if (this.acceptanceDialog === undefined) {
       if (this.createMode === true) {
-        url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/addFeatures';
+        // url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/addFeatures';
+        url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/addFeatures';
         message = 'Hareket Kaydı Eklemek İstediğinizden Emin Misiniz';
         header = 'Kayıt';
       }
-      if (this.updateMode) {
-        url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/updateFeatures';
+      if (this.updateMode && !this.isContainsEsasNo) {
+        // url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/updateFeatures';
+        url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/updateFeatures';
         message = 'Hareketi Düzenlemek İstediğinizden Emin Misiniz';
         header = 'Düzenleme';
       }
+
       const formValues = this.formGroup.value;
       const degisiklik_turu = formValues['degisiklik_turu'];
       const durumu = formValues['durumu'];
-      const islem_turu = this.moduleData['islem_turu'];
+      this.durumu = durumu;
       // Yatırım Teklif Yeni Teklif Girince Tıpkı Durum Revizyon-Proje Seçilmesi Gibi İşlem Bilgileri Penceresi Gelip Düzenlenebilir Olacak
       if ((degisiklik_turu !== undefined && degisiklik_turu === '1')) {
         this.openModuleDetail(this.refValue, url, formValues);
@@ -740,6 +874,9 @@ export class MovementCreateComponent implements OnInit {
       } else if (islem_turu === 12 && durumu == 35) {
         this.openModuleDetail(this.refValue, url, formValues);
         return;
+        // Kamulaştırma Davaları(10) İşlemi İçin Yeni Esas (42) Hareketi Seçilirse Yeni İşlem Penceresi Açılacak ve Bu İşlem
+        // Penceresinde Oluşturulacak Olan Dosya No Bu Hareketin Bağlı Olduğu Bir Önceki İşleme Atanarak İşlem ile Hareket
+        // Arasında Bağlantı Kurulması Sağlanmış Olacak
       }
 
       this.addMovementData(header, message, url, formValues);
@@ -747,15 +884,20 @@ export class MovementCreateComponent implements OnInit {
   }
 
   openModuleDetail(objectid: number, movementUrl: string, formValues: any) {
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 14 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+    let isInfo = 1;
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
       where: `objectid = ${objectid}`,
     };
     const progress = this.dialogService.openUnClosable(ProgressInfoComponent, 'İşlem Detayı Alınıyor', false, {}, false, 'light');
+    const yeniIslemPenceresiAcilacakDomainList = this.yeniIslemPenceresiAcilacakDomainList;
 
     this.getFeatures(url, queryProperties).subscribe(res => {
-      this.getLayerFields().subscribe(fields => {
+      // TEST GAGA AÇILACAK
+      // this.getLayerFields().subscribe(fields => {
+      this.getTestLayerFields().subscribe(fields => {
         this.moduleFields = fields;
 
         progress.close();
@@ -772,16 +914,28 @@ export class MovementCreateComponent implements OnInit {
 
               const refField = this.moduleData.layerField;
               const moduleRefField = this.moduleData.moduleField;
+              let createFromHareket = false;
+
+              if (formValues !== undefined) {
+                // Bu iki harekette de yeni işlem açılacak ve hareket eklenirken sadece dosya no ile esas no gösterilecek.
+                const foundHareketDomain = yeniIslemPenceresiAcilacakDomainList.find(x => x === formValues['durumu']);
+                if (this.moduleData['islem_turu'] === 10 && foundHareketDomain) {
+                  isInfo = -1;
+                  createFromHareket = true;
+                }
+              }
 
               this.moduleCreateRef = this.dialogService.open(CreateModuleComponent, foundCodedValue.name + ' Detayı', false, {
                 data: {
-                  isInfo: 1,
+                  isInfo: isInfo,
                   refField: refField,
                   moduleRefField: moduleRefField,
                   type: foundCodedValue.name,
                   feature: this.featureData,
                   moduleData: foundFeature.attributes,
                   specialState: false,
+                  formValues: formValues,
+                  createFromHareket: createFromHareket
                 }
               }, false, 'light');
 
@@ -806,6 +960,15 @@ export class MovementCreateComponent implements OnInit {
     });
   }
 
+  getTestLayerFields() {
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1', {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson',
+      }
+    }).pipe(map(response => response['fields']));
+  }
+
   getLayerFields() {
     return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 14, {
       params: {
@@ -825,55 +988,188 @@ export class MovementCreateComponent implements OnInit {
     }
   }
 
+  getAllMovements() {
+    const queryProperties = <esri.QueryProperties>{
+      where: `${this.moduleWhereField} = ${this.moduleRefId}`,
+      orderByFields: ['create_date desc'],
+      outFields: ['*']
+    };
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+
+    return this.getFeatures(url, queryProperties).pipe(map(response => response.features));
+  }
+
+  getMultiSelectMovements(islemRefId: any) {
+    const queryProperties = <esri.QueryProperties>{
+      where: `islem_refid = ${islemRefId} `,
+      orderByFields: ['create_date desc'],
+      outFields: ['*']
+    };
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+
+    return this.getFeatures(url, queryProperties).pipe(map(response => response.features));
+  }
+
+  setMSMovementsIdenticalState() {
+    // e yatirim proje no modüldekinden olan hepsinin tek tek hareketlerine bakılıp ortak olanlar alınır.
+    return this.getMultiSelectDatas().toPromise().then(response => {
+      const foundFeatures = response['features'];
+      const movementArray = [];
+      const promises = [];
+      foundFeatures.forEach(foundFeature => {
+        const promise = this.getMultiSelectMovements(foundFeature['attributes']['objectid']).toPromise().then(allMovements => {
+          let movementText = '';
+          this.msAllMovementList.push(allMovements);
+          const movementList = allMovements.map(feature => feature.attributes['durumu']);
+          movementList.forEach(durumu => {
+            movementText  += durumu.toString();
+          });
+          movementArray.push(movementText);
+        });
+
+        promises.push(promise);
+      });
+
+      return Promise.all(promises).then(res => {
+        let isSame = false;
+        for (let i = 0; i < movementArray.length; i++) {
+          const nextIndex = movementArray[i + 1];
+          if (nextIndex !== undefined) {
+            const currentMovementText = movementArray[i];
+            const nextMovementText = movementArray[i + 1];
+
+            if (currentMovementText === nextMovementText) {
+              isSame = true;
+            } else {
+              isSame = false;
+            }
+          }
+        }
+
+        this.msMovementsIdenticalState = isSame;
+        return isSame;
+      });
+    });
+  }
+
+  deneme2() {
+
+    // msIdenticalState true ise ve allProcess e ekle seçeneği seçilmişse tüm hareketlere eklenecek.
+  }
+
   addMovementData(header: string, message: string, url: string, formValues: any) {
-    this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, {
-      data: {
-        message: message
-      }
-    }, false, 'light');
 
-    this.acceptanceDialog.afterClosed.subscribe(chosenResult => {
-      if (chosenResult === true) {
-        this.createMovementData(url, formValues);
+    // Durumu icra (39) ise yeni işlem penceresi açıcak o işlemi kaydettiğinde icra hareketini ilk işlemin dosya ve esasno'sunu
+    // alarak kaydedecek
+    if (this.yeniIslemPenceresiAcilacakDomainList.includes(this.durumu)) {
+      this.openModuleDetail(this.refValue, url, formValues);
+    } else {
+      if (this.isContainsEsasNo) {
+        const warningMessage = 'Bu İşlem Çoklu Seçimle Eklenmiştir.';
+
+        // Çoklu Olarak Eklenmiş İşlemlerin Hareketleri Arasında Senkronizasyon Yoksa Bütün İşlemlerin Hareketlerine
+        // Bu Hareketi Eklemek veya Bütün İşlemlerin Hareketlerini Bu Şekilde Güncelleme Seçeneği Disable Olacak.
+        if (this.createMode) {
+          this.setMSMovementsIdenticalState().then(res => {
+            if (this.multiSelectAcceptanceDialog === undefined) {
+              if (this.createMode) {
+                this.multiSelectAcceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'UYARI', false, {
+                  data: {
+                    message: warningMessage,
+                    multiSelectAddMovement: true,
+                    msIdenticalState: res
+                  }
+                }, false, 'light');
+              }
+              this.multiSelectAcceptanceDialog.afterClosed.subscribe(multiSelectChoise => {
+                let msChoise = 1;
+                // 1: onlyThisProcess, 2:allProcess
+                if (multiSelectChoise === 'allProcess') {
+                  msChoise = 2;
+                }
+                // tslint:disable-next-line:max-line-length
+                if (this.acceptanceDialog === undefined && multiSelectChoise !== undefined) {
+                  this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, {
+                    data: {
+                      message: 'Hareketleri Eklemek İstediğinize Emin Misiniz?'
+                    }
+                  }, false, 'light');
+                  this.acceptanceDialog.afterClosed.subscribe(closeResult => {
+                    if (closeResult === true) {
+                      this.createMovementData(url, formValues, msChoise);
+                    }
+                    this.acceptanceDialog = undefined;
+                    this.dialog.close(true);
+                  });
+                }
+                this.multiSelectAcceptanceDialog = undefined;
+                this.dialog.close(true);
+              });
+            }
+          });
+        } else if (this.editMode) {
+          this.onUpdateMovement();
+        }
+      } else {
+        this.acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, {
+          data: {
+            message: message
+          }
+        }, false, 'light');
+        this.acceptanceDialog.afterClosed.subscribe(chosenResult => {
+          if (chosenResult === true) {
+            this.createMovementData(url, formValues);
+          }
+          this.acceptanceDialog = undefined;
+        });
       }
-      this.acceptanceDialog = undefined;
-    });
+    }
   }
 
   updateParselProperty(kadastroParselLayer: esri.FeatureLayer, tasinmaz_id: number,
     propertyType: string, domainValue: number) {
+
     const queryProperties: esri.QueryProperties = {
       where: `tasinmaz_id=${tasinmaz_id}`,
       outFields: [`objectid, ${propertyType}`],
       returnGeometry: false
     };
 
-    kadastroParselLayer.queryFeatures(queryProperties).then(result => {
-      const feature: esri.Graphic = result.features[0];
-      const updatedPropertyValue = feature.getAttribute(propertyType);
+    kadastroParselLayer.queryFeatures(queryProperties).then(results => {
+      const featureList = [];
+      for (let i = 0; i < results.features.length; i++) {
+        const feature: esri.Graphic = results.features[i];
+        const updatedPropertyValue = feature.getAttribute(propertyType);
 
-      if (propertyType === 'mevcut_kullanim' && updatedPropertyValue === 5) {
-        return;
-      }
+        if (propertyType === 'mevcut_kullanim' && updatedPropertyValue === 5) {
+          return;
+        }
 
-      feature.setAttribute(propertyType, domainValue);
+        feature.setAttribute(propertyType, domainValue);
+        featureList.push(feature);
+      }
       const applyEdits = <esri.FeatureLayerApplyEditsEdits>{
-        updateFeatures: [feature]
+        updateFeatures: featureList
       };
 
       kadastroParselLayer.applyEdits(applyEdits).then(updateRes => {
-        const resultsValue = <Array<{ success: boolean, objectId: number }>>updateRes['updateFeatureResults'];
-        if (resultsValue !== undefined) {
-          this.notify.open('Parsele ait ' + propertyType + ' güncellendi', 'success', 10);
-        } else {
-          this.notify.open('Parsele ait ' + propertyType + ' güncellenirken hata oluştu', 'danger', 10);
+        for (let j = 0; j < updateRes.length; j++) {
+          const resultsValue = <Array<{ success: boolean, objectId: number }>>updateRes[j]['updateFeatureResults'];
+          if (resultsValue !== undefined) {
+            this.notify.open('Parsele ait ' + propertyType + ' güncellendi', 'success', 10);
+          } else {
+            this.notify.open('Parsele ait ' + propertyType + ' güncellenirken hata oluştu', 'danger', 10);
+          }
         }
       });
     });
   }
 
   updateProjeNo(formValues: any) {
-    const url = `${environment.arcgisMEBURL}FeatureServer/13/updateFeatures`;
+    // const url = `${environment.arcgisMEBURL}FeatureServer/13/updateFeatures`;
+    const url = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/updateFeatures`;
 
     const formData = new FormData();
     const features: Array<esri.Graphic> = [];
@@ -890,106 +1186,406 @@ export class MovementCreateComponent implements OnInit {
     this.http.post(url, formData, { params: { token: sessionStorage.getItem('CBSArcToken') } }).subscribe();
   }
 
-  createMovementData(url: string, formValues: any) {
+  createMovementData(url: string, formValues: any, msChoise?: number) {
     const dialog = this.dialogService.openUnClosable(ProgressInfoComponent, 'İşlem Yapılıyor', false,
       { data: {} }, false, 'light');
 
-    this.addOrEditMovement(url).subscribe(res => {
+    const processUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+    const movementUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+    this.notUpdatedParselIDList = this.toBeUpdatedParselIDList;
 
-      if (Object.keys(res).length === 0) {
-        this.notify.open('Bir Hata Oluştu Hareket Kaydedilemedi', 'danger', 10);
-        dialog.close();
-      } else {
-        if (formValues.hasOwnProperty('durumu')) {
-          const kadastroParselLayer: esri.FeatureLayer = <esri.FeatureLayer>this.mapView.map.allLayers.find(layer =>
-            layer.title === 'Kadastro Parselleri');
-
-          const moduleData = this.moduleData;
-          const islem_turu = moduleData['islem_turu'];
-          const durumu = formValues['durumu'];
-          const tasinmaz_id = moduleData['parsel_id'];
-          // TODO islem turu yatirim teklif ise
-          if (islem_turu === 12) {
-
-            // TODO hareket durum reddedildi ve plana alindi degil ise
-            // tslint:disable-next-line:triple-equals
-            if (durumu != 15 && durumu != 25) {
-              this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'mevcut_kullanim', 5);
-            }
+    if (msChoise === 2) {
+      if (this.createMode) {
+        this.msAddMovement(url, msChoise).then(promiseArray => {
+          Promise.all(promiseArray).then(promiseResponses => {
+            promiseResponses.forEach(response => {
+              if (Object.keys(response).length === 0) {
+                this.notify.open('Bir Hata Oluştu Hareketler Kaydedilemedi', 'danger', 10);
+                dialog.close();
+                this.progressDialog.close();
+              } else {
+
+                let resultValue = 'addResults';
+                if (this.updateMode) {
+                  resultValue = 'updateResults';
+                }
 
-          } else if (islem_turu === 11 && tasinmaz_id !== null) { // TODO islem turu kamulastirma teklifi
-            const islem_edinim_sekli = moduleData['edinim_sekli'];
+                const results = <Array<{ success: boolean, objectId: number }>>response[resultValue];
+
+                if (formValues.hasOwnProperty('durumu')) {
+                  const kadastroParselLayer: esri.FeatureLayer = <esri.FeatureLayer>this.mapView.map.allLayers.find(layer =>
+                    layer.title === 'Kadastro Parselleri');
+                  const formData = new FormData();
+                  formData.append('where', `objectid=${results[0].objectId}`);
+                  formData.append('f', 'json');
+                  formData.append('outFields', '*');
+                  formData.append('rollbackOnFailure', 'true');
+
+                  // BURASI SIRALI YAPILMASI LAZIM BAKILACAK TODO GAGA
+                  const deneme = this.http.post(movementUrl, formData, {
+                    params: {
+                      token: sessionStorage.getItem('CBSArcToken')
+                    }
+                  }).toPromise().then(movementRes => {
+                    const features = movementRes['features'][0]['attributes'];
+                    const formData2 = new FormData();
+                    formData2.append('where', `objectid=${features['islem_refid']}`);
+                    formData2.append('f', 'json');
+                    formData2.append('outFields', '*');
+                    formData2.append('rollbackOnFailure', 'true');
+
+                    const deneme2 = this.http.post(processUrl, formData2, {
+                      params: {
+                        token: sessionStorage.getItem('CBSArcToken')
+                      }
+                    }).toPromise().then(processRes => {
+                      const features2 = processRes['features'][0];
+                      const attributes = features2['attributes'];
+                      const tasinmaz_id = attributes['parsel_id'];
+                      const islem_turu = attributes['islem_turu'];
+                      const durumu = attributes['durumu'];
+
+                      const foundIndex = this.toBeUpdatedParselIDList.findIndex(id => id === tasinmaz_id);
+                      if (foundIndex) {
+                        const firstPart = this.notUpdatedParselIDList.slice(0, foundIndex);
+                        const secondPart = this.notUpdatedParselIDList.slice(foundIndex + 1);
+
+                        this.notUpdatedParselIDList = [].concat(firstPart, secondPart);
+                      }
+
+                      this.updatedParselIDList.push(tasinmaz_id);
+                      if (islem_turu === 12) {
+                        // tslint:disable-next-line:triple-equals
+                        if (durumu != 15 && durumu != 25) {
+                          this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'mevcut_kullanim', 5);
+                        }
+                      } else if (islem_turu === 11 && tasinmaz_id !== null) { // TODO islem turu kamulastirma teklifi
+                        const islem_edinim_sekli = attributes['edinim_sekli'];
+                        if (islem_edinim_sekli === 3) {
+                          // TODO kabul edildi veya ertelendi
+                          // tslint:disable-next-line:triple-equals
+                          if (durumu == 22 || durumu == 24) {
+                            this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 9);
+                            // tslint:disable-next-line:triple-equals
+                          } else if (durumu == 23) { // TODO durum reddedildi
+                            this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 11);
+                          }
+                        }
+                      }
+
+                      // tslint:disable-next-line:triple-equals
+                      if (this.movementData.type === 14 && formValues['durumu'] == 26) {
+                        const objectid = results[0].objectId;
+                        formValues['proje_no'] = objectid;
+                        formValues['objectid'] = objectid;
+
+                        this.updateProjeNo(formValues);
+                        // tslint:disable-next-line:triple-equals
+                      } else if (this.movementData.type === 12 && formValues['durumu'] == 26) {
+                        // Artık Yatırım Teklif Onaylandı Durumu İçin ProjeNo Otomatik Oluşturulacak. IlceKodTeklifYılıObjectId şeklinde
+                        const objectid = results[0].objectId;
+                        // const teklifYili = this.moduleData['teklif_yili'].toString();
+                        // const ilceKodu = this.featureData.attributes['ilce'].toString();
+                        formValues['proje_no'] = objectid;
+                        formValues['objectid'] = objectid;
+                        this.updateProjeNo(formValues);
+                      }
+                      if (formValues.attachment !== undefined) {
+                        if (this.updateMode) {
+                          this.updateAttachments(formValues, dialog, results);
+                          this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+                        }
+                        if (this.createMode) {
+                          this.addAttachment(formValues, dialog, results);
+                          this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
+                        }
+                        this.progressDialog.close();
+                      } else {
+                        if (this.updateMode === true) {
+                          this.removeIfHasAttachment(dialog);
+                          this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+                        }
+                        if (this.createMode) {
+                          this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
+                          dialog.close();
+                          this.dialog.close(true);
+                        }
+                        this.progressDialog.close();
+                      }
+                      if (this.notUpdatedParselIDList.length > 0) {
+                        let notUpdatedParselIdListString = '';
+                        this.notUpdatedParselIDList.forEach(id => {
+                          notUpdatedParselIdListString += id + ',';
+                        });
+                        notUpdatedParselIdListString.slice(0, -1);
+                        this.notify.open(`Parsel ID'leri ${notUpdatedParselIdListString} Olan Veri/Verilerin Hareketi Kaydedilemedi.`,
+                          'danger', 10);
+                      }
+                      this.progressDialog.close();
+                    });
+                  });
+                }
+              }
+            });
+          });
+        }, error => {
+          dialog.close();
+          this.dialog.close(false);
+          this.progressDialog.close();
+          console.error(error);
+        });
+      } else if (this.editMode) {
+        this.onUpdateMovement();
+      }
+    } else {
+      this.addOrEditMovement(url).subscribe(res => {
 
-            if (islem_edinim_sekli === 3) {
-              // TODO kabul edildi veya ertelendi
+        if (Object.keys(res).length === 0) {
+          this.notify.open('Bir Hata Oluştu Hareket Kaydedilemedi', 'danger', 10);
+          dialog.close();
+        } else {
+          if (formValues.hasOwnProperty('durumu')) {
+            const kadastroParselLayer: esri.FeatureLayer = <esri.FeatureLayer>this.mapView.map.allLayers.find(layer =>
+              layer.title === 'Kadastro Parselleri');
+
+            const moduleData = this.moduleData;
+            const islem_turu = moduleData['islem_turu'];
+            const durumu = formValues['durumu'];
+            const tasinmaz_id = moduleData['parsel_id'];
+            // TODO islem turu yatirim teklif ise
+            if (islem_turu === 12) {
+
+              // TODO hareket durum reddedildi ve plana alindi degil ise
               // tslint:disable-next-line:triple-equals
-              if (durumu == 22 || durumu == 24) {
-                this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 9);
+              if (durumu != 15 && durumu != 25) {
+                this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'mevcut_kullanim', 5);
+              }
+
+            } else if (islem_turu === 11 && tasinmaz_id !== null) { // TODO islem turu kamulastirma teklifi
+              const islem_edinim_sekli = moduleData['edinim_sekli'];
+
+              if (islem_edinim_sekli === 3) {
+                // TODO kabul edildi veya ertelendi
                 // tslint:disable-next-line:triple-equals
-              } else if (durumu == 23) { // TODO durum reddedildi
-                this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 11);
+                if (durumu == 22 || durumu == 24) {
+                  this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 9);
+                  // tslint:disable-next-line:triple-equals
+                } else if (durumu == 23) { // TODO durum reddedildi
+                  this.updateParselProperty(kadastroParselLayer, tasinmaz_id, 'kadastro_parsel_tip', 11);
+                }
               }
             }
           }
-        }
 
-        let resultValue = 'addResults';
-        if (this.editMode === true) {
-          resultValue = 'updateResults';
-        }
-        const results = <Array<{ success: boolean, objectId: number }>>res[resultValue];
-
-        // tslint:disable-next-line:triple-equals
-        if (this.movementData.type === 14 && formValues['durumu'] == 26) {
-          const objectid = results[0].objectId;
-          formValues['proje_no'] = objectid;
-          formValues['objectid'] = objectid;
+          let resultValue = 'addResults';
+          if (this.editMode === true) {
+            resultValue = 'updateResults';
+          }
+          const results = <Array<{ success: boolean, objectId: number }>>res[resultValue];
 
-          this.updateProjeNo(formValues);
           // tslint:disable-next-line:triple-equals
-        } else if (this.movementData.type === 12 && formValues['durumu'] == 26) {
-          // Artık Yatırım Teklif Onaylandı Durumu İçin ProjeNo Otomatik Oluşturulacak. IlceKodTeklifYılıObjectId şeklinde
-          const objectid = results[0].objectId;
-          // const teklifYili = this.moduleData['teklif_yili'].toString();
-          // const ilceKodu = this.featureData.attributes['ilce'].toString();
-          formValues['proje_no'] = objectid;
-          formValues['objectid'] = objectid;
-          this.updateProjeNo(formValues);
-        }
+          if (this.movementData.type === 14 && formValues['durumu'] == 26) {
+            const objectid = results[0].objectId;
+            formValues['proje_no'] = objectid;
+            formValues['objectid'] = objectid;
 
-        if (formValues.attachment !== undefined) {
-          if (this.updateMode) {
-            this.updateAttachments(formValues, dialog, results);
-            this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+            this.updateProjeNo(formValues);
+            // tslint:disable-next-line:triple-equals
+          } else if (this.movementData.type === 12 && formValues['durumu'] == 26) {
+            // Artık Yatırım Teklif Onaylandı Durumu İçin ProjeNo Otomatik Oluşturulacak. IlceKodTeklifYılıObjectId şeklinde
+            const objectid = results[0].objectId;
+            // const teklifYili = this.moduleData['teklif_yili'].toString();
+            // const ilceKodu = this.featureData.attributes['ilce'].toString();
+            formValues['proje_no'] = objectid;
+            formValues['objectid'] = objectid;
+            this.updateProjeNo(formValues);
           }
-          if (this.createMode) {
-            this.addAttachment(formValues, dialog, results);
-            this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
+
+          if (formValues.attachment !== undefined) {
+            if (this.updateMode) {
+              this.updateAttachments(formValues, dialog, results);
+              this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+            }
+            if (this.createMode) {
+              this.addAttachment(formValues, dialog, results);
+              this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
+            }
+          } else {
+            if (this.updateMode === true) {
+              this.removeIfHasAttachment(dialog);
+              this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+            }
+            if (this.createMode) {
+              this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
+              dialog.close();
+              this.dialog.close(true);
+            }
           }
+        }
+      }, error => {
+        dialog.close();
+        this.dialog.close(false);
+        console.error(error);
+      });
+    }
+
+    // TODO: BURANIN SONUNDA ERRORA DÜŞÜYOR BUNA SONRA BAKILACAK
+  }
+
+  onMultiUpdateMovement(movementData: any, updateFeatureUrl: string) {
+    this.getMovementsOfMultiSelectDatas().subscribe(movements => {
+
+      const durumu = movementData['durumu'];
+      const touch_date = movementData['touch_date'];
+      const touch_by = movementData['touch_by'];
+      const toBeUpdatedMovements = movements['features'].filter(movement => movement.attributes.touch_by === touch_by &&
+        movement.attributes.durumu === durumu && movement.attributes.touch_date === touch_date);
+      const objectIDs = toBeUpdatedMovements.map(movement => movement.attributes.objectid);
+      const promises = [];
+      let progress;
+
+      const newFormData = new FormData();
+      const features: Array<esri.Graphic> = [];
+      // @ts-ignore
+      const feature: esri.Graphic = {
+        attributes: this.formGroup.value
+      };
+
+      features.push(feature);
+      const message = 'Hareketleri Güncellemek İstediğinizden Emin Misiniz';
+      const header = 'Çoklu Güncelleme';
+      const acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, { data: { message } }, false, 'light');
+
+      acceptanceDialog.afterClosed.subscribe((isOk) => {
+        if (!isOk) {
+          return;
         } else {
-          if (this.updateMode === true) {
-            this.removeIfHasAttachment(dialog);
-            this.notify.open('Hareket Düzenleme Tamamlandı', 'success', 5);
+          progress = this.dialogService.openUnClosable(ProgressInfoComponent, 'Hareketler Güncelleniyor..', false,
+            { data: {} }, false, 'light');
+          for (let i = 0; i < objectIDs.length; i++) {
+            // KONTROL EDİLCEK GAGA
+            feature.attributes['objectid'] = objectIDs[i];
+            newFormData.append('features', JSON.stringify(features));
+            newFormData.append('rollbackOnFailure', 'true');
+            newFormData.append('f', 'json');
+            newFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+
+            promises.push(this.http.post(updateFeatureUrl, newFormData).toPromise().then());
           }
-          if (this.createMode) {
-            this.notify.open('Hareket Ekleme Tamamlandı', 'success', 5);
-            dialog.close();
+          Promise.all(promises).then((responses) => {
+            let isAllOk = true;
+            responses.forEach(response => {
+              if (response['updateResults'][0].success) {
+                isAllOk = true;
+              } else {
+                isAllOk = false;
+              }
+            });
+
+            if (isAllOk) {
+              this.notify.open('Çoklu Hareket Güncelleme Başarılı', 'success', 5);
+            } else {
+              this.notify.open('Çoklu Hareket Güncellerken Hata Oluştu', 'danger', 5);
+            }
+            progress.close();
             this.dialog.close(true);
-          }
+
+          });
+        }
+      });
+    });
+  }
+
+  onMultiDeleteMovement(movementData: any, deleteFeatureUrl: string) {
+    this.getMovementsOfMultiSelectDatas().subscribe(movements => {
+      const durumu = movementData['durumu'];
+      const touch_date = movementData['touch_date'];
+      const touch_by = movementData['touch_by'];
+      const toBeDeletedMovements = movements['features'].filter(movement => movement.attributes.touch_by === touch_by &&
+        movement.attributes.durumu === durumu && movement.attributes.touch_date === touch_date);
+      const objectIDs = toBeDeletedMovements.map(movement => movement.attributes.objectid);
+      const newFormData = new FormData();
+      newFormData.append('objectIds', objectIDs.toString());
+      newFormData.append('rollbackOnFailure', 'true');
+      newFormData.append('f', 'json');
+      newFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+
+      const message = 'Hareketleri Silmek İstediğinizden Emin Misiniz';
+      const header = 'Çoklu Silme';
+      const acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, { data: { message } }, false, 'light');
+
+      acceptanceDialog.afterClosed.subscribe((isOk) => {
+        this.acceptanceDialog = undefined;
+        if (!isOk) {
+          return;
         }
+        const progress = this.dialogService.openUnClosable(ProgressInfoComponent, 'Hareketler Siliniyor..', false,
+          { data: {} }, false, 'light');
+        this.http.post(deleteFeatureUrl, newFormData).subscribe((response: DeleteResults) => {
+          progress.close();
+          this.dialog.close(true);
+          if (response.deleteResults && response.deleteResults[0].success) {
+            this.notify.open('Çoklu Hareket Silme Başarılı', 'success', 5);
+          } else {
+            console.error(response);
+            this.notify.open('Çoklu Hareket Silerken Hata Oluştu', 'danger', 5);
+          }
+        }, (err) => {
+          console.error(err);
+          this.dialog.close(true);
+          progress.close();
+        });
+      });
+    });
+  }
+
+  updateMovement(movementData: any, updateFeatureUrl: string) {
+    const updateFormData = new FormData();
+    const features: Array<esri.Graphic> = [];
+    // @ts-ignore
+    const feature: esri.Graphic = {
+      attributes: this.formGroup.value
+    };
+
+    feature.attributes['objectid'] = movementData.objectid;
+
+    features.push(feature);
+    updateFormData.append('features', JSON.stringify(features));
+    updateFormData.append('rollbackOnFailure', 'true');
+    updateFormData.append('f', 'json');
+    updateFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+
+    const message = 'Hareketi Güncellemek İstediğinizden Emin Misiniz';
+    const header = 'Güncelleme';
+    const acceptanceDialog = this.dialogService.open(AcceptDialogComponent, header, false, { data: { message } }, false, 'light');
+
+    acceptanceDialog.afterClosed.subscribe((isOk) => {
+      this.acceptanceDialog = undefined;
+      if (!isOk) {
+        return;
       }
-    }, error => {
-      dialog.close();
-      this.dialog.close(false);
-      console.error(error);
+      const progress = this.dialogService.openUnClosable(ProgressInfoComponent, 'Hareket Güncelleniyor..', false,
+        { data: {} }, false, 'light');
+      this.http.post(updateFeatureUrl, updateFormData).subscribe((response) => {
+        progress.close();
+        this.dialog.close(true);
+        if (response['updateResults'] && response['updateResults'][0].success) {
+          this.notify.open('Hareket Güncelleme Başarılı', 'success', 5);
+        } else {
+          console.error(response);
+          this.notify.open('Hareket Güncellerken Hata Oluştu', 'danger', 5);
+        }
+      }, (err) => {
+        console.error(err);
+        this.dialog.close(true);
+        progress.close();
+      });
     });
 
-    // TODO: BURANIN SONUNDA ERRORA DÜŞÜYOR BUNA SONRA BAKILACAK
+    this.acceptanceDialog = acceptanceDialog;
   }
 
-  onDeleteMovement() {
-    const movementData = this.dialogConfig.data.features;
-    const deleteFeatureUrl = `${environment.arcgisMEBURL}FeatureServer/13/deleteFeatures`;
+  deleteMovement(movementData: any, deleteFeatureUrl: string) {
     const deleteFormData = new FormData();
     deleteFormData.append('objectIds', movementData.objectid);
     deleteFormData.append('rollbackOnFailure', 'true');
@@ -1023,11 +1619,168 @@ export class MovementCreateComponent implements OnInit {
       });
     });
 
-
     this.acceptanceDialog = acceptanceDialog;
+  }
+
+  onUpdateMovement() {
+    const deleteFeatureUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/updateFeatures';
+    const movementData = this.dialogConfig.data.features;
 
-    // this.dialog
+    if (this.isContainsEsasNo) {
+      const warningMessage = 'Bu İşlem Çoklu Seçimle Eklenmiştir.';
+
+      this.setMSMovementsIdenticalState().then(res => {
+        if (this.multiSelectAcceptanceDialog === undefined) {
+          this.multiSelectAcceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'UYARI', false, {
+            data: {
+              message: warningMessage,
+              multiSelectUpdateMovement: true,
+              msIdenticalState: res
+            }
+          }, false, 'light');
+          this.multiSelectAcceptanceDialog.afterClosed.subscribe(multiSelectChoise => {
+            let msChoise = 1;
+            // 1: onlyThisProcess, 2:allProcess
+            if (multiSelectChoise === 'allProcess') {
+              msChoise = 2;
+            }
+            // tslint:disable-next-line:max-line-length
+            if (this.acceptanceDialog === undefined && multiSelectChoise !== undefined) {
+              if (msChoise === 2) {
+                this.onMultiUpdateMovement(movementData, deleteFeatureUrl);
+                return;
+
+              } else if (msChoise === 1) {
+                this.updateMovement(movementData, deleteFeatureUrl);
+              }
+            }
+            this.multiSelectAcceptanceDialog = undefined;
+          });
+        }
+      });
+    } else {
+      this.updateMovement(movementData, deleteFeatureUrl);
+    }
   }
+
+  onDeleteMovement() {
+    // const deleteFeatureUrl = `${environment.arcgisMEBURL}FeatureServer/13/deleteFeatures`;
+    const deleteFeatureUrl = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/deleteFeatures';
+    const movementData = this.dialogConfig.data.features;
+
+    if (this.isContainsEsasNo) {
+      const warningMessage = 'Bu İşlem Çoklu Seçimle Eklenmiştir.';
+
+      this.setMSMovementsIdenticalState().then(res => {
+        if (this.multiSelectAcceptanceDialog === undefined) {
+          this.multiSelectAcceptanceDialog = this.dialogService.open(AcceptDialogComponent, 'UYARI', false, {
+            data: {
+              message: warningMessage,
+              multiSelectDeleteMovement: true,
+              msIdenticalState: res
+            }
+          }, false, 'light');
+          this.multiSelectAcceptanceDialog.afterClosed.subscribe(multiSelectChoise => {
+            let msChoise = 1;
+            // 1: onlyThisProcess, 2:allProcess
+            if (multiSelectChoise === 'allProcess') {
+              msChoise = 2;
+            }
+            // tslint:disable-next-line:max-line-length
+            if (this.acceptanceDialog === undefined && multiSelectChoise !== undefined) {
+              if (msChoise === 2) {
+                this.onMultiDeleteMovement(movementData, deleteFeatureUrl);
+                return;
+              } else if (msChoise === 1) {
+                this.deleteMovement(movementData, deleteFeatureUrl);
+              }
+            }
+            this.multiSelectAcceptanceDialog = undefined;
+          });
+        }
+      });
+    } else {
+      this.deleteMovement(movementData, deleteFeatureUrl);
+    }
+  }
+
+  getMovementsOfMultiSelectDatas() {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+
+    return this.http.get(url, {
+      params: {
+        where: `islem_no=${this.moduleData['e_yatirim_proje_no']}`,
+        outFields: ['*'],
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson'
+      }
+    });
+  }
+
+  getMultiSelectDatas() {
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/1/query';
+
+    return this.http.get(url, {
+      params: {
+        where: `e_yatirim_proje_no='${this.moduleData['e_yatirim_proje_no']}' and touch_by='goksuvat'`,
+        outFields: ['*'],
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson'
+      }
+    });
+  }
+
+  // onMultiAdd
+  msAddMovement(url: string, msChoise: number) {
+    const formData = this.formGroup.value;
+
+    const gonderilenTutar: string = formData['gonderilen_tutar'];
+    if (gonderilenTutar) {
+      formData['gonderilen_tutar'] = gonderilenTutar.replace('.', ',');
+    }
+
+    const feature = <esri.Graphic>{
+      attributes: formData,
+    };
+
+    const features = <Array<esri.Graphic>>[];
+
+    features.push(feature);
+    this.addFeatureBoundData(features);
+
+    if (this.isContainsEsasNo && msChoise === 2) {
+      const toBeUpdatedParselIDList = [];
+
+      return this.getMultiSelectDatas().toPromise().then(response => {
+        console.log(response);
+        const foundFeatures = response['features'];
+        const promises = [];
+        foundFeatures.forEach(foundFeature => {
+          feature.attributes['islem_refid'] = foundFeature['attributes']['objectid'];
+          feature.attributes['id'] = foundFeature['attributes']['objectid'];
+          feature.attributes['islem_no'] = foundFeature['attributes']['e_yatirim_proje_no'];
+          toBeUpdatedParselIDList.push(foundFeature['attributes']['parsel_id']);
+
+          const newFormData = new FormData();
+          newFormData.append('features', JSON.stringify([feature]));
+          newFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+          newFormData.append('f', 'pjson');
+          newFormData.append('rollbackOnFailure', 'true');
+          if (this.progressDialog === undefined) {
+            const progressDialog = this.dialogService.
+              openUnClosable(ProgressInfoComponent, 'Kayıtlar Ekleniyor', false, {}, false, 'light');
+            this.progressDialog = progressDialog;
+          }
+
+          // this.http.post(environment.arcgisMEBURL + 'FeatureServer/14/addFeatures', insertFormData)
+          promises.push(this.http.post(url, newFormData).toPromise());
+        });
+        this.toBeUpdatedParselIDList = toBeUpdatedParselIDList;
+        return promises;
+      });
+    }
+  }
+
   addOrEditMovement(url: string): Observable<Object> {
     const formData = this.formGroup.value;
 
@@ -1044,7 +1797,6 @@ export class MovementCreateComponent implements OnInit {
       attributes: formData,
     };
 
-
     const features = <Array<esri.Graphic>>[];
 
     features.push(feature);
@@ -1062,61 +1814,117 @@ export class MovementCreateComponent implements OnInit {
   }
 
   addAttachment(formValues: any, dialog: DialogRef, results: Array<{ success: boolean, objectId: number }>) {
-    const addAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/13/${results[0].objectId}/addAttachment`;
-
-    const attachmentFormData = new FormData();
+    // const addAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/13/${results[0].objectId}/addAttachment`;
+    // tslint:disable-next-line:max-line-length
+    const addAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${results[0].objectId}/addAttachment`;
+    const newAttachments = this.attachmentDataArray;
+    const addObservables = [];
 
-    attachmentFormData.append('attachment', formValues.attachment);
-    attachmentFormData.append('f', 'json');
-    attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
+    for (let i = 0; i < newAttachments.length; i++) {
+      const attachmentFormData = new FormData();
 
+      attachmentFormData.append('attachment', newAttachments[i]);
+      attachmentFormData.append('f', 'json');
+      attachmentFormData.append('token', sessionStorage.getItem('CBSArcToken'));
 
-    this.http.post(addAttachmentURL, attachmentFormData).subscribe(attachmentAddResult => {
-      const addedAttachmentData = <any>attachmentAddResult['addAttachmentResult'];
+      addObservables.push(this.http.post(addAttachmentURL, attachmentFormData));
+      forkJoin(addObservables).subscribe(attachmentAddResult => {
+        const addedAttachmentData = <any>attachmentAddResult['addAttachmentResult'];
 
-      if (addedAttachmentData !== undefined) {
-        const status = addedAttachmentData.success;
-        if (status !== true) {
-          console.error('Attachment cannot add');
-          // TODO: Notify Error
+        if (addedAttachmentData !== undefined) {
+          const status = addedAttachmentData.success;
+          if (status !== true) {
+            console.error('Attachment Could Not Be Added, /* Movement Create AddAttachment Error */');
+            // TODO: Notify Error
+          }
+          dialog.close();
+          this.dialog.close(true);
+        } else {
+          dialog.close();
+          this.dialog.close(true);
         }
-        dialog.close();
-        this.dialog.close(true);
-      } else {
-        dialog.close();
-        this.dialog.close(true);
-      }
+      });
+    }
+  }
 
-    });
+  postAddAttachment(url: string, attachment: any) {
+    const attachmentForm = new FormData();
+    attachmentForm.append('attachment', attachment);
+    attachmentForm.append('rollbackOnFailure', 'true');
+    attachmentForm.append('f', 'json');
+    attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+
+    return this.http.post(url, attachmentForm);
   }
 
   updateAttachments(formValues: any, dialog: DialogRef, results: Array<{ success: boolean, objectId: number }>) {
     const featureAttributes = <any>this.features;
-    const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/attachments?f=pjson`
+    // const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/attachments?f=pjson`
+    //   + `&token=${sessionStorage.getItem('CBSArcToken')}`;
+    // tslint:disable-next-line:max-line-length
+    const attachmentInfosURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/attachments?f=pjson`
       + `&token=${sessionStorage.getItem('CBSArcToken')}`;
+    // tslint:disable-next-line:max-line-length
+    const deleteAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/deleteAttachments`;
+    // tslint:disable-next-line:max-line-length
+    const addAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/addAttachment`;
 
     this.getAttachments(attachmentInfosURL).subscribe(attachments => {
       if (attachments !== undefined && attachments.length === 0) {
         this.addAttachment(formValues, dialog, results);
       } else {
-        const attachment = attachments[0];
-        const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/updateAttachment`;
-        const attachmentId = attachment.id;
+        const deleteObservables = [];
+        const newAttachments = this.formGroup.value['attachment'];
+        const previousAttachments = attachments;
 
-        const attachmentForm = new FormData();
+        for (let i = 0; i < previousAttachments.length; i++) {
+          const attachmentForm = new FormData();
 
-        attachmentForm.append('attachmentId', attachmentId.toString());
-        attachmentForm.append('attachment', formValues.attachment);
-        attachmentForm.append('f', 'json');
-        attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+          attachmentForm.append('attachmentIds', previousAttachments[i].id.toString());
+          attachmentForm.append('rollbackOnFailure', 'true');
+          attachmentForm.append('f', 'json');
+          attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
 
-        this.http.post(editAttachmentURL, attachmentForm).subscribe(updateAttachmentRes => {
-          const updatedAttachmentData = <any>updateAttachmentRes['updateAttachmentResult'];
-
-          if (updatedAttachmentData !== undefined) {
-            const status = updatedAttachmentData.success;
+          deleteObservables.push(this.http.post(deleteAttachmentURL, attachmentForm));
+        }
+        forkJoin(deleteObservables).subscribe(attachmentDeleteResults => {
+          const deleteAttachmentData = <any>attachmentDeleteResults;
+          let status = true;
+          deleteAttachmentData.find(data => {
+            const success = data['deleteAttachmentResults'][0].success;
+            if (!success) {
+              status = false;
+            }
+          });
+          if (deleteAttachmentData !== undefined) {
             if (status !== true) {
-              console.error('Attachment did not updated');
+              console.error('Old Attachment Could Not Be Deleted, /*Movement Create UpdateAttachments Error*/');
+              // TODO: Notify Error
+            } else {
+              const addObservables = [];
+              for (let j = 0; j < newAttachments.length; j++) {
+                addObservables.push(this.postAddAttachment(addAttachmentURL, newAttachments[j]));
+              }
+              forkJoin(addObservables).subscribe(attachmentAddResults => {
+                let addStatus = true;
+                const uaddAttachmentData = <any>attachmentAddResults;
+                uaddAttachmentData.find(data => {
+                  const success = data['addAttachmentResult'].success;
+                  if (!success) {
+                    addStatus = false;
+                  }
+                });
+                if (uaddAttachmentData !== undefined) {
+                  if (addStatus !== true) {
+                    console.error('New Attachment Could Not Be Added, /*Movement Create UpdateAttachments Error*/');
+                  }
+                  this.dialog.close();
+                  this.dialog.close(true);
+                } else {
+                  this.dialog.close();
+                  this.dialog.close(true);
+                }
+              });
             }
             dialog.close();
             this.dialog.close(true);
@@ -1124,20 +1932,51 @@ export class MovementCreateComponent implements OnInit {
             dialog.close();
             this.dialog.close(true);
           }
-
         });
+        // const attachment = attachments[0];
+        // tslint:disable-next-line:max-line-length
+        // const editAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/updateAttachment`;
+        // const attachmentId = attachment.id;
+
+        // const attachmentForm = new FormData();
+
+        // attachmentForm.append('attachmentId', attachmentId.toString());
+        // attachmentForm.append('attachment', formValues.attachment);
+        // attachmentForm.append('f', 'json');
+        // attachmentForm.append('token', sessionStorage.getItem('CBSArcToken'));
+
+        // this.http.post(editAttachmentURL, attachmentForm).subscribe(updateAttachmentRes => {
+        //   const updatedAttachmentData = <any>updateAttachmentRes['updateAttachmentResult'];
+
+        //   if (updatedAttachmentData !== undefined) {
+        //     const status = updatedAttachmentData.success;
+        //     if (status !== true) {
+        //       console.error('Attachment did not updated');
+        //     }
+        //     dialog.close();
+        //     this.dialog.close(true);
+        //   } else {
+        //     dialog.close();
+        //     this.dialog.close(true);
+        //   }
+        // });
       }
     });
   }
 
   removeIfHasAttachment(dialog: DialogRef) {
     const featureAttributes = <any>this.features;
-    const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/attachments?f=pjson`
+    // const attachmentInfosURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/attachments?f=pjson`
+    //   + `&token=${sessionStorage.getItem('CBSArcToken')}`;
+    // tslint:disable-next-line:max-line-length
+    const attachmentInfosURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/attachments?f=pjson`
       + `&token=${sessionStorage.getItem('CBSArcToken')}`;
 
     this.getAttachments(attachmentInfosURL).subscribe(attachments => {
       if (attachments !== undefined && attachments.length > 0) {
-        const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/deleteAttachments`;
+        // const editAttachmentURL = `${environment.arcgisMEBURL}/FeatureServer/13/${featureAttributes.objectid}/deleteAttachments`;
+        // tslint:disable-next-line:max-line-length
+        const editAttachmentURL = `https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/${featureAttributes.objectid}/deleteAttachments`;
 
         const attachmentForm = new FormData();
         const attachmentIds = attachments.map(attachmentObject => attachmentObject.id);
diff --git a/src/app/movements/movement-list/movement-list.component.ts b/src/app/movements/movement-list/movement-list.component.ts
index 70a713e31d97b2c9900c2388c9ebc70f98370665..821215d07735f387ed24584f9f896a578cfcdc76 100644
--- a/src/app/movements/movement-list/movement-list.component.ts
+++ b/src/app/movements/movement-list/movement-list.component.ts
@@ -63,7 +63,9 @@ export class MovementListComponent implements OnInit, OnDestroy {
 
     this.getMovementData().subscribe(movementData => {
       const foundMovement = movementData.find(movement => movement.type === moduleType);
-      this.getLayerFields().subscribe(fields => {
+      // TEST GAGA AÇILACAK
+      // this.getLayerFields().subscribe(fields => {
+      this.getTestLayerFields().subscribe(fields => {
         const listFields = this.createListFields(foundMovement, fields);
         const colDefs = this.createColumnDefinitions(listFields);
 
@@ -189,7 +191,8 @@ export class MovementListComponent implements OnInit, OnDestroy {
       num: 1,
       outFields: ['*']
     };
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
 
     return this.getFeatures(url, queryProperties).pipe(map(response => response.features));
   }
@@ -199,7 +202,9 @@ export class MovementListComponent implements OnInit, OnDestroy {
       whereValue = `'${whereValue}'`;
     }
 
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    // GAGA TEST alttaki silinip bu açılacak
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
     const queryProperties = <esri.QueryProperties>{
       outFields: outFields,
       where: `${whereField} = ${whereValue}`,
@@ -243,6 +248,10 @@ export class MovementListComponent implements OnInit, OnDestroy {
         const foundField = listFields.find(field => field.name === formDataField.name);
         const originalField = fields.find(layerField => layerField.name === formDataField.name);
 
+        if (formDataField.type === 'malik') {
+          return;
+        }
+
         if (foundField === undefined && formDataField.type !== 'file') {
           originalField.alias = formDataField.alias;
           listFields.push(originalField);
@@ -397,7 +406,8 @@ export class MovementListComponent implements OnInit, OnDestroy {
 
   openMovementDetail(data: any) {
     const objectid = data.objectid;
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
 
     const queryProperties = <esri.QueryProperties>{
       outFields: ['*'],
@@ -429,6 +439,15 @@ export class MovementListComponent implements OnInit, OnDestroy {
     });
   }
 
+  getTestLayerFields() {
+    return this.http.get<Array<esri.Field>>('https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2', {
+      params: {
+        token: sessionStorage.getItem('CBSArcToken'),
+        f: 'pjson',
+      }
+    }).pipe(map(response => response['fields']));
+  }
+
   getLayerFields() {
     return this.http.get<Array<esri.Field>>(environment.arcgisMEBURL + 'FeatureServer/' + 13, {
       params: {
@@ -485,7 +504,9 @@ export class MovementListComponent implements OnInit, OnDestroy {
   getPreviousNextMovement(data: any) {
     const dataId = data.objectid;
 
-    const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    // const url = environment.arcgisMEBURL + 'FeatureServer/' + 13 + '/query';
+    const url = 'https://cbs.meb.gov.tr/server/rest/services/Modul2023/modul/FeatureServer/2/query';
+
     const previousQueryProperties = <esri.QueryProperties>{
       num: 1,
       where: `objectid < ${dataId} and islem_refid = ${this.moduleRefId}`,
diff --git a/src/app/multi-feature-select/multi-feature-select.component.ts b/src/app/multi-feature-select/multi-feature-select.component.ts
index 0a56de6078c3d57806cf978d5ce8e04047292c7b..a59b04c7ca8a41b882f107d8599a0f6d2423df80 100644
--- a/src/app/multi-feature-select/multi-feature-select.component.ts
+++ b/src/app/multi-feature-select/multi-feature-select.component.ts
@@ -260,7 +260,8 @@ export class MultiFeatureSelectComponent implements OnInit, OnDestroy {
     this.dialogService.open(MultiModuleListComponent, 'İşlem Bilgileri', false, {
       data: {
         multiModulesData,
-        featureDatas: cloneArray
+        featureDatas: cloneArray,
+        mapView: this.mainComponent.mapView
       }
     }, true, 'blue');
   }
diff --git a/src/app/search/maks-adresbinakodu/maks-adresbinakodu.component.ts b/src/app/search/maks-adresbinakodu/maks-adresbinakodu.component.ts
index 03a4c9db016aeabecb36673597ce8ae579106056..0b6f639f4f1340d57a7b334d8327044f52308238 100644
--- a/src/app/search/maks-adresbinakodu/maks-adresbinakodu.component.ts
+++ b/src/app/search/maks-adresbinakodu/maks-adresbinakodu.component.ts
@@ -79,7 +79,7 @@ export class MaksAdresbinakoduComponent implements OnInit, OnDestroy {
           il.uavtil = features[i].attributes['uavtil'];
           this.ilArray.push(il);
         }
-      }).then(x => {
+
         if (permZones !== undefined || permZones.length > 0) {
           permZones.forEach(permZone => {
             const zone = permZone.zone;
diff --git a/src/app/services/web-data.service.ts b/src/app/services/web-data.service.ts
index b09b751937a73d259a639ef6e6b73bd86464d599..8a1429d0b644d2b17a3634b92985fa28bb048999 100644
--- a/src/app/services/web-data.service.ts
+++ b/src/app/services/web-data.service.ts
@@ -65,7 +65,7 @@ import { BirlesikGuzergahaRotaEkleRequest } from '../models/MEBTasimali/Birlesik
 import { DurakKurumAciklamaGuncelleRequest } from '../models/MEBTasimali/DurakKurumAciklamaGuncelleRequest';
 import { GuzergahOnaylaRequest } from '../models/MEBTasimali/GuzergahOnaylaRequest';
 import { catchError, timeout } from 'rxjs/operators';
-import { of } from 'rxjs';
+import { of, Subscription } from 'rxjs';
 import { MaksData } from '../models/MAKSData';
 import { MaksBinaKodu, MaksPostBody } from '../models/MaksBinaKodu';
 
@@ -425,7 +425,9 @@ export class WebDataService {
   }
 
   getActiveDonem() {
-    return this.http.get(this.tasimaliDonemURL + 'AktifDonemGetir', { headers: this.auth.createHeader() });
+    const observer = new Observable();
+    return observer;
+    // return this.http.get(this.tasimaliDonemURL + 'AktifDonemGetir', { headers: this.auth.createHeader() });
   }
 
   addDonem(donem: DonemEkleDto) {
diff --git a/src/assets/MirasciData.json b/src/assets/MirasciData.json
new file mode 100644
index 0000000000000000000000000000000000000000..e72e7c12c4e86963e2280d6f22cf985dd5366569
--- /dev/null
+++ b/src/assets/MirasciData.json
@@ -0,0 +1,47 @@
+{
+  "type": "Mirasçı Bilgileri",
+  "formData": [{
+    "alias": "Ad",
+    "name": "ad",
+    "type": "text",
+    "required": true
+  }, {
+    "alias": "Soyad",
+    "name": "soyad",
+    "type": "text",
+    "required": true,
+    "disabled": false
+  }, {
+    "alias": "TC Kimlik No",
+    "name": "tc_kimlik_no",
+    "type": "number",
+    "required": true,
+    "disabled": false
+  }, {
+    "alias": "Anne Adı",
+    "name": "anne_adi",
+    "type": "string",
+    "required": true,
+    "disabled": false
+  }, {
+    "alias": "Baba Adı",
+    "name": "baba_adi",
+    "type": "string",
+    "required": true,
+    "disabled": false
+  },
+  {
+    "alias": "Parsel ID",
+    "name": "tasinmaz_id",
+    "type": "string",
+    "required": false,
+    "disabled": true
+  },
+  {
+    "alias": "Malik ID",
+    "name": "hisseid",
+    "type": "string",
+    "required": false,
+    "disabled": true
+  }]
+}
diff --git a/src/assets/ProcessData.json b/src/assets/ProcessData.json
index a38e198b87cb8bdf445ac4c664ae167b6f7fec53..c43efd057e5327a2b421baf8961449d682038545 100644
--- a/src/assets/ProcessData.json
+++ b/src/assets/ProcessData.json
@@ -277,7 +277,7 @@
           {
             "alias": "İrtifak Bedeli",
             "name": "ucret",
-            "type": "text",
+            "type": "number",
             "required": true
           },
           {
@@ -455,7 +455,7 @@
           {
             "alias": "Kiraya Alma Bedeli(aylık)",
             "name": "ucret",
-            "type": "text",
+            "type": "number",
             "required": true
           },
           {
@@ -639,7 +639,7 @@
           {
             "alias": "Kiraya Verme Bedeli(aylık)",
             "name": "ucret",
-            "type": "text",
+            "type": "number",
             "required": true
           },
           {
@@ -1306,7 +1306,8 @@
       "chosen_values": []
     },
     "defaultField": "durumu",
-    "allowedStates": [{
+    "allowedStates": [
+      {
         "state": 2,
         "values": [2, 3, 4, 5, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 37]
       },
@@ -1367,7 +1368,8 @@
         "values": [2, 3, 4, 5, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 37]
       }
     ],
-    "formData": [{
+    "formData": [
+      {
         "states": [
           7
         ],
@@ -1437,20 +1439,20 @@
           10
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
           },
           {
             "alias": "Onaylanan Ödenek Tutarı",
-            "name": "onaylanan_odenek_tutar",
+            "name": "ucret",
             "type": "number",
             "required": true
           },
@@ -1559,7 +1561,7 @@
         "fields": [{
             "alias": "Tamamlanan Tutar",
             "name": "ucret",
-            "type": "text",
+            "type": "number",
             "required": true
           },
           {
@@ -1623,20 +1625,20 @@
           17
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
           },
           {
             "alias": "Kullanılan Ödenek Tutarı",
-            "name": "kullanilan_odenek_tutar",
+            "name": "ucret",
             "type": "number",
             "required": false
           }
@@ -1893,57 +1895,216 @@
         {
           "value": 37,
           "name": ""
+        },
+        {
+          "value": 38,
+          "name": ""
+        },
+        {
+          "value": 39,
+          "name": ""
+        },
+        {
+          "value": 40,
+          "name": ""
+        },
+        {
+          "value": 41,
+          "name": ""
+        },
+        {
+          "value": 42,
+          "name": ""
         }
       ],
       "chosen_values": []
     },
     "defaultField": "durumu",
-    "allowedStates": [{
+    "allowedStates": [
+      {
         "state": 4,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 5,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 7,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 11,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 12,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 13,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 14,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 19,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 20,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       },
       {
         "state": 37,
-        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37]
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
+      },
+      {
+        "state": 38,
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
+      },
+      {
+        "state": 39,
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
+      },
+      {
+        "state": 40,
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
+      },
+      {
+        "state": 41,
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
+      },
+      {
+        "state": 42,
+        "values": [4, 5, 7, 11, 12, 13, 14, 19, 20, 37, 38, 39, 40, 41, 42]
       }
     ],
-    "formData": [{
+    "formData": [
+      {
         "states": [
-          7
+          38
+        ],
+        "fields": [
+          {
+            "alias": "Karar No",
+            "name": "karar_no",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "Karar Türü",
+            "name": "karar_turu",
+            "type": "domain",
+            "required": true,
+            "domain_values": [{
+              "value": 1,
+              "name": ""
+            },
+            {
+              "value": 2,
+              "name": ""
+            },
+            {
+              "value": 3,
+              "name": ""
+            }
+          ]
+          },
+          {
+            "alias": "Dava Bedeli",
+            "name": "ucret",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "Davalık Yüz Ölçüm",
+            "name": "alan",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "M2 Birim Fiyatı",
+            "name": "birim_ucret",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "Açıklama",
+            "name": "aciklama",
+            "type": "text",
+            "required": false
+          }
+        ]
+      },
+      {
+        "states": [
+          39
+        ],
+        "fields": []
+      },
+      {
+        "states": [
+          40
         ],
         "fields": [{
+          "alias": "Açıklama",
+          "name": "aciklama",
+          "type": "text",
+          "required": true
+        }]
+      },
+      {
+        "states": [
+          41
+        ],
+        "fields": [
+          {
+            "alias": "Resmi Yazı Tarihi",
+            "name": "gelen_tarih",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Yazı Sayısı",
+            "name": "gelen_sayi",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "Mahkeme Adı",
+            "name": "detay",
+            "type": "text",
+            "required": true
+          },
+          {
+            "alias": "Kesinleşme Tarihi",
+            "name": "bitis_tarihi",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Şerh Tarihi",
+            "name": "islem_tarihi",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Açıklama",
+            "name": "aciklama",
+            "type": "text",
+            "required": true
+          }
+        ]
+      },
+      {
+        "states": [
+          42
+        ],
+        "fields": [
+          {
             "alias": "Gelen Tarih",
             "name": "gelen_tarih",
             "type": "date",
@@ -1955,6 +2116,48 @@
             "type": "number",
             "required": true
           },
+          {
+            "alias": "Talep Edilen Tutar",
+            "name": "ucret",
+            "type": "number",
+            "required": true
+          },
+          {
+            "alias": "Ödeme Emri Belgesi",
+            "name": "attachment",
+            "type": "file",
+            "required": true
+          },
+          {
+            "alias": "Ödeme Yapılan Tarih",
+            "name": "bitis_tarihi",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Açıklama",
+            "name": "aciklama",
+            "type": "text",
+            "required": true
+          }
+      ]
+      },
+      {
+        "states": [
+          7
+        ],
+        "fields": [{
+            "alias": "Tarih",
+            "name": "gelen_tarih",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Sayı",
+            "name": "gelen_sayi",
+            "type": "number",
+            "required": true
+          },
           {
             "alias": "Açıklama",
             "name": "aciklama",
@@ -1968,13 +2171,13 @@
           19
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
@@ -1992,20 +2195,20 @@
           11
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
           },
           {
             "alias": "Ödenecek Tutar",
-            "name": "odenecek_tutar",
+            "name": "ucret",
             "type": "number",
             "required": true
           },
@@ -2022,20 +2225,20 @@
           12
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
           },
           {
-            "alias": "Gönderilen Tutar",
-            "name": "gonderilen_tutar",
+            "alias": "Ödenen Tutar",
+            "name": "ucret",
             "type": "number",
             "required": true
           },
@@ -2050,7 +2253,26 @@
             "name": "aciklama",
             "type": "text",
             "required": false
+          },
+          {
+            "alias": "Ödeme No",
+            "name": "islem_no",
+            "type": "text",
+            "required": true
+          },
+          {
+            "alias": "Ödeme Tarihi",
+            "name": "islem_tarihi",
+            "type": "date",
+            "required": true
+          },
+          {
+            "alias": "Ödeme Emri Belgesi",
+            "name": "attachment",
+            "type": "file",
+            "required": true
           }
+
         ]
       },
       {
@@ -2074,6 +2296,18 @@
             "name": "aciklama",
             "type": "text",
             "required": false
+          },
+          {
+            "alias": "Tenkis No",
+            "name": "islem_no",
+            "type": "text",
+            "required": true
+          },
+          {
+            "alias": "Tenkis Tarihi",
+            "name": "islem_tarihi",
+            "type": "date",
+            "required": true
           }
         ]
       },
@@ -2084,12 +2318,12 @@
         "fields": [{
             "alias": "Tamamlanan Tutar",
             "name": "ucret",
-            "type": "text",
+            "type": "number",
             "required": true
           },
           {
             "alias": "Tamamlanan m² Fiyat(TL)",
-            "name": "tamamlanan_m2_fiyati",
+            "name": "ucret",
             "type": "number",
             "required": true
           },
@@ -2100,7 +2334,7 @@
             "required": false
           },
           {
-            "alias": "Ek",
+            "alias": "Tapu Kaydı Belgesi",
             "name": "attachment",
             "type": "file",
             "required": true
@@ -2112,13 +2346,13 @@
           4, 37
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
@@ -2147,20 +2381,20 @@
           20
         ],
         "fields": [{
-            "alias": "Giden Tarih",
+            "alias": "Tarih",
             "name": "giden_tarih",
             "type": "date",
             "required": true
           },
           {
-            "alias": "Giden Sayı",
+            "alias": "Sayı",
             "name": "giden_sayi",
             "type": "number",
             "required": true
           },
           {
             "alias": "Gönderilen Tutar",
-            "name": "gonderilen_tutar",
+            "name": "ucret",
             "type": "number",
             "required": true
           },
diff --git a/src/assets/TypeData.json b/src/assets/TypeData.json
index a3d4beb48db31b36e22f901d83ec925754bc6120..ffa2f0e8c03bf080388d6dcefcc340a51cdf7bda 100644
--- a/src/assets/TypeData.json
+++ b/src/assets/TypeData.json
@@ -1739,7 +1739,8 @@
     "type": "Plan",
     "value": 5,
     "formData": [
-      [{
+      [
+        {
           "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -1810,7 +1811,8 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
           "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -1923,7 +1925,8 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
           "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -2043,7 +2046,8 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
           "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -2132,7 +2136,8 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
           "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -2239,8 +2244,7 @@
                 "not_values": [4, 5]
               }]
             ],
-            "movements_todelete": [9, 36, 37],
-            "numberof_deletedmovements": 0
+            "movements_todelete": [9, 36, 37]
           }]
         ]
       }],
@@ -2255,8 +2259,7 @@
                 "not_values": []
               }]
             ],
-            "movements_todelete": [9, 36],
-            "numberof_deletedmovements": 0
+            "movements_todelete": [9, 36]
           }]
         ]
       }]
@@ -3328,8 +3331,9 @@
     "type": "Kamulaştırma",
     "value": 8,
     "formData": [
-      [{
-          "alias": "Gelen Tarih",
+      [
+        {
+          "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
           "required": true,
@@ -3337,7 +3341,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Gelen Sayı",
+          "alias": "Sayı",
           "name": "sayi",
           "type": "number",
           "required": true,
@@ -3378,8 +3382,9 @@
           "chosen_values": []
         }
       ],
-      [{
-          "alias": "Gelen Tarih",
+      [
+        {
+          "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
           "required": true,
@@ -3387,7 +3392,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Gelen Sayı",
+          "alias": "Sayı",
           "name": "sayi",
           "type": "number",
           "required": true,
@@ -3440,8 +3445,8 @@
         },
         {
           "alias": "Kamulaştırma Bedeli (₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -3455,8 +3460,9 @@
           "chosen_values": []
         }
       ],
-      [{
-          "alias": "Gelen Tarih",
+      [
+        {
+          "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
           "required": true,
@@ -3464,7 +3470,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Gelen Sayı",
+          "alias": "Sayı",
           "name": "sayi",
           "type": "number",
           "required": true,
@@ -3472,7 +3478,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Talep Türü",
+          "alias": "Türü",
           "name": "talep_turu",
           "type": "domain",
           "required": true,
@@ -3549,8 +3555,8 @@
         },
         {
           "alias": "Kamulaştırma Bedeli (₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -3562,7 +3568,7 @@
           "required": true,
           "domain_values": [],
           "chosen_values": [],
-          "calculateFunction": "ucret/alan"
+          "calculateFunction": "depo_bedeli/alan"
         },
         {
           "alias": "Üzerinde Muhdesat (bina, ağaç vb.) Var Mı?",
@@ -3613,8 +3619,9 @@
           "chosen_values": []
         }
       ],
-      [{
-          "alias": "Gelen Tarih",
+      [
+        {
+          "alias": "Tarih",
           "name": "islem_tarihi",
           "type": "date",
           "required": true,
@@ -3622,7 +3629,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Gelen Sayı",
+          "alias": "Sayı",
           "name": "sayi",
           "type": "number",
           "required": true,
@@ -3707,8 +3714,8 @@
         },
         {
           "alias": "Kamulaştırma Bedeli (₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -3720,7 +3727,7 @@
           "required": true,
           "domain_values": [],
           "chosen_values": [],
-          "calculateFunction": "ucret/alan"
+          "calculateFunction": "depo_bedeli/alan"
         },
         {
           "alias": "Üzerinde Muhdesat (bina, ağaç vb.) Var Mı?",
@@ -3784,12 +3791,12 @@
         },
         {
           "alias": "Toplam Kamulaştırma Bedeli (₺)",
-          "name": "depo_bedeli",
+          "name": "ucret",
           "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": [],
-          "calculateFunction": "ucret+icra_bedeli"
+          "calculateFunction": "depo_bedeli+icra_bedeli"
         },
         {
           "alias": "Açıklama",
@@ -3808,7 +3815,8 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -3903,7 +3911,7 @@
         {
           "alias": "Kamulaştırma Bedeli (₺)",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -4075,7 +4083,16 @@
     "type": "Kamulaştırma Davaları",
     "value": 10,
     "formData": [
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -4138,8 +4155,17 @@
           "chosen_values": []
         }
       ],
-      [{
-          "alias": "Gelen Tarih",
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Resmi Yazı Tarihi",
           "name": "islem_tarihi",
           "type": "date",
           "required": true,
@@ -4147,7 +4173,7 @@
           "chosen_values": []
         },
         {
-          "alias": "Gelen Sayı",
+          "alias": "Yazı Sayısı",
           "name": "sayi",
           "type": "number",
           "required": true,
@@ -4250,6 +4276,30 @@
             }
           ]
         },
+        {
+          "alias": "Mahkeme Adı",
+          "name": "detay",
+          "type": "text",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Esas No",
+          "name": "esas_no",
+          "type": "text",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Avukat Adı",
+          "name": "avukat_adi",
+          "type": "text",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
         {
           "alias": "Açıklama",
           "name": "aciklama",
@@ -4257,9 +4307,42 @@
           "required": false,
           "domain_values": [],
           "chosen_values": []
+        },
+        {
+          "alias": "Malik Listesi",
+          "name": "?",
+          "type": "malik",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Davalık YüzÖlçüm",
+          "name": "alan",
+          "type": "numberText",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "İzbedel",
+          "name": "ucret",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
         }
       ],
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -4364,7 +4447,7 @@
         {
           "alias": "Davalık YüzÖlçüm",
           "name": "alan",
-          "type": "number",
+          "type": "numberText",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -4378,7 +4461,16 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -4467,7 +4559,7 @@
         {
           "alias": "Davalık YüzÖlçüm",
           "name": "alan",
-          "type": "number",
+          "type": "numberText",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -4481,7 +4573,16 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -4620,7 +4721,7 @@
         {
           "alias": "Dava Bedeli",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": false,
           "domain_values": [],
           "chosen_values": []
@@ -4636,7 +4737,7 @@
         {
           "alias": "Davalık YüzÖlçüm",
           "name": "alan",
-          "type": "number",
+          "type": "numberText",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -4667,7 +4768,16 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -4834,7 +4944,7 @@
         {
           "alias": "Davalık YüzÖlçüm",
           "name": "alan",
-          "type": "number",
+          "type": "numberText",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -4848,7 +4958,16 @@
           "chosen_values": []
         }
       ],
-      [{
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
           "alias": "Gelen Tarih",
           "name": "islem_tarihi",
           "type": "date",
@@ -5003,11 +5122,93 @@
         {
           "alias": "Davalık YüzÖlçüm",
           "name": "alan",
+          "type": "numberText",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Açıklama",
+          "name": "aciklama",
+          "type": "text",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        }
+      ],
+      [
+        {
+          "alias": "Dosya No",
+          "name": "dosya_no",
+          "type": "number",
+          "required": false,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Birim Adı",
+          "name": "detay",
+          "type": "text",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Birim Esası",
+          "name": "esas_no",
           "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
         },
+        {
+          "alias": "Resmi Yazı Tarihi",
+          "name": "islem_tarihi",
+          "type": "date",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Yazı Sayısı",
+          "name": "sayi",
+          "type": "number",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "İcrası Talep Edilen Malik",
+          "name": "?",
+          "type": "malik",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Talep Edilen Bedel",
+          "name": "ucret",
+          "type": "number",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Tebliğ Tarihi",
+          "name": "bitis_tarihi",
+          "type": "date",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
+        {
+          "alias": "Avukat Adı",
+          "name": "avukat_adi",
+          "type": "text",
+          "required": true,
+          "domain_values": [],
+          "chosen_values": []
+        },
         {
           "alias": "Açıklama",
           "name": "aciklama",
@@ -5016,7 +5217,63 @@
           "domain_values": [],
           "chosen_values": []
         }
+
       ]
+    ],
+    "processMovementRel": [
+      [{
+        "islem_turu": 10,
+        "field_values": [
+          [{
+            "field_value": [
+              [{
+                "name": "karar_turu",
+                "values": [],
+                "not_values": [null]
+              }]
+            ],
+            "movements_todelete": [42]
+          }]
+        ]
+      }],
+      [{
+        "islem_turu": 5,
+        "field_values": [
+          [{
+            "field_value": [
+              [{
+                "name": "talep_turu",
+                "values": [6],
+                "not_values": []
+              }]
+            ],
+            "movements_todelete": [9, 36]
+          }]
+        ]
+      }]
+    ],
+    "movementRel": [
+      [{
+        "islem_turu": 10,
+        "movement_values": [
+          [{
+            "if_has": [38],
+            "if_not_have": [],
+            "movements_todelete": [38]
+          }], 
+          [{
+            "if_has": [],
+            "if_not_have": [38],
+            "movements_todelete": [39, 40]
+          }],
+          [{
+            "if_has": [38, 40],
+            "if_not_have": [],
+            "movements_todelete": [38, 40]
+          }]
+          
+        ]
+      }]
     ]
   },
   {
@@ -5073,8 +5330,8 @@
         },
         {
           "alias": "Tahmini Kamulaştırma Bedeli(₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5198,8 +5455,8 @@
         },
         {
           "alias": "Tahmini Kamulaştırma Bedeli(₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5323,8 +5580,8 @@
         },
         {
           "alias": "Tahmini Kamulaştırma Bedeli(₺)",
-          "name": "ucret",
-          "type": "text",
+          "name": "depo_bedeli",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5410,13 +5667,13 @@
           "chosen_values": []
         },
         {
-          "alias": "Toplam Kamulaştırma Bedeli",
-          "name": "depo_bedeli",
+          "alias": "Toplam Kamulaştırma Bedeli (₺)",
+          "name": "ucret",
           "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": [],
-          "calculateFunction": "ucret+icra_bedeli"
+          "calculateFunction": "depo_bedeli+icra_bedeli"
         },
         {
           "alias": "Açıklama",
@@ -5530,7 +5787,7 @@
         {
           "alias": "Proje Bedeli",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": false,
           "domain_values": [],
           "chosen_values": []
@@ -5633,7 +5890,7 @@
         {
           "alias": "Proje Bedeli",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5744,7 +6001,7 @@
         {
           "alias": "Proje Bedeli",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5855,7 +6112,7 @@
         {
           "alias": "Proje Bedeli",
           "name": "ucret",
-          "type": "text",
+          "type": "number",
           "required": true,
           "domain_values": [],
           "chosen_values": []
@@ -5915,7 +6172,7 @@
           "alias": "Tahmini Maaliyet(₺)",
           "name": "ucret",
           "required": "true",
-          "type": "text",
+          "type": "number",
           "domain_values": [],
           "chosen_values": []
         },
diff --git a/src/environments/environment.ts b/src/environments/environment.ts
index 7c491a7993a319622e4fc62aae19e796d6110115..e85f372a853a6751512d04508e47648cb6ce3e1c 100644
--- a/src/environments/environment.ts
+++ b/src/environments/environment.ts
@@ -6,7 +6,7 @@ export const environment = {
   production: false,
   geoserverLink: 'http://localhost:8095',
   geoserver: '/geoserver/ows?service=wps&request=execute',
-  ws: 'http://localhost:52824/api/',
+  ws: 'http://tasinmaz.meb.gov.tr/meb-ws/api/',
   geotifURL: 'https://cbs.meb.gov.tr/server/rest/services/meb2023/geotiff2023/MapServer',
   mebCbsUrl: 'http://mebcbs.meb.gov.tr/',
   arcgisMEBURL: 'https://cbs.meb.gov.tr/server/rest/services/mebcbs2023/mebcbs2023/',
